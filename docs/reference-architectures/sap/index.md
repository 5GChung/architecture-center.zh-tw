---
title: "在 Azure 上部署 SAP NetWeaver 和 SAP HANA"
description: "Azure 高可用性環境中執行 SAP HANA 的經過證實做法。"
author: njray
ms.date: 06/29/2017
ms.openlocfilehash: 27a97103c0c6f305cb8e830d670c8d0ba7e22aa5
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/14/2017
---
# <a name="deploy-sap-netweaver-and-sap-hana-on-azure"></a><span data-ttu-id="21369-103">在 Azure 上部署 SAP NetWeaver 和 SAP HANA</span><span class="sxs-lookup"><span data-stu-id="21369-103">Deploy SAP NetWeaver and SAP HANA on Azure</span></span>

<span data-ttu-id="21369-104">此參考架構會顯示一組經過證實的做法，能在 Azure 的高可用性環境中執行 SAP HANA。</span><span class="sxs-lookup"><span data-stu-id="21369-104">This reference architecture shows a set of proven practices for running SAP HANA in a high availability environment on Azure.</span></span> [<span data-ttu-id="21369-105">**部署這個解決方案**。</span><span class="sxs-lookup"><span data-stu-id="21369-105">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="21369-106">![0][0]</span><span class="sxs-lookup"><span data-stu-id="21369-106">![0][0]</span></span>

<span data-ttu-id="21369-107">*下載這個架構的 [Visio 檔案][visio-download]。*</span><span class="sxs-lookup"><span data-stu-id="21369-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="21369-108">部署此參考架構需要 SAP 產品的適當授權和其他非 Microsoft 技術。</span><span class="sxs-lookup"><span data-stu-id="21369-108">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span> <span data-ttu-id="21369-109">如需 Microsoft 與 SAP 之間合作關係的相關資訊，請參閱 [Azure 上的 SAP HANA][sap-hana-on-azure]。</span><span class="sxs-lookup"><span data-stu-id="21369-109">For information about the partnership between Microsoft and SAP, see [SAP HANA on Azure][sap-hana-on-azure].</span></span>

## <a name="architecture"></a><span data-ttu-id="21369-110">架構</span><span class="sxs-lookup"><span data-stu-id="21369-110">Architecture</span></span>

<span data-ttu-id="21369-111">此架構由下列元件組成。</span><span class="sxs-lookup"><span data-stu-id="21369-111">The architecture consists of the following components.</span></span>

- <span data-ttu-id="21369-112">**虛擬網路 (VNet)**。</span><span class="sxs-lookup"><span data-stu-id="21369-112">**Virtual network (VNet)**.</span></span> <span data-ttu-id="21369-113">VNet 是 Azure 中邏輯上隔離網路的表示法。</span><span class="sxs-lookup"><span data-stu-id="21369-113">A VNet is a representation of a logically isolated network in Azure.</span></span> <span data-ttu-id="21369-114">此參考架構中的所有 VM 都會部署到相同的 VNet。</span><span class="sxs-lookup"><span data-stu-id="21369-114">All of the VMs in this reference architecture are deployed to the same VNet.</span></span> <span data-ttu-id="21369-115">VNet 會再細分為子網路。</span><span class="sxs-lookup"><span data-stu-id="21369-115">The VNet is further subdivided into subnets.</span></span> <span data-ttu-id="21369-116">針對每一層建立不同的子網路，包括應用程式 (SAP NetWeaver)、資料庫 (SAP HANA)、管理 (jumpbox) 和 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="21369-116">Create a separate subnet for each tier, including application (SAP NetWeaver), database (SAP HANA), management (the jumpbox), and Active Directory.</span></span>

- <span data-ttu-id="21369-117">**虛擬機器 (VM)**。</span><span class="sxs-lookup"><span data-stu-id="21369-117">**Virtual machines (VMs)**.</span></span> <span data-ttu-id="21369-118">這個架構的 VM 群組為數個不同層。</span><span class="sxs-lookup"><span data-stu-id="21369-118">The VMs for this architecture are grouped into several distinct tiers.</span></span>

    - <span data-ttu-id="21369-119">**SAP NetWeaver**。</span><span class="sxs-lookup"><span data-stu-id="21369-119">**SAP NetWeaver**.</span></span> <span data-ttu-id="21369-120">包含 SAP ASCS、SAP Web Dispatcher 和 SAP 應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="21369-120">Includes SAP ASCS, SAP Web Dispatcher, and the SAP application servers.</span></span> 
    
    - <span data-ttu-id="21369-121">**SAP HANA**。</span><span class="sxs-lookup"><span data-stu-id="21369-121">**SAP HANA**.</span></span> <span data-ttu-id="21369-122">此參考架構會將 SAP HANA 用於資料庫層，在單一 [GS5][vm-sizes-mem] 執行個體上執行。</span><span class="sxs-lookup"><span data-stu-id="21369-122">This reference architecture uses SAP HANA for the database tier, running on a single [GS5][vm-sizes-mem] instance.</span></span> <span data-ttu-id="21369-123">SAP HANA 通過 GS5 上生產 OLAP 工作負載，或 [SAP HANA on Azure 大型執行個體][azure-large-instances]的認證。</span><span class="sxs-lookup"><span data-stu-id="21369-123">SAP HANA is certified for production OLAP workloads on GS5 or [SAP HANA on Azure Large Instances][azure-large-instances].</span></span> <span data-ttu-id="21369-124">此參考架構適用於 M 系列和 G 系列中的 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="21369-124">This reference architecture is for Azure virtual machines in the G-series and M-series.</span></span> <span data-ttu-id="21369-125">如需 Azure 大型執行個體上 SAP HANA 的相關資訊，請參閱 [Azure 上的 SAP HANA (大型執行個體) 概觀和架構][azure-large-instances]。</span><span class="sxs-lookup"><span data-stu-id="21369-125">For information about SAP HANA on Azure Large Instances, see [SAP HANA (large instances) overview and architecture on Azure][azure-large-instances].</span></span>
   
    - <span data-ttu-id="21369-126">**Jumpbox**。</span><span class="sxs-lookup"><span data-stu-id="21369-126">**Jumpbox**.</span></span> <span data-ttu-id="21369-127">也稱為防禦主機。</span><span class="sxs-lookup"><span data-stu-id="21369-127">Also called a bastion host.</span></span> <span data-ttu-id="21369-128">這是網路上系統管理員用來連線到其他 VM 的安全 VM。</span><span class="sxs-lookup"><span data-stu-id="21369-128">This is a secure VM on the network that administrators use to connect to the other VMs.</span></span> 
     
    - <span data-ttu-id="21369-129">**Windows Server Active Directory (AD) 網域控制站。**</span><span class="sxs-lookup"><span data-stu-id="21369-129">**Windows Server Active Directory (AD) domain controllers.**</span></span> <span data-ttu-id="21369-130">網域控制站可用來設定 Windows Server 容錯移轉叢集 (大型執行個體)。</span><span class="sxs-lookup"><span data-stu-id="21369-130">The domain controllers are used to configure the Windows Server Failover Cluster (see below).</span></span>
 
- <span data-ttu-id="21369-131">**可用性設定組**。</span><span class="sxs-lookup"><span data-stu-id="21369-131">**Availability sets**.</span></span> <span data-ttu-id="21369-132">將 SAP Web Dispatcher、SAP 應用程式伺服器和 SAP ACSC 角色的 VM 放入個別的可用性設定組，並針對每個角色佈建至少兩個 VM。</span><span class="sxs-lookup"><span data-stu-id="21369-132">Place the VMs for the SAP Web Dispatcher, SAP application server, and SAP ACSC roles into separate availability sets, and provision at least two VMs for each role.</span></span> <span data-ttu-id="21369-133">這讓虛擬機器能夠符合較高服務等級協定 (SLA) 的資格。</span><span class="sxs-lookup"><span data-stu-id="21369-133">This makes the VMs eligible for a higher service level agreement (SLA).</span></span>
    
- <span data-ttu-id="21369-134">**NIC。**</span><span class="sxs-lookup"><span data-stu-id="21369-134">**NICs.**</span></span> <span data-ttu-id="21369-135">執行 SAP NetWeaver 和 SAP HANA 的 VM 需要兩個網路介面 (NIC)。</span><span class="sxs-lookup"><span data-stu-id="21369-135">The VMs that run SAP NetWeaver and SAP HANA require two network interfaces (NICs).</span></span> <span data-ttu-id="21369-136">每個 NIC 會指派給不同的子網路，以分隔不同類型的流量。</span><span class="sxs-lookup"><span data-stu-id="21369-136">Each NIC is assigned to a different subnet, to segregate different types of traffic.</span></span> <span data-ttu-id="21369-137">如需詳細資訊，請參閱下方的[建議](#recommendations)。</span><span class="sxs-lookup"><span data-stu-id="21369-137">See [Recommendations](#recommendations) below for more information.</span></span>

- <span data-ttu-id="21369-138">**Windows Server 容錯移轉叢集**。</span><span class="sxs-lookup"><span data-stu-id="21369-138">**Windows Server Failover Cluster**.</span></span> <span data-ttu-id="21369-139">執行 SAP ACSC 的 VM 會設定為高可用性的容錯移轉叢集。</span><span class="sxs-lookup"><span data-stu-id="21369-139">The VMs that run SAP ACSC are configured as a failover cluster for high availability.</span></span> <span data-ttu-id="21369-140">若要支援容錯移轉叢集，SIOS DataKeeper 叢集版會執行叢集共用磁碟區 (CSV) 函式，方法為複寫叢集節點所擁有的獨立磁碟。</span><span class="sxs-lookup"><span data-stu-id="21369-140">To support the failover cluster, SIOS DataKeeper Cluster Edition performs the cluster shared volume (CSV) function by replicating independent disks owned by the cluster nodes.</span></span> <span data-ttu-id="21369-141">如需詳細資訊，請參閱[在 Microsoft 平台上執行 SAP 應用程式][running-sap]。</span><span class="sxs-lookup"><span data-stu-id="21369-141">For details, see [Running SAP applications on the Microsoft platform][running-sap].</span></span>
    
- <span data-ttu-id="21369-142">**負載平衡器。**</span><span class="sxs-lookup"><span data-stu-id="21369-142">**Load balancers.**</span></span> <span data-ttu-id="21369-143">會使用兩個 [Azure Load Balancer][azure-lb] 執行個體。</span><span class="sxs-lookup"><span data-stu-id="21369-143">Two [Azure Load Balancer][azure-lb] instances are used.</span></span> <span data-ttu-id="21369-144">第一個會顯示在圖表的左邊，將流量散發至 SAP Web Dispatcher。</span><span class="sxs-lookup"><span data-stu-id="21369-144">The first, shown on the left of the diagram, distributes traffic to the SAP Web Dispatcher VMs.</span></span> <span data-ttu-id="21369-145">此設定會實作 [SAP Web Dispatcher 的高可用性][sap-dispatcher-ha]中所述的平行 web 發送器選項。</span><span class="sxs-lookup"><span data-stu-id="21369-145">This configuration implements the parallel web dispatcher option described in [High Availability of the SAP Web Dispatcher][sap-dispatcher-ha].</span></span> <span data-ttu-id="21369-146">第二個負載平衡器會顯示在右側，可允許 Windows Server 容錯移轉叢集中的容錯移轉，方法是將連入連線導向至作用中/狀況良好的節點。</span><span class="sxs-lookup"><span data-stu-id="21369-146">The second load balancer, shown on the right, enables failover in the Windows Server Failover Cluster, by directing incoming connections to the active/healthy node.</span></span>

- <span data-ttu-id="21369-147">**VPN 閘道。**</span><span class="sxs-lookup"><span data-stu-id="21369-147">**VPN Gateway.**</span></span> <span data-ttu-id="21369-148">VPN 閘道會將您的內部部署網路擴充至 Azure VNet。</span><span class="sxs-lookup"><span data-stu-id="21369-148">The VPN Gateway extends your on-premises network to the Azure VNet.</span></span> <span data-ttu-id="21369-149">您也可以使用 ExpressRoute，其所使用的專用私人連線不會通過公用網際網路。</span><span class="sxs-lookup"><span data-stu-id="21369-149">You can also use ExpressRoute, which uses a dedicated private connection that does not go over the public Internet.</span></span> <span data-ttu-id="21369-150">範例解決方案不會部署閘道。</span><span class="sxs-lookup"><span data-stu-id="21369-150">The example solution does not deploy the gateway.</span></span> <span data-ttu-id="21369-151">如需詳細資訊，請參閱[將內部部署網路連線至 Azure][hybrid-networking]。</span><span class="sxs-lookup"><span data-stu-id="21369-151">For more information, see [Connect an on-premises network to Azure][hybrid-networking].</span></span>

## <a name="recommendations"></a><span data-ttu-id="21369-152">建議</span><span class="sxs-lookup"><span data-stu-id="21369-152">Recommendations</span></span>

<span data-ttu-id="21369-153">您的需求可能不同於這裡所述的架構。</span><span class="sxs-lookup"><span data-stu-id="21369-153">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="21369-154">請使用以下建議作為起點。</span><span class="sxs-lookup"><span data-stu-id="21369-154">Use these recommendations as a starting point.</span></span>

### <a name="load-balancers"></a><span data-ttu-id="21369-155">負載平衡器</span><span class="sxs-lookup"><span data-stu-id="21369-155">Load balancers</span></span>

<span data-ttu-id="21369-156">[SAP Web 發送器][sap-dispatcher]會處理 HTTP(S) 到雙重堆疊伺服器 (ABAP 和 Java) 流量的負載平衡。</span><span class="sxs-lookup"><span data-stu-id="21369-156">[SAP Web Dispatcher][sap-dispatcher] handles load balancing of HTTP(S) traffic to dual-stack servers (ABAP and Java).</span></span> <span data-ttu-id="21369-157">SAP 多年來持續提倡單一堆疊應用程式伺服器，因此現今在雙重堆疊部署模型上執行的應用程式非常稀少。</span><span class="sxs-lookup"><span data-stu-id="21369-157">SAP has advocated single-stack application servers for years, so very few applications run on a dual-stack deployment model nowadays.</span></span> <span data-ttu-id="21369-158">架構圖中所示的 Azure 負載平衡器會實作高可用性叢集的 SAP Web Dispatcher。</span><span class="sxs-lookup"><span data-stu-id="21369-158">The Azure load balancer shown in the architecture diagram implements the high availability cluster for the SAP Web Dispatcher.</span></span>

<span data-ttu-id="21369-159">會在 SAP 內處理流向應用程式伺服器的流量負載平衡。</span><span class="sxs-lookup"><span data-stu-id="21369-159">Load balancing of traffic to the application servers is handled within SAP.</span></span> <span data-ttu-id="21369-160">針對從 SAPGUI 用戶端透過 DIAG 和遠端函式呼叫 (RFC) 連線到 SAP 伺服器的流量，SCS 訊息伺服器會建立 SAP 應用程式伺服器[登入群組][logon-groups]來平衡負載。</span><span class="sxs-lookup"><span data-stu-id="21369-160">For traffic from SAPGUI clients connecting to a SAP server via DIAG and Remote Function Calls (RFC), the SCS message server balances the load by creating SAP App Server [Logon Groups][logon-groups].</span></span> 

<span data-ttu-id="21369-161">SMLG 是 SAP ABAP 交易，可用來管理 SAP 中央服務的登入負載平衡功能。</span><span class="sxs-lookup"><span data-stu-id="21369-161">SMLG is an SAP ABAP transaction used to manage the logon load balancing capability of SAP Central Services.</span></span> <span data-ttu-id="21369-162">登入群組的後端集區具有一個以上的 ABAP 應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="21369-162">The backend pool of the logon group has more than one ABAP application server.</span></span> <span data-ttu-id="21369-163">存取 ASCS 叢集服務的用戶端會透過前端 IP 位址連線到 Azure 負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="21369-163">Clients accessing ASCS cluster services connect to the Azure load balancer through a frontend IP address.</span></span> <span data-ttu-id="21369-164">ASCS 叢集虛擬網路名稱也有一個 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="21369-164">The ASCS cluster virtual network name also has an IP address.</span></span> <span data-ttu-id="21369-165">(選擇性) 此位址可與 Azure 負載平衡器上的其他 IP 位址相關聯，讓您可以從遠端管理叢集。</span><span class="sxs-lookup"><span data-stu-id="21369-165">Optionally, this address can be associated with an additional IP address on the Azure load balancer, so that the cluster can be managed remotely.</span></span>  

### <a name="nics"></a><span data-ttu-id="21369-166">NIC</span><span class="sxs-lookup"><span data-stu-id="21369-166">NICs</span></span>

<span data-ttu-id="21369-167">SAP 橫向管理函式需要在不同的 NIC 上隔離伺服器流量。</span><span class="sxs-lookup"><span data-stu-id="21369-167">SAP landscape management functions require segregation of server traffic on different NICs.</span></span> <span data-ttu-id="21369-168">例如，商務資料應該與管理流量和備份資料傳輸區隔。</span><span class="sxs-lookup"><span data-stu-id="21369-168">For example, business data should be separated from administrative traffic and backup traffic.</span></span> <span data-ttu-id="21369-169">將多個 NIC 指派給不同的子網路即可進行此資料隔離。</span><span class="sxs-lookup"><span data-stu-id="21369-169">Assigning multiple NICs to different subnets enables this data segregation.</span></span> <span data-ttu-id="21369-170">如需詳細資訊，請參閱[建置高可用性的 SAP NetWeaver 和 SAP HANA][sap-ha] (PDF) 中的「網路」。</span><span class="sxs-lookup"><span data-stu-id="21369-170">For more information, see "Network" in [Building High Availability for SAP NetWeaver and SAP HANA][sap-ha] (PDF).</span></span>

<span data-ttu-id="21369-171">將管理 NIC 指派給管理子網路，並將資料通訊 NIC 指派給不同的子網路。</span><span class="sxs-lookup"><span data-stu-id="21369-171">Assign the administration NIC to the management subnet, and assign the data communication NIC to a separate subnet.</span></span> <span data-ttu-id="21369-172">如需組態的詳細資訊，請參閱[建立及管理具有多個 NIC 的 Windows 虛擬機器][multiple-vm-nics]。</span><span class="sxs-lookup"><span data-stu-id="21369-172">For configuration details, see [Create and manage a Windows virtual machine that has multiple NICs][multiple-vm-nics].</span></span>

### <a name="azure-storage"></a><span data-ttu-id="21369-173">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="21369-173">Azure Storage</span></span>

<span data-ttu-id="21369-174">利用所有的資料庫伺服器 VM，建議您使用 Azure 進階儲存體以獲得一致的讀取/寫入延遲。</span><span class="sxs-lookup"><span data-stu-id="21369-174">With all database server VMs, we recommend using Azure Premium Storage for consistent read/write latency.</span></span> <span data-ttu-id="21369-175">針對 SAP 應用程式伺服器 (包括 (A)SCS 虛擬機器)，您可以使用 Azure 標準儲存體，因為應用程式的執行會發生在記憶體中，並只會使用磁碟來記錄。</span><span class="sxs-lookup"><span data-stu-id="21369-175">For SAP application servers, including the (A)SCS virtual machines, you can use Azure Standard Storage, because application execution takes place in memory and uses disks for logging only.</span></span>

<span data-ttu-id="21369-176">為擁有最佳可靠性，建議您使用 [Azure 受控磁碟][managed-disks]。</span><span class="sxs-lookup"><span data-stu-id="21369-176">For best reliability, we recommend using [Azure Managed Disks][managed-disks].</span></span> <span data-ttu-id="21369-177">受控磁碟可確保可用性設定組內的虛擬機器磁碟是各自獨立的，以避免發生單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="21369-177">Managed disks ensure that the disks for VMs within an availability set are isolated to avoid single points of failure.</span></span>

> [!NOTE]
> <span data-ttu-id="21369-178">目前，此參考架構的 Resource Manager 範本並未使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="21369-178">Currently the Resource Manager template for this reference architecture does not use managed disks.</span></span> <span data-ttu-id="21369-179">我們正計劃更新範本以使用受控磁碟。</span><span class="sxs-lookup"><span data-stu-id="21369-179">We are planning to update the template to use managed disks.</span></span>

<span data-ttu-id="21369-180">若要達到高 IOPS 和磁碟頻寬輸送量，可將儲存體磁碟區效能最佳化的常見做法套用於 Azure 儲存體配置。</span><span class="sxs-lookup"><span data-stu-id="21369-180">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume performance optimization apply to Azure storage layout.</span></span> <span data-ttu-id="21369-181">例如，將多個磁碟串接在一起來建立較大的磁碟區，能夠改善 IO 效能。</span><span class="sxs-lookup"><span data-stu-id="21369-181">For example, striping multiple disks together to create a larger disk volume improves IO performance.</span></span> <span data-ttu-id="21369-182">在不常變更的儲存體內容上啟用讀取快取，能夠增強資料擷取的速度。</span><span class="sxs-lookup"><span data-stu-id="21369-182">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span> <span data-ttu-id="21369-183">如需有關效能需求的詳細資訊，請參閱 [SAP 附註 1943937 - 硬體設定檢查工具][sap-1943937]。</span><span class="sxs-lookup"><span data-stu-id="21369-183">For details about performance requirements, see [SAP note 1943937 - Hardware Configuration Check Tool][sap-1943937].</span></span>

<span data-ttu-id="21369-184">針對備份資料存放區，建議使用 Azure Blob 儲存體的[非經常性存取層][cool-blob-storage]。</span><span class="sxs-lookup"><span data-stu-id="21369-184">For the backup data store, we recommend using the [cool storage tier][cool-blob-storage] of Azure Blob storage.</span></span> <span data-ttu-id="21369-185">對於儲存較不常存取且長時間執行的資料，非經常性儲存層是符合成本效益的方式。</span><span class="sxs-lookup"><span data-stu-id="21369-185">The cool storage tier is a cost-effective way to store data that is less frequently accessed and long-lived.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="21369-186">延展性考量</span><span class="sxs-lookup"><span data-stu-id="21369-186">Scalability considerations</span></span>

<span data-ttu-id="21369-187">在 SAP 應用程式層中，Azure 會提供各種不同的虛擬機器大小可進行相應增加。</span><span class="sxs-lookup"><span data-stu-id="21369-187">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up.</span></span> <span data-ttu-id="21369-188">如需完整清單，請參閱 [SAP 附註 1928533 - Azure 上的 SAP 應用程式︰支援的產品和 Azure VM 類型][sap-1928533]。</span><span class="sxs-lookup"><span data-stu-id="21369-188">For an inclusive list, see [SAP note 1928533 - SAP Applications on Azure: Supported Products and Azure VM Types][sap-1928533].</span></span> <span data-ttu-id="21369-189">將多個 VM 新增至可用性設定組來相應放大。</span><span class="sxs-lookup"><span data-stu-id="21369-189">Scale out by adding more VMs to the availability set.</span></span>

<span data-ttu-id="21369-190">針對包含 OLTP 與 OLAP SAP 應用程式之 Azure 虛擬機器上的 SAP HANA，SAP 認證的虛擬機器大小為 GS5，並具有單一 VM 執行個體。</span><span class="sxs-lookup"><span data-stu-id="21369-190">For SAP HANA on Azure virtual machines with both OLTP and OLAP SAP applications, the SAP-certified virtual machine size is GS5 with a single VM instance.</span></span> <span data-ttu-id="21369-191">對於較大的工作負載，Microsoft 也會針對共置在 Microsoft Azure 認證資料中心之實體伺服器上的 SAP HANA 提供 [Azure 大型執行個體][azure-large-instances]，目前能為單一執行個體提供最多 4 TB 的記憶體容量。</span><span class="sxs-lookup"><span data-stu-id="21369-191">For larger workloads, Microsoft also offers [Azure Large Instances][azure-large-instances] for SAP HANA on physical servers co-located in a Microsoft Azure certified datacenter, which provides up to 4 TB of memory capacity for a single instance at this time.</span></span> <span data-ttu-id="21369-192">多重節點組態也可具有多達 32 TB 的記憶體總容量。</span><span class="sxs-lookup"><span data-stu-id="21369-192">Multi-node configuration is also possible with a total memory capacity of up to 32 TB.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="21369-193">可用性考量</span><span class="sxs-lookup"><span data-stu-id="21369-193">Availability considerations</span></span>

<span data-ttu-id="21369-194">在集中式資料庫上的 SAP 應用程式的這個分散式安裝中，會複寫基底安裝來達到高可用性。</span><span class="sxs-lookup"><span data-stu-id="21369-194">In this distributed installation of the SAP application on a centralized database, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="21369-195">針對每一層的架構，高可用性設計會有所不同：</span><span class="sxs-lookup"><span data-stu-id="21369-195">For each layer of the architecture, the high availability design varies:</span></span>

- <span data-ttu-id="21369-196">**Web Dispatcher。**</span><span class="sxs-lookup"><span data-stu-id="21369-196">**Web Dispatcher.**</span></span> <span data-ttu-id="21369-197">透過備援 SAP Web Dispatcher 執行個體與 SAP 應用程式流量來達到高可用性。</span><span class="sxs-lookup"><span data-stu-id="21369-197">High availability is achieved with redundant SAP Web Dispatcher instances with SAP application traffic.</span></span> <span data-ttu-id="21369-198">請參閱 SAP 文件中的 [SAP Web 發送器][swd]。</span><span class="sxs-lookup"><span data-stu-id="21369-198">See [SAP Web Dispatcher][swd] in the SAP Documentation.</span></span>

- <span data-ttu-id="21369-199">**ASCS。**</span><span class="sxs-lookup"><span data-stu-id="21369-199">**ASCS.**</span></span> <span data-ttu-id="21369-200">針對 Azure Windows 虛擬機器上的 ASCS 高可用性，Windows Server 容錯移轉叢集會與 SIOS DataKeeper 搭配使用，以實作叢集共用磁碟區。</span><span class="sxs-lookup"><span data-stu-id="21369-200">For high availability of ASCS on Azure Windows virtual machines, Windows Sever Failover Clustering is used with SIOS DataKeeper to implement the cluster shared volume.</span></span> <span data-ttu-id="21369-201">如需實作詳細資料，請參閱[在 Azure 上叢集 SAP ASCS][clustering]。</span><span class="sxs-lookup"><span data-stu-id="21369-201">For implementation details, see [Clustering SAP ASCS on Azure][clustering].</span></span>

- <span data-ttu-id="21369-202">**應用程式伺服器。**</span><span class="sxs-lookup"><span data-stu-id="21369-202">**Application servers.**</span></span> <span data-ttu-id="21369-203">藉由應用程式伺服器集區內的負載平衡流量來達到高可用性。</span><span class="sxs-lookup"><span data-stu-id="21369-203">High availability is achieved by load balancing traffic within a pool of application servers.</span></span>

- <span data-ttu-id="21369-204">**資料庫層。**</span><span class="sxs-lookup"><span data-stu-id="21369-204">**Database tier.**</span></span> <span data-ttu-id="21369-205">此參考架構會部署單一 SAP HANA 資料庫執行個體。</span><span class="sxs-lookup"><span data-stu-id="21369-205">This reference architecture deploys a single SAP HANA database instance.</span></span> <span data-ttu-id="21369-206">針對高可用性，部署多個執行個體，並使用 HANA 系統複寫 (HSR) 來實作手動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="21369-206">For high availability, deploy more than one instance and use HANA System Replication (HSR) to implement manual failover.</span></span> <span data-ttu-id="21369-207">若要啟用自動容錯移轉，需要適用於特定 Linux 發佈的 HA 延伸模組。</span><span class="sxs-lookup"><span data-stu-id="21369-207">To enable automatic failover, an HA extension for the specific Linux distribution is required.</span></span>

### <a name="disaster-recovery-considerations"></a><span data-ttu-id="21369-208">災害復原考量</span><span class="sxs-lookup"><span data-stu-id="21369-208">Disaster recovery considerations</span></span>

<span data-ttu-id="21369-209">每一層會使用不同的策略來提供災害復原 (DR) 保護。</span><span class="sxs-lookup"><span data-stu-id="21369-209">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="21369-210">**應用程式伺服器。**</span><span class="sxs-lookup"><span data-stu-id="21369-210">**Application servers.**</span></span> <span data-ttu-id="21369-211">SAP 應用程式伺服器不包含商務資料。</span><span class="sxs-lookup"><span data-stu-id="21369-211">SAP application servers don't contain business data.</span></span> <span data-ttu-id="21369-212">在 Azure 上，簡易 DR 策略是在另一個區域建立 SAP 應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="21369-212">On Azure, a simple DR strategy is to create SAP application servers in another region.</span></span> <span data-ttu-id="21369-213">在主要應用程式伺服器上進行任何組態變更或核心更新時，必須將相同的變更複製到 DR 區域中的 VM。</span><span class="sxs-lookup"><span data-stu-id="21369-213">Upon any configuration changes or kernel updates on the primary application server, the same changes must be copied to VMs in the DR region.</span></span> <span data-ttu-id="21369-214">例如，核心可執行檔複製到 DR VM。</span><span class="sxs-lookup"><span data-stu-id="21369-214">For example, the kernel executables copied to the DR VMs.</span></span>

- <span data-ttu-id="21369-215">**SAP 中央服務。**</span><span class="sxs-lookup"><span data-stu-id="21369-215">**SAP Central Services.**</span></span> <span data-ttu-id="21369-216">這個 SAP 應用程式堆疊的元件也不會保存商務資料。</span><span class="sxs-lookup"><span data-stu-id="21369-216">This component of the SAP application stack also doesn't persist business data.</span></span> <span data-ttu-id="21369-217">您可以在 DR 區域中建置 VM 來執行 SCS 角色。</span><span class="sxs-lookup"><span data-stu-id="21369-217">You can build a VM in the DR region to run the SCS role.</span></span> <span data-ttu-id="21369-218">主要 SCS 節點中同步處理的唯一內容是 **/sapmnt** 共用內容。</span><span class="sxs-lookup"><span data-stu-id="21369-218">The only content from the primary SCS node to synchronize is the **/sapmnt** share content.</span></span> <span data-ttu-id="21369-219">此外，如果組態變更或核心更新在主要 SCS 伺服器上進行，它們就必須在 DR SCS 上重複。</span><span class="sxs-lookup"><span data-stu-id="21369-219">Also, if configuration changes or kernel updates take place on the primary SCS servers, they must be repeated on the DR SCS.</span></span> <span data-ttu-id="21369-220">若要將兩部伺服器同步，只需使用定期排程的複製作業將 **/sapmnt** 複製到 DR 端。</span><span class="sxs-lookup"><span data-stu-id="21369-220">To synchronize the two servers, simply use a regularly scheduled copy job to copy **/sapmnt** to the DR side.</span></span> <span data-ttu-id="21369-221">如需組建、複製及測試容錯移轉程序的詳細資訊，請下載 [SAP NetWeaver：建置 Hyper-V 和以 Microsoft Azure 作為基礎的災害復原解決方案][sap-netweaver-dr]，並參考「4.3.</span><span class="sxs-lookup"><span data-stu-id="21369-221">For details about the build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution][sap-netweaver-dr], and refer to "4.3.</span></span> <span data-ttu-id="21369-222">SAP SPOF layer (ASCS)。」</span><span class="sxs-lookup"><span data-stu-id="21369-222">SAP SPOF layer (ASCS)."</span></span>

- <span data-ttu-id="21369-223">**資料庫層。**</span><span class="sxs-lookup"><span data-stu-id="21369-223">**Database tier.**</span></span> <span data-ttu-id="21369-224">使用 HANA 支援的複寫解決方案，例如 HSR 或儲存體複寫。</span><span class="sxs-lookup"><span data-stu-id="21369-224">Use HANA-supported replication solutions such as HSR or Storage Replication.</span></span> 

## <a name="manageability-considerations"></a><span data-ttu-id="21369-225">管理性考量</span><span class="sxs-lookup"><span data-stu-id="21369-225">Manageability considerations</span></span>

<span data-ttu-id="21369-226">SAP HANA 具有備份功能，是使用基本 Azure 基礎結構。</span><span class="sxs-lookup"><span data-stu-id="21369-226">SAP HANA has a backup feature that uses the underlying Azure infrastructure.</span></span> <span data-ttu-id="21369-227">若要備份在 Azure 虛擬機器上執行的 SAP HANA 資料庫，就要使用 SAP HANA 快照集和 Azure 儲存體快照集來確保備份檔案的一致性。</span><span class="sxs-lookup"><span data-stu-id="21369-227">To back up the SAP HANA database running on Azure virtual machines, both the SAP HANA snapshot and Azure storage snapshot are used to ensure the consistency of backup files.</span></span> <span data-ttu-id="21369-228">如需詳細資訊，請參閱[Azure 虛擬機器上的 SAP HANA 備份指南][hana-backup]和[Azure 備份服務常見問題集][backup-faq]。</span><span class="sxs-lookup"><span data-stu-id="21369-228">For details, see [Backup guide for SAP HANA on Azure Virtual Machines][hana-backup] and the [Azure Backup service FAQ][backup-faq].</span></span>

<span data-ttu-id="21369-229">Azure 會提供幾個函式來[監視和診斷][monitoring]整體基礎結構。</span><span class="sxs-lookup"><span data-stu-id="21369-229">Azure provides several functions for [monitoring and diagnostics][monitoring] of the overall infrastructure.</span></span> <span data-ttu-id="21369-230">此外，Azure 虛擬機器 (Linux 或 Windows) 的增強型監視會由 Azure Operations Management Suite (OMS) 處理。</span><span class="sxs-lookup"><span data-stu-id="21369-230">Also, enhanced monitoring of Azure virtual machines (Linux or Windows) is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="21369-231">若要提供以 SAP 作為基礎的 SAP 基礎結構之資源與服務效能監視，請使用「Azure SAP 強化監視」延伸模組。</span><span class="sxs-lookup"><span data-stu-id="21369-231">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, use the Azure SAP Enhanced Monitoring extension.</span></span> <span data-ttu-id="21369-232">此延伸模組會將 Azure 監視統計資料輸入 SAP 應用程式，以進行作業系統監視和 DBA Cockpit 函式。</span><span class="sxs-lookup"><span data-stu-id="21369-232">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span> 

## <a name="security-considerations"></a><span data-ttu-id="21369-233">安全性考量</span><span class="sxs-lookup"><span data-stu-id="21369-233">Security considerations</span></span>

<span data-ttu-id="21369-234">SAP 有它自己的「使用者管理引擎 (UME)」，可控制角色型存取和 SAP 應用程式內的授權。</span><span class="sxs-lookup"><span data-stu-id="21369-234">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="21369-235">如需詳細資訊，請參閱 [SAP HANA 安全性 - 概觀][sap-security]。</span><span class="sxs-lookup"><span data-stu-id="21369-235">For details, see [SAP HANA Security - An Overview][sap-security].</span></span> <span data-ttu-id="21369-236">(需要 SAP Service Marketplace 帳戶才能進行存取。)</span><span class="sxs-lookup"><span data-stu-id="21369-236">(A SAP Service Marketplace account is required for access.)</span></span>

<span data-ttu-id="21369-237">針對基礎結構安全性，資料在傳輸中和靜止時會受到保護。</span><span class="sxs-lookup"><span data-stu-id="21369-237">For infrastructure security, data is safeguarded in transit and at rest.</span></span> <span data-ttu-id="21369-238">[Azure 虛擬機器 (VM) 上的 SAP NetWeaver - 規劃和實作指南][netweaver-on-azure]的「安全性考量」一節會開始說明網路安全性。</span><span class="sxs-lookup"><span data-stu-id="21369-238">The “Security considerations” section of the [SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide][netweaver-on-azure] begins to address network security.</span></span> <span data-ttu-id="21369-239">本指南也會指定您在防火牆上必須開啟才能允許應用程式通訊的網路連接埠。</span><span class="sxs-lookup"><span data-stu-id="21369-239">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span> 

<span data-ttu-id="21369-240">如需加密 Windows 和 Linux IaaS 虛擬機器磁碟，您可以使用 [Azure 磁碟加密][disk-encryption]。</span><span class="sxs-lookup"><span data-stu-id="21369-240">To encrypt Windows and Linux IaaS virtual machine disks, you can use [Azure Disk Encryption][disk-encryption].</span></span> <span data-ttu-id="21369-241">Azure 磁碟加密使用 Windows 的 BitLocker 功能和 Linux 的 DM-Crypt 功能，為作業系統和資料磁碟提供磁碟區加密。</span><span class="sxs-lookup"><span data-stu-id="21369-241">Azure Disk Encryption uses the BitLocker feature of Windows and the DM-Crypt feature of Linux to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="21369-242">此解決方案也可與 Azure Key Vault 搭配使用，協助您控制及管理 Key Vault 訂用帳戶中的磁碟加密金鑰與祕密。</span><span class="sxs-lookup"><span data-stu-id="21369-242">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your Key Vault subscription.</span></span> <span data-ttu-id="21369-243">虛擬機器磁碟上的所有待用資料都會在您的 Azure 儲存體中加密。</span><span class="sxs-lookup"><span data-stu-id="21369-243">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

<span data-ttu-id="21369-244">針對 SAP HANA 靜止資料加密，建議您使用 SAP HANA 原生加密技術。</span><span class="sxs-lookup"><span data-stu-id="21369-244">For SAP HANA data-at-rest encryption, we recommend using the SAP HANA native encryption technology.</span></span>

> [!NOTE]
> <span data-ttu-id="21369-245">請勿在相同的伺服器上使用 HANA 靜止資料加密搭配 Azure 磁碟加密。</span><span class="sxs-lookup"><span data-stu-id="21369-245">Don't use the HANA data-at-rest encryption with Azure disk encryption on the same server.</span></span>

<span data-ttu-id="21369-246">請考慮使用[網路安全性群組][nsg] (NSG) 來限制 VNet 中各種子網路之間的流量。</span><span class="sxs-lookup"><span data-stu-id="21369-246">Consider using [network security groups][nsg] (NSGs) to restrict traffic between the various subnets in the VNet.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="21369-247">部署解決方案</span><span class="sxs-lookup"><span data-stu-id="21369-247">Deploy the solution</span></span> 

<span data-ttu-id="21369-248">此參考架構的部署指令碼可在 [GitHub][github] 上取得。</span><span class="sxs-lookup"><span data-stu-id="21369-248">The deployment scripts for this reference architecture are available on [GitHub][github].</span></span>


### <a name="prerequisites"></a><span data-ttu-id="21369-249">必要條件</span><span class="sxs-lookup"><span data-stu-id="21369-249">Prerequisites</span></span>

- <span data-ttu-id="21369-250">您必須能夠存取 SAP 軟體下載中心才能完成安裝。</span><span class="sxs-lookup"><span data-stu-id="21369-250">You must have access to the SAP Software Download Center to complete the installation.</span></span>
 
- <span data-ttu-id="21369-251">安裝最新版的 [Azure PowerShell][azure-ps]。</span><span class="sxs-lookup"><span data-stu-id="21369-251">Install the latest version of [Azure PowerShell][azure-ps].</span></span> 

- <span data-ttu-id="21369-252">此部署需要 51 個核心。</span><span class="sxs-lookup"><span data-stu-id="21369-252">This deployment requires 51 cores.</span></span> <span data-ttu-id="21369-253">在部署之前，請確認您的訂用帳戶具有足夠的配額可供 VM 核心使用。</span><span class="sxs-lookup"><span data-stu-id="21369-253">Before deploying, verify that your subscription has sufficient quota for VM cores.</span></span> <span data-ttu-id="21369-254">否則，請使用 Azure 入口網站來提交支援要求以取得更多配額。</span><span class="sxs-lookup"><span data-stu-id="21369-254">If not, use the Azure portal to submit a support request for more quota.</span></span>
 
- <span data-ttu-id="21369-255">此部署會使用 GS 系列 VM。</span><span class="sxs-lookup"><span data-stu-id="21369-255">This deployment uses a GS-series VM.</span></span> <span data-ttu-id="21369-256">在[這裡][region-availability]依區域檢查 GS 系列的可用性。</span><span class="sxs-lookup"><span data-stu-id="21369-256">Check the availability of the GS series per region [here][region-availability].</span></span>

- <span data-ttu-id="21369-257">若要預估此部署的成本，請參閱 [Azure 定價計算機][azure-pricing]。</span><span class="sxs-lookup"><span data-stu-id="21369-257">To estimate the cost of this deployment, see the [Azure Pricing Calculator][azure-pricing].</span></span> 
 
<span data-ttu-id="21369-258">此參考架構會部署下列 VM：</span><span class="sxs-lookup"><span data-stu-id="21369-258">This reference architecture deploys the following VMs:</span></span>

| <span data-ttu-id="21369-259">資源名稱</span><span class="sxs-lookup"><span data-stu-id="21369-259">Resource name</span></span> | <span data-ttu-id="21369-260">VM 大小</span><span class="sxs-lookup"><span data-stu-id="21369-260">VM Size</span></span> | <span data-ttu-id="21369-261">目的</span><span class="sxs-lookup"><span data-stu-id="21369-261">Purpose</span></span>  |
|---------------|---------|----------|
| <span data-ttu-id="21369-262">`ra-sapApps-scs-vm1` ... `ra-sapApps-scs-vmN`</span><span class="sxs-lookup"><span data-stu-id="21369-262">`ra-sapApps-scs-vm1` ... `ra-sapApps-scs-vmN`</span></span> | <span data-ttu-id="21369-263">DS11v2</span><span class="sxs-lookup"><span data-stu-id="21369-263">DS11v2</span></span> | <span data-ttu-id="21369-264">SAP 中央服務</span><span class="sxs-lookup"><span data-stu-id="21369-264">SAP Central Services</span></span> |
| <span data-ttu-id="21369-265">`ra-sapApps-vm1` ... `ra-sapApps-vmN`</span><span class="sxs-lookup"><span data-stu-id="21369-265">`ra-sapApps-vm1` ... `ra-sapApps-vmN`</span></span> | <span data-ttu-id="21369-266">DS11v2</span><span class="sxs-lookup"><span data-stu-id="21369-266">DS11v2</span></span> | <span data-ttu-id="21369-267">SAP NetWeaver 應用程式</span><span class="sxs-lookup"><span data-stu-id="21369-267">SAP NetWeaver application</span></span> |
| <span data-ttu-id="21369-268">`ra-sap-wdp-vm1` ... `ra-sap-wdp-vmN`</span><span class="sxs-lookup"><span data-stu-id="21369-268">`ra-sap-wdp-vm1` ... `ra-sap-wdp-vmN`</span></span> | <span data-ttu-id="21369-269">DS11v2</span><span class="sxs-lookup"><span data-stu-id="21369-269">DS11v2</span></span> | <span data-ttu-id="21369-270">SAP Web Dispatcher</span><span class="sxs-lookup"><span data-stu-id="21369-270">SAP Web Dispatcher</span></span> |
| `ra-sap-data-vm1` | <span data-ttu-id="21369-271">GS5</span><span class="sxs-lookup"><span data-stu-id="21369-271">GS5</span></span> | <span data-ttu-id="21369-272">SAP HANA 資料庫執行個體</span><span class="sxs-lookup"><span data-stu-id="21369-272">SAP HANA database instance</span></span> |
| `ra-sap-jumpbox-vm1` | <span data-ttu-id="21369-273">DS1V2</span><span class="sxs-lookup"><span data-stu-id="21369-273">DS1V2</span></span> | <span data-ttu-id="21369-274">Jumpbox</span><span class="sxs-lookup"><span data-stu-id="21369-274">Jumpbox</span></span> |

<span data-ttu-id="21369-275">會部署單一的 SAP HANA 執行個體。</span><span class="sxs-lookup"><span data-stu-id="21369-275">A single SAP HANA instance is deployed.</span></span> <span data-ttu-id="21369-276">針對應用程式 VM，會在範本參數中指定要部署的執行個體數目。</span><span class="sxs-lookup"><span data-stu-id="21369-276">For the application VMs, the number of instances to deploy is specified in the template parameters.</span></span>

### <a name="deploy-sap-infrastructure"></a><span data-ttu-id="21369-277">部署 SAP 基礎結構</span><span class="sxs-lookup"><span data-stu-id="21369-277">Deploy SAP infrastructure</span></span>

<span data-ttu-id="21369-278">您可以以累加方式或一次全部部署此架構。</span><span class="sxs-lookup"><span data-stu-id="21369-278">You can deploy this architecture incrementally or all at once.</span></span> <span data-ttu-id="21369-279">第一次，建議您使用累加式部署，以便您看到每個部署步驟的執行方式。</span><span class="sxs-lookup"><span data-stu-id="21369-279">The first time, we recommend an incremental deployment, so that you can see what each deployment step does.</span></span> <span data-ttu-id="21369-280">使用下列其中一個 mode 參數來指定增量</span><span class="sxs-lookup"><span data-stu-id="21369-280">Specify the increment using one of the following *mode* parameters</span></span>

| <span data-ttu-id="21369-281">模式</span><span class="sxs-lookup"><span data-stu-id="21369-281">Mode</span></span>           | <span data-ttu-id="21369-282">作用</span><span class="sxs-lookup"><span data-stu-id="21369-282">What it does</span></span>                                                                                                            |
|----------------|-----------------------------------------------------|
| <span data-ttu-id="21369-283">基礎結構</span><span class="sxs-lookup"><span data-stu-id="21369-283">infrastructure</span></span> | <span data-ttu-id="21369-284">在 Azure 中部署網路基礎結構。</span><span class="sxs-lookup"><span data-stu-id="21369-284">Deploys the network infrastructure in Azure.</span></span>        |
| <span data-ttu-id="21369-285">工作負載</span><span class="sxs-lookup"><span data-stu-id="21369-285">workload</span></span>       | <span data-ttu-id="21369-286">將 SAP 伺服器部署至網路。</span><span class="sxs-lookup"><span data-stu-id="21369-286">Deploys the SAP servers to the network.</span></span>             |
| <span data-ttu-id="21369-287">所有</span><span class="sxs-lookup"><span data-stu-id="21369-287">all</span></span>            | <span data-ttu-id="21369-288">部署所有先前的部署。</span><span class="sxs-lookup"><span data-stu-id="21369-288">Deploys all the preceding deployments.</span></span>              |

<span data-ttu-id="21369-289">若要部署解決方案，請執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="21369-289">To deploy the solution, perform the following steps:</span></span>

1. <span data-ttu-id="21369-290">將 [GitHub 存放庫][github]下載或複製到本機電腦。</span><span class="sxs-lookup"><span data-stu-id="21369-290">Download or clone the [GitHub repo][github] to your local computer.</span></span>

2. <span data-ttu-id="21369-291">開啟 PowerShell 視窗並瀏覽至 `/sap/sap-hana/` 資料夾。</span><span class="sxs-lookup"><span data-stu-id="21369-291">Open a PowerShell window and navigate to the `/sap/sap-hana/` folder.</span></span>

3. <span data-ttu-id="21369-292">執行下列 PowerShell Cmdlet。</span><span class="sxs-lookup"><span data-stu-id="21369-292">Run the following PowerShell cmdlet.</span></span> <span data-ttu-id="21369-293">針對 `<subscription id>`，請使用您的 Azure 訂用帳戶 ID。</span><span class="sxs-lookup"><span data-stu-id="21369-293">For `<subscription id>`, use your Azure subscription ID.</span></span> <span data-ttu-id="21369-294">針對 `<location>`，請指定 Azure 區域，例如 `eastus` 或 `westus`。</span><span class="sxs-lookup"><span data-stu-id="21369-294">For `<location>`, specify an Azure region, such as `eastus` or `westus`.</span></span> <span data-ttu-id="21369-295">針對 `<mode>`，請指定一個以上所列的模式。</span><span class="sxs-lookup"><span data-stu-id="21369-295">For `<mode>`, specify one of the modes listed above.</span></span>

    ```powershell
     .\Deploy-ReferenceArchitecture -SubscriptionId <subscription id> -Location <location> -ResourceGroupName <resource group> <mode>
    ```

4.  <span data-ttu-id="21369-296">出現系統時，請登入您的 Azure 帳戶。</span><span class="sxs-lookup"><span data-stu-id="21369-296">When prompted, log on to your Azure account.</span></span> 

<span data-ttu-id="21369-297">部署指令碼可能需要數小時才能完成，視您選取的模式而定。</span><span class="sxs-lookup"><span data-stu-id="21369-297">The deployment scripts can take up to several hours to complete, depending on the mode you selected.</span></span>

> [!WARNING]
> <span data-ttu-id="21369-298">參數檔案會在不同位置中包含硬式編碼的密碼 (`AweS0me@PW`)。</span><span class="sxs-lookup"><span data-stu-id="21369-298">The parameter files include a hard-coded password (`AweS0me@PW`) in various places.</span></span> <span data-ttu-id="21369-299">在部署之前，請變更這些值。</span><span class="sxs-lookup"><span data-stu-id="21369-299">Change these values before you deploy.</span></span>
 
### <a name="configure-sap-applications-and-database"></a><span data-ttu-id="21369-300">設定 SAP 應用程式和資料庫</span><span class="sxs-lookup"><span data-stu-id="21369-300">Configure SAP applications and database</span></span>

<span data-ttu-id="21369-301">部署 SAP 基礎結構之後，請在虛擬機器上安裝及設定您的 SAP 應用程式和 HANA 資料庫，如下所示。</span><span class="sxs-lookup"><span data-stu-id="21369-301">After deploying the SAP infrastructure, install and configure your SAP applications and HANA database on the virtual machines as follows.</span></span>

> [!NOTE]
> <span data-ttu-id="21369-302">如需 SAP 安裝指示，您必須擁有 SAP 支援入口網站的使用者名稱和密碼，才能下載 [SAP 安裝指南][sap-guide]。</span><span class="sxs-lookup"><span data-stu-id="21369-302">For SAP installation instructions, you must have a SAP Support Portal username and password to download the [SAP installation guides][sap-guide].</span></span>

1. <span data-ttu-id="21369-303">登入 jumpbox (`ra-sap-jumpbox-vm1`)。</span><span class="sxs-lookup"><span data-stu-id="21369-303">Log into the jumpbox (`ra-sap-jumpbox-vm1`).</span></span> <span data-ttu-id="21369-304">您將使用 jumpbox 來登入其他 VM。</span><span class="sxs-lookup"><span data-stu-id="21369-304">You will use the jumpbox to log into the other VMs.</span></span> 

2.  <span data-ttu-id="21369-305">針對每個名為 `ra-sap-wdp-vm1` ... `ra-sap-wdp-vmN` 的 VM，登入 VM，然後使用 [Web Dispatcher安裝][sap-dispatcher-install] wiki 中所述的步驟來安裝和設定 SAP Web Dispatcher 執行個體。</span><span class="sxs-lookup"><span data-stu-id="21369-305">For each VM named `ra-sap-wdp-vm1` ... `ra-sap-wdp-vmN`, log into the VM, and install and configure the SAP Web Dispatcher instance using the steps described in the [Web Dispatcher Installation][sap-dispatcher-install] wiki.</span></span>

3.  <span data-ttu-id="21369-306">登入名為 `ra-sap-data-vm1` 的 VM。</span><span class="sxs-lookup"><span data-stu-id="21369-306">Log into the VM named `ra-sap-data-vm1`.</span></span> <span data-ttu-id="21369-307">使用 [SAP HANA 伺服器安裝與更新指南][hana-guide]來安裝和設定 SAP HANA 資料庫執行個體。</span><span class="sxs-lookup"><span data-stu-id="21369-307">Install and configure the SAP Hana Database instance using the [SAP HANA Server Installation and Update Guide][hana-guide].</span></span>

4. <span data-ttu-id="21369-308">針對每個名為 `ra-sapApps-scs-vm1` ... `ra-sapApps-scs-vmN` 的 VM，登入 VM，然後使用 [SAP 安裝指南][sap-guide]來安裝和設定 SAP 中央服務 (SCS)。</span><span class="sxs-lookup"><span data-stu-id="21369-308">For each VM named `ra-sapApps-scs-vm1` ... `ra-sapApps-scs-vmN`, log into the VM, and install and configure the SAP Central Services (SCS) using the [SAP installation guides][sap-guide].</span></span>

5.  <span data-ttu-id="21369-309">針對每個名為 `ra-sapApps-vm1` ... `ra-sapApps-vmN` 的 VM，登入 VM，然後使用 [SAP 安裝指南][sap-guide]來安裝和設定 SAP NetWeaver 應用程式。</span><span class="sxs-lookup"><span data-stu-id="21369-309">For each VM named `ra-sapApps-vm1` ... `ra-sapApps-vmN`, log into the VM, and install and configure the SAP NetWeaver application using the [SAP installation guides][sap-guide].</span></span>

<span data-ttu-id="21369-310">**_此參考架構的參與者_** &mdash; Rick Rainey、Ross Sponholtz、Ben Trinh</span><span class="sxs-lookup"><span data-stu-id="21369-310">**_Contributors to this reference architecture_** &mdash; Rick Rainey, Ross Sponholtz, Ben Trinh</span></span>

[azure-large-instances]: /azure/virtual-machines/workloads/sap/hana-overview-architecture
[azure-lb]: /azure/load-balancer/load-balancer-overview
[azure-pricing]: https://azure.microsoft.com/pricing/calculator/
[azure-ps]: /powershell/azure/overview
[backup-faq]: /azure/backup/backup-azure-backup-faq
[clustering]: https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/
[cool-blob-storage]: /azure/storage/storage-blob-storage-tiers
[disk-encryption]: /azure/security/azure-security-disk-encryption
[github]: https://github.com/mspnp/reference-architectures/tree/master/sap/sap-hana
[hana-backup]: /azure/virtual-machines/workloads/sap/sap-hana-backup-guide
[hana-guide]: https://help.sap.com/viewer/2c1988d620e04368aa4103bf26f17727/2.0.01/en-US/7eb0167eb35e4e2885415205b8383584.html
[hybrid-networking]: ../hybrid-networking/index.md
[logon-groups]: https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing
[managed-disks]: /azure/storage/storage-managed-disks-overview
[monitoring]: /azure/architecture/best-practices/monitoring
[multiple-vm-nics]: /azure/virtual-machines/windows/multiple-nics
[netweaver-on-azure]: /azure/virtual-machines/workloads/sap/planning-guide
[nsg]: /azure/virtual-network/virtual-networks-nsg
[region-availability]: https://azure.microsoft.com/regions/services/
[running-SAP]: https://blogs.msdn.microsoft.com/saponsqlserver/2016/06/07/sap-on-sql-general-update-for-customers-partners-june-2016/
[sap-1943937]: https://launchpad.support.sap.com/#/notes/1943937
[sap-1928533]: https://launchpad.support.sap.com/#/notes/1928533
[sap-dispatcher]: https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm
[sap-dispatcher-ha]: https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/9a9a6b48c673e8e10000000a42189b/frameset.htm
[sap-dispatcher-install]: https://wiki.scn.sap.com/wiki/display/SI/Web+Dispatcher+Installation
[sap-guide]: https://service.sap.com/instguides
[sap-ha]: https://support.sap.com/content/dam/SAAP/SAP_Activate/AGS_70.pdf
[sap-hana-on-azure]: https://azure.microsoft.com/services/virtual-machines/sap-hana/
[sap-netweaver-dr]: http://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx
[sap-security]: https://archive.sap.com/documents/docs/DOC-62943
[visio-download]: https://archcenter.azureedge.net/cdn/SAP-HANA-architecture.vsdx
[vm-sizes-mem]: /azure/virtual-machines/windows/sizes-memory
[swd]: https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm
[0]: ./images/sap-hana.png "使用 Microsoft Azure 的 SAP HANA 架構"
