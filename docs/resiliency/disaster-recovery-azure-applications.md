---
title: Azure 應用程式的災害復原
description: 在 Microsoft Azure 上針對災害復原設計應用程式的相關技術概觀和深度資訊。
author: adamglick
ms.date: 09/12/2018
ms.openlocfilehash: ff5da8a3d2612d7c122ec8ed87979eddf778dbf0
ms.sourcegitcommit: e7e0e0282fa93f0063da3b57128ade395a9c1ef9
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/05/2018
ms.locfileid: "52902845"
---
# <a name="disaster-recovery-for-azure-applications"></a><span data-ttu-id="1912c-103">Azure 應用程式的災害復原</span><span class="sxs-lookup"><span data-stu-id="1912c-103">Disaster recovery for Azure applications</span></span>

<span data-ttu-id="1912c-104">災害復原 (DR) 著重在從應用程式功能的重大損失中復原。</span><span class="sxs-lookup"><span data-stu-id="1912c-104">Disaster recovery (DR) is focused on recovering from a catastrophic loss of application functionality.</span></span> <span data-ttu-id="1912c-105">例如，如果裝載您應用程式的 Azure 區域變得無法使用，您必須有在其他區域執行應用程式或存取資料的計劃。</span><span class="sxs-lookup"><span data-stu-id="1912c-105">For example, if an Azure region hosting your application becomes unavailable, you need a plan for running your application or accessing your data in another region.</span></span> 

<span data-ttu-id="1912c-106">企業和技術擁有者必須決定災害發生期間需要多少功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-106">Business and technology owners must determine how much functionality is required during a disaster.</span></span> <span data-ttu-id="1912c-107">此功能等級可能有一些形式：完全無法使用、部分可用 (透過降級的功能或延遲處理)，或完全可用。</span><span class="sxs-lookup"><span data-stu-id="1912c-107">This level of functionality can take a few forms: completely unavailable, partially available via reduced functionality or delayed processing, or fully available.</span></span>

<span data-ttu-id="1912c-108">復原功能和高可用性策略的目的是要處理暫時性的失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="1912c-108">Resiliency and high availability strategies are intended for handling temporary failure conditions.</span></span>  <span data-ttu-id="1912c-109">執行此計劃會涉及人員、程序，以及可讓系統繼續運作的支援應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-109">Executing this plan involves people, processes, and supporting applications that allow the system to continue functioning.</span></span> <span data-ttu-id="1912c-110">您的計劃應該包括演練失敗和測試資料庫的復原，以確保計劃可靠無虞。</span><span class="sxs-lookup"><span data-stu-id="1912c-110">Your plan should include rehearsing failures and testing the recovery of databases to ensure the plan is sound.</span></span> 

## <a name="azure-disaster-recovery-features"></a><span data-ttu-id="1912c-111">Azure 災害復原功能</span><span class="sxs-lookup"><span data-stu-id="1912c-111">Azure disaster recovery features</span></span>

<span data-ttu-id="1912c-112">和可用性考量一樣，Azure 提供了[復原功能技術指引](./index.md)，以便支援災害復原。</span><span class="sxs-lookup"><span data-stu-id="1912c-112">As with availability considerations, Azure provides [resiliency technical guidance](./index.md) designed to support disaster recovery.</span></span> <span data-ttu-id="1912c-113">Azure 可用性功能與災害復原之間也有關聯性。</span><span class="sxs-lookup"><span data-stu-id="1912c-113">There is also a relationship between availability features of Azure and disaster recovery.</span></span> <span data-ttu-id="1912c-114">例如，各容錯網域的角色管理會增加應用程式的可用性。</span><span class="sxs-lookup"><span data-stu-id="1912c-114">For example, the management of roles across fault domains increases the availability of an application.</span></span> <span data-ttu-id="1912c-115">如果沒有該管理功能，未經處理的硬體故障就會變成「災害」案例。</span><span class="sxs-lookup"><span data-stu-id="1912c-115">Without that management, an unhandled hardware failure would become a “disaster” scenario.</span></span> <span data-ttu-id="1912c-116">利用這些可用性功能和策略是防範您的應用程式發生災害的重要部分。</span><span class="sxs-lookup"><span data-stu-id="1912c-116">Leveraging these availability features and strategies is an important part of disaster-proofing your application.</span></span> <span data-ttu-id="1912c-117">不過，本文不僅討論一般可用性問題，還會討論更嚴重 (和更罕見) 的災害事件。</span><span class="sxs-lookup"><span data-stu-id="1912c-117">However, this article goes beyond general availability issues to more serious (and rarer) disaster events.</span></span>

## <a name="multiple-datacenter-regions"></a><span data-ttu-id="1912c-118">多個資料中心區域</span><span class="sxs-lookup"><span data-stu-id="1912c-118">Multiple datacenter regions</span></span>
<span data-ttu-id="1912c-119">Azure 會維護世界各地許多區域的資料中心。</span><span class="sxs-lookup"><span data-stu-id="1912c-119">Azure maintains datacenters in many regions around the world.</span></span> <span data-ttu-id="1912c-120">此基礎結構可支援數個災害復原案例，例如系統提供的 Azure 儲存體異地複寫到次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-120">This infrastructure supports several disaster recovery scenarios, such as system-provided geo-replication of Azure Storage to secondary regions.</span></span> <span data-ttu-id="1912c-121">您也可以輕鬆且低廉地將雲端服務部署到全世界的多個位置。</span><span class="sxs-lookup"><span data-stu-id="1912c-121">You can also easily and inexpensively deploy a cloud service to multiple locations around the world.</span></span> <span data-ttu-id="1912c-122">將在多個區域中建置和維護自有資料中心的成本與困難度與此做比較。</span><span class="sxs-lookup"><span data-stu-id="1912c-122">Compare this with the cost and difficulty of building and maintaining your own datacenters in multiple regions.</span></span> <span data-ttu-id="1912c-123">將資料和服務部署至多個區域，有助於防止您的應用程式在單一區域中面臨嚴重中斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-123">Deploying data and services to multiple regions helps protect your application from a major outage in a single region.</span></span> <span data-ttu-id="1912c-124">在設計災害復原計劃時，請務必了解配對區域的概念。</span><span class="sxs-lookup"><span data-stu-id="1912c-124">As you design your disaster recovery plan, it’s important to understand the concept of paired regions.</span></span> <span data-ttu-id="1912c-125">如需詳細資訊，請參閱[商務持續性和災害復原 (BCDR)：Azure 配對的區域](/azure/best-practices-availability-paired-regions)。</span><span class="sxs-lookup"><span data-stu-id="1912c-125">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

## <a name="azure-site-recovery"></a><span data-ttu-id="1912c-126">Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="1912c-126">Azure Site Recovery</span></span>

<span data-ttu-id="1912c-127">[Azure Site Recovery](/azure/site-recovery/) 提供在區域之間複寫 Azure VM 的簡易方式。</span><span class="sxs-lookup"><span data-stu-id="1912c-127">[Azure Site Recovery](/azure/site-recovery/) provides a simple way to replicate Azure VMs between regions.</span></span> <span data-ttu-id="1912c-128">其管理負擔最小，因為您不需要在次要地區中佈建任何其他資源。</span><span class="sxs-lookup"><span data-stu-id="1912c-128">It has minimal management overhead, because you don't need to provision any additional resources in the secondary region.</span></span> <span data-ttu-id="1912c-129">當您啟用複寫時，Site Recovery 會根據來源 VM 設定，在目標區域中自動建立所需的資源。</span><span class="sxs-lookup"><span data-stu-id="1912c-129">When you enable replication, Site Recovery automatically creates the required resources in the target region, based on the source VM settings.</span></span> <span data-ttu-id="1912c-130">並提供自動化連續複寫，讓您只要按一下即可執行應用程式容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1912c-130">It provides automated continuous replication, and enables you to perform application failover with a single click.</span></span> <span data-ttu-id="1912c-131">您也可藉由測試容錯移轉來執行災害復原演練，完全不影響生產工作負載或進行中的複寫。</span><span class="sxs-lookup"><span data-stu-id="1912c-131">You can also run disaster recovery drills by testing failover, without affecting your production workloads or ongoing replication.</span></span> 

## <a name="azure-traffic-manager"></a><span data-ttu-id="1912c-132">Azure 流量管理員</span><span class="sxs-lookup"><span data-stu-id="1912c-132">Azure Traffic Manager</span></span>
<span data-ttu-id="1912c-133">發生特定區域的失敗時，您必須將流量重新導向至其他區域中的服務或部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-133">When a region-specific failure occurs, you must redirect traffic to services or deployments in another region.</span></span> <span data-ttu-id="1912c-134">透過 Azure 流量管理員等服務來處理是最有效的方式，如果主要區域失敗，其可自動將使用者的流量容錯移轉至另一個區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-134">It is most effective to handle this via services such as Azure Traffic Manager, which automates the failover of user traffic to another region if the primary region fails.</span></span> <span data-ttu-id="1912c-135">在設計有效的 DR 策略時，請務必了解流量管理員的基本概念。</span><span class="sxs-lookup"><span data-stu-id="1912c-135">Understanding the fundamentals of Traffic Manager is important when designing an effective DR strategy.</span></span>

<span data-ttu-id="1912c-136">流量管理員會使用網域名稱系統 (DNS)，根據流量路由方法和端點的健康情況，將用戶端要求導向到最適當的端點。</span><span class="sxs-lookup"><span data-stu-id="1912c-136">Traffic Manager uses the Domain Name System (DNS) to direct client requests to the most appropriate endpoint based on a traffic-routing method and the health of the endpoints.</span></span> <span data-ttu-id="1912c-137">在下圖中，使用者連線至流量管理員 URL (`http://myATMURL.trafficmanager.net`)，而此 URL 擷取了實際的網站 URL (`http://app1URL.cloudapp.net` 和 `http://app2URL.cloudapp.net`)。</span><span class="sxs-lookup"><span data-stu-id="1912c-137">In the following diagram, users connect to a Traffic Manager URL (`http://myATMURL.trafficmanager.net`) which abstracts the actual site URLs (`http://app1URL.cloudapp.net` and `http://app2URL.cloudapp.net`).</span></span> <span data-ttu-id="1912c-138">根據您設定的[流量管理員路由方法](/azure/traffic-manager/traffic-manager-routing-methods)，使用者要求會路由至適當的基礎 URL。</span><span class="sxs-lookup"><span data-stu-id="1912c-138">User requests are routed to the proper underlying URL based on your configured [Traffic Manager routing method](/azure/traffic-manager/traffic-manager-routing-methods).</span></span> <span data-ttu-id="1912c-139">基於本文的目的，我們只會關心容錯移轉選項。</span><span class="sxs-lookup"><span data-stu-id="1912c-139">For the sake of this article, we will be concerned with only the failover option.</span></span>

![透過 Azure 流量管理員進行路由傳送](./images/disaster-recovery-azure-applications/routing-using-azure-traffic-manager.png)

<span data-ttu-id="1912c-141">在設定流量管理員時，您會提供新的流量管理員 DNS 首碼，以供使用者用來存取您的服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-141">When configuring Traffic Manager, you provide a new Traffic Manager DNS prefix, which users will use to access your service.</span></span> <span data-ttu-id="1912c-142">流量管理員現在會將負載平衡提取到比區域層級高一個層級。</span><span class="sxs-lookup"><span data-stu-id="1912c-142">Traffic Manager now abstracts load balancing one level higher that the regional level.</span></span> <span data-ttu-id="1912c-143">流量管理員 DNS 會對應至其管理的所有部署的 CNAME。</span><span class="sxs-lookup"><span data-stu-id="1912c-143">The Traffic Manager DNS maps to a CNAME for all the deployments that it manages.</span></span>

<span data-ttu-id="1912c-144">在流量管理員內，您可以指定已排列優先順序的部署清單，以在發生失敗時作為使用者的路由目的地。</span><span class="sxs-lookup"><span data-stu-id="1912c-144">Within Traffic Manager, you specify a prioritized list of deployments that users will be routed to when failure occurs.</span></span> <span data-ttu-id="1912c-145">流量管理員會監視部署端點。</span><span class="sxs-lookup"><span data-stu-id="1912c-145">Traffic Manager monitors the deployment endpoints.</span></span> <span data-ttu-id="1912c-146">如果主要部署變得無法使用，流量管理員會將使用者路由至優先順序清單上的下一個部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-146">If the primary deployment becomes unavailable, Traffic Manager routes users to the next deployment on the priority list.</span></span>

<span data-ttu-id="1912c-147">雖然流量管理員會決定容錯移轉期間要前往何處，但您可以決定當您不是處於容錯移轉模式時，容錯移轉網域是要休眠還是處於作用中狀態 (與流量管理員無關)。</span><span class="sxs-lookup"><span data-stu-id="1912c-147">Although Traffic Manager decides where to go during a failover, you can decide whether your failover domain is dormant or active while you're not in failover mode (which is unrelated to Traffic Manager).</span></span> <span data-ttu-id="1912c-148">不論該網站目前是否正在服務使用者，流量管理員都會偵測主要網站中的失敗，並變換到容錯移轉網站。</span><span class="sxs-lookup"><span data-stu-id="1912c-148">Traffic Manager detects a failure in the primary site and rolls over to the failover site, regardless of whether that site is currently serving users.</span></span>

<span data-ttu-id="1912c-149">如需 Azure 流量管理員如何運作的詳細資訊，請參考：</span><span class="sxs-lookup"><span data-stu-id="1912c-149">For more information on how Azure Traffic Manager works, refer to:</span></span>

* [<span data-ttu-id="1912c-150">流量管理員概觀</span><span class="sxs-lookup"><span data-stu-id="1912c-150">Traffic Manager overview</span></span>](/azure/traffic-manager/traffic-manager-overview/)
* [<span data-ttu-id="1912c-151">流量管理員路由方法</span><span class="sxs-lookup"><span data-stu-id="1912c-151">Traffic Manager routing methods</span></span>](/azure/traffic-manager/traffic-manager-routing-methods)
* [<span data-ttu-id="1912c-152">設定容錯移轉路由方法</span><span class="sxs-lookup"><span data-stu-id="1912c-152">Configure failover routing method</span></span>](/azure/traffic-manager/traffic-manager-configure-failover-routing-method/)

## <a name="azure-disaster-scenarios"></a><span data-ttu-id="1912c-153">Azure 災害案例</span><span class="sxs-lookup"><span data-stu-id="1912c-153">Azure disaster scenarios</span></span>
<span data-ttu-id="1912c-154">下列各節涵蓋數個不同類型的災害案例。</span><span class="sxs-lookup"><span data-stu-id="1912c-154">The following sections cover several different types of disaster scenarios.</span></span> <span data-ttu-id="1912c-155">全區域服務中斷不是全應用程式失敗的唯一原因。</span><span class="sxs-lookup"><span data-stu-id="1912c-155">Region-wide service disruptions are not the only cause of application-wide failures.</span></span> <span data-ttu-id="1912c-156">設計不良和管理錯誤也可能導致中斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-156">Poor design and administrative errors can also lead to outages.</span></span> <span data-ttu-id="1912c-157">請務必在復原計劃的設計和測試階段，考慮可能的失敗原因。</span><span class="sxs-lookup"><span data-stu-id="1912c-157">It's important to consider the possible causes of a failure during both the design and testing phases of your recovery plan.</span></span> <span data-ttu-id="1912c-158">完善的計畫會充分利用 Azure 功能，並透過應用程式特有策略來增強功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-158">A good plan takes advantage of Azure features and augments them with application-specific strategies.</span></span> <span data-ttu-id="1912c-159">選擇的回應取決於應用程式的重要性、復原點目標 (RPO) 和復原時間目標 (RTO)。</span><span class="sxs-lookup"><span data-stu-id="1912c-159">The chosen response is determined by the importance of the application, the recovery point objective (RPO), and the recovery time objective (RTO).</span></span>

### <a name="application-failure"></a><span data-ttu-id="1912c-160">應用程式失敗</span><span class="sxs-lookup"><span data-stu-id="1912c-160">Application failure</span></span>
<span data-ttu-id="1912c-161">Azure 流量管理員會自動處理主機虛擬機器中基礎硬體或作業系統軟體所造成的失敗。</span><span class="sxs-lookup"><span data-stu-id="1912c-161">Azure Traffic Manager automatically handles failures that result from the underlying hardware or operating system software in the host virtual machine.</span></span> <span data-ttu-id="1912c-162">Azure 會建立新的角色執行個體，並將它新增至可用集區。</span><span class="sxs-lookup"><span data-stu-id="1912c-162">Azure creates a new role instance and adds it to the available pool.</span></span> <span data-ttu-id="1912c-163">如果有多個已執行的角色執行個體，Azure 會在取代失敗的節點時，將處理移到其他執行中的角色執行個體。</span><span class="sxs-lookup"><span data-stu-id="1912c-163">If  more than one role instance was already running, Azure shifts processing to the other running role instances while replacing the failed node.</span></span>

<span data-ttu-id="1912c-164">即使硬體或作業系統沒有任何基礎性失敗，也可能會發生嚴重的應用程式錯誤。</span><span class="sxs-lookup"><span data-stu-id="1912c-164">Serious application errors can occur without any underlying failure of the hardware or operating system.</span></span> <span data-ttu-id="1912c-165">應用程式可能會因為邏輯錯誤或資料完整性問題所造成的嚴重例外狀況而失敗。</span><span class="sxs-lookup"><span data-stu-id="1912c-165">The application might fail due to catastrophic exceptions caused by bad logic or data integrity issues.</span></span> <span data-ttu-id="1912c-166">您必須將足夠的遙測資料納入應用程式程式碼，以便監視系統偵測失敗狀況，並通知應用程式管理員。</span><span class="sxs-lookup"><span data-stu-id="1912c-166">You must include sufficient telemetry in the application code so that a monitoring system can detect failure conditions and notify an application administrator.</span></span> <span data-ttu-id="1912c-167">完全了解災害復原程序的系統管理員可以決定是否要在解決重大錯誤時，觸發容錯移轉程序或接受可用性中斷情形。</span><span class="sxs-lookup"><span data-stu-id="1912c-167">An administrator who has full knowledge of the disaster recovery processes can decide whether to trigger a failover process or accept an availability outage while resolving the critical errors.</span></span>

### <a name="data-corruption"></a><span data-ttu-id="1912c-168">資料損毀</span><span class="sxs-lookup"><span data-stu-id="1912c-168">Data corruption</span></span>
<span data-ttu-id="1912c-169">Azure 會在相同區域的不同容錯網域中，自動重複儲存 Azure SQL Database 和 Azure 儲存體資料三次。</span><span class="sxs-lookup"><span data-stu-id="1912c-169">Azure automatically stores Azure SQL Database and Azure Storage data three times redundantly within different fault domains in the same region.</span></span> <span data-ttu-id="1912c-170">如果您使用異地複寫，資料會在不同的區域中額外儲存三次。</span><span class="sxs-lookup"><span data-stu-id="1912c-170">If you use geo-replication, the data is stored three additional times in a different region.</span></span> <span data-ttu-id="1912c-171">不過，如果您的使用者或應用程式損毀主要複本中的該資料，該資料會很快地複製到其他複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-171">However, if your users or your application corrupts that data in the primary copy, the data quickly replicates to the other copies.</span></span> <span data-ttu-id="1912c-172">不幸的是，這會導致多份資料損毀。</span><span class="sxs-lookup"><span data-stu-id="1912c-172">Unfortunately, this results in multiple copies of corrupt data.</span></span>

<span data-ttu-id="1912c-173">若要管理您的資料的潛在損毀，您有兩個選項。</span><span class="sxs-lookup"><span data-stu-id="1912c-173">To manage potential corruption of your data, you have two options.</span></span> <span data-ttu-id="1912c-174">首先，您可以管理自訂備份策略。</span><span class="sxs-lookup"><span data-stu-id="1912c-174">First, you can manage a custom backup strategy.</span></span> <span data-ttu-id="1912c-175">視您的商務需求或控管規定而定，您可以將備份儲存在 Azure 或內部部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-175">You can store your backups in Azure or on-premises, depending on your business requirements or governance regulations.</span></span> <span data-ttu-id="1912c-176">另一個選項是使用還原時間點選項來復原 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="1912c-176">Another option is to use the point-in-time restore option to recover a SQL database.</span></span> <span data-ttu-id="1912c-177">如需詳細資訊，請參閱下面的[災害復原的資料策略](#data-strategies-for-disaster-recovery)一節。</span><span class="sxs-lookup"><span data-stu-id="1912c-177">For more information, see the [data strategies for disaster recovery](#data-strategies-for-disaster-recovery) section below.</span></span>

### <a name="network-outage"></a><span data-ttu-id="1912c-178">網路中斷</span><span class="sxs-lookup"><span data-stu-id="1912c-178">Network outage</span></span>
<span data-ttu-id="1912c-179">無法存取 Azure 網路的組件時，您可能無法存取您的應用程式或資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-179">When parts of the Azure network are inaccessible, you may be unable to access your application or data.</span></span> <span data-ttu-id="1912c-180">如果一或多個角色執行個體因為網路問題而無法使用，Azure 會使用您的應用程式的其餘可用執行個體。</span><span class="sxs-lookup"><span data-stu-id="1912c-180">If one or more role instances are unavailable due to network issues, Azure uses the remaining available instances of your application.</span></span> <span data-ttu-id="1912c-181">如果您的應用程式因為 Azure 網路中斷而無法存取其資料，您可以使用快取的資料，以降低的應用程式功能在本機執行。</span><span class="sxs-lookup"><span data-stu-id="1912c-181">If your application cannot access its data because of an Azure network outage, you can potentially run with reduced application functionality locally by using cached data.</span></span> <span data-ttu-id="1912c-182">您必須設計災害復原策略，才能在應用程式中以降低的功能來執行。</span><span class="sxs-lookup"><span data-stu-id="1912c-182">You need to design the disaster recovery strategy to run with reduced functionality in your application.</span></span> <span data-ttu-id="1912c-183">對於某些應用程式，這可能不太實際。</span><span class="sxs-lookup"><span data-stu-id="1912c-183">For some applications, this might not be practical.</span></span>

<span data-ttu-id="1912c-184">另一個選項是將資料儲存在替代位置，直到恢復連線為止。</span><span class="sxs-lookup"><span data-stu-id="1912c-184">Another option is to store data in an alternate location until connectivity is restored.</span></span> <span data-ttu-id="1912c-185">如果降低功能不可行，則剩餘的選項為應用程式停機或容錯移轉至替代區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-185">If reducing functionality is not an option, the remaining options are application downtime or failover to an alternate region.</span></span> <span data-ttu-id="1912c-186">以降低功能執行之應用程式的設計既是業務決策，也是技術決策。</span><span class="sxs-lookup"><span data-stu-id="1912c-186">The design of an application running with reduced functionality is as much a business decision as a technical one.</span></span> <span data-ttu-id="1912c-187">這在[降低的應用程式功能](#reduced-application-functionality)一節中有進一步的討論。</span><span class="sxs-lookup"><span data-stu-id="1912c-187">This is discussed further in the section on [reduced application functionality](#reduced-application-functionality).</span></span>

### <a name="failure-of-a-dependent-service"></a><span data-ttu-id="1912c-188">相依服務失敗</span><span class="sxs-lookup"><span data-stu-id="1912c-188">Failure of a dependent service</span></span>
<span data-ttu-id="1912c-189">Azure 提供許多可能經歷定期中斷的服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-189">Azure provides many services that can experience periodic downtime.</span></span> <span data-ttu-id="1912c-190">例如，[Azure Redis 快取](https://azure.microsoft.com/services/cache/)是一種多租用戶服務，可為您的應用程式提供快取功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-190">For example, [Azure Redis Cache](https://azure.microsoft.com/services/cache/) is a multi-tenant service which provides caching capabilities to your application.</span></span> <span data-ttu-id="1912c-191">如果相依服務無法使用，請務必考慮應用程式發生什麼事。</span><span class="sxs-lookup"><span data-stu-id="1912c-191">It's important to consider what happens in your application if the dependent service is unavailable.</span></span> <span data-ttu-id="1912c-192">在許多方面，此案例很類似網路中斷案例。</span><span class="sxs-lookup"><span data-stu-id="1912c-192">In many ways, this scenario is similar to the network outage scenario.</span></span> <span data-ttu-id="1912c-193">不過，獨立考量每個服務可能會改善您的整體計畫。</span><span class="sxs-lookup"><span data-stu-id="1912c-193">However, considering each service independently results in potential improvements to your overall plan.</span></span>

<span data-ttu-id="1912c-194">Azure Redis 快取從可提供災害復原優點的雲端服務部署，提供快取功能給您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-194">Azure Redis Cache provides caching to your application from within your cloud service deployment, which provides disaster recovery benefits.</span></span> <span data-ttu-id="1912c-195">首先，此服務現在是在您的部署的本機角色上執行。</span><span class="sxs-lookup"><span data-stu-id="1912c-195">First, the service now runs on roles that are local to your deployment.</span></span> <span data-ttu-id="1912c-196">因此，您可以在雲端服務的整體管理程序中充分監視和管理快取的狀態。</span><span class="sxs-lookup"><span data-stu-id="1912c-196">Therefore, you're better able to monitor and manage the status of the cache as part of your overall management processes for the cloud service.</span></span> <span data-ttu-id="1912c-197">這種類型的快取也會公開新功能 (例如已快取之資料的高可用性)，藉由在其他節點上保有重複的複本，以在單一節點失敗時保留快取的資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-197">This type of caching also exposes new features such as high availability for cached data, which preserves cached data if a single node fails by maintaining duplicate copies on other nodes.</span></span>

<span data-ttu-id="1912c-198">請注意，高可用性會減少輸送量並增加延遲，因為寫入作業也必須更新所有次要複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-198">Note that high availability decreases throughput and increases latency because write operations must also upedate any secondary copies.</span></span> <span data-ttu-id="1912c-199">為了儲存快取的資料所需的記憶體數量會實際加倍，在規劃容量時必須將這一點列入考量。</span><span class="sxs-lookup"><span data-stu-id="1912c-199">The amount of memory required to store the cached data is effectively doubled, which must be taken into account during capacity planning.</span></span>  <span data-ttu-id="1912c-200">此範例示範每個相依服務可能有改善整體可用性和抵抗重大失敗的功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-200">This example demonstrates that each dependent service might have capabilities that improve your overall availability and resistance to catastrophic failures.</span></span>

<span data-ttu-id="1912c-201">就每個相依服務，您應該了解服務中斷的影響。</span><span class="sxs-lookup"><span data-stu-id="1912c-201">With each dependent service, you should understand the implications of a service disruption.</span></span> <span data-ttu-id="1912c-202">在快取範例中，有可能直接從資料庫存取資料，直到您還原您的快取為止。</span><span class="sxs-lookup"><span data-stu-id="1912c-202">In the caching example, it might be possible to access the data directly from a database until you restore your cache.</span></span> <span data-ttu-id="1912c-203">這會導致在提供完整的應用程式資料存取時，效能會降低。</span><span class="sxs-lookup"><span data-stu-id="1912c-203">This would result in reduced performance while providing full access to application data.</span></span>

### <a name="region-wide-service-disruption"></a><span data-ttu-id="1912c-204">全區域服務中斷</span><span class="sxs-lookup"><span data-stu-id="1912c-204">Region-wide service disruption</span></span>
<span data-ttu-id="1912c-205">上述失敗主要是可在相同的 Azure 區域內管理的失敗。</span><span class="sxs-lookup"><span data-stu-id="1912c-205">The previous failures have primarily been failures that can be managed within the same Azure region.</span></span> <span data-ttu-id="1912c-206">不過，您還必須對整個區域發生服務中斷的可能性有所準備。</span><span class="sxs-lookup"><span data-stu-id="1912c-206">However, you must also prepare for the possibility that there is a service disruption of the entire region.</span></span> <span data-ttu-id="1912c-207">如果發生全區域服務中斷，則無法使用您的資料的本機備援複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-207">If a region-wide service disruption occurs, the locally redundant copies of your data are not available.</span></span> <span data-ttu-id="1912c-208">如已啟用異地複寫，則您的 Blob 和資料表在不同的區域中有額外三份複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-208">If you have enabled geo-replication, there are three additional copies of your blobs and tables in a different region.</span></span> <span data-ttu-id="1912c-209">如果 Microsoft 宣告此區域遺失，Azure 會將所有的 DNS 項目重新對應至異地複寫的區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-209">If Microsoft declares the region lost, Azure remaps all of the DNS entries to the geo-replicated region.</span></span>

> [!NOTE]
> <span data-ttu-id="1912c-210">請注意，您完全無法控制這個程序，而且它只有在全區域服務中斷時才會發生。</span><span class="sxs-lookup"><span data-stu-id="1912c-210">Be aware that you don't have any control over this process, and it will occur only for region-wide service disruption.</span></span> <span data-ttu-id="1912c-211">請考慮使用 [Azure Site Recovery](/azure/site-recovery/) 來達成更好的 RPO 和 RTO。</span><span class="sxs-lookup"><span data-stu-id="1912c-211">Consider using [Azure Site Recovery](/azure/site-recovery/) to achieve better RPO and RTO.</span></span> <span data-ttu-id="1912c-212">Site Recovery 可讓應用程式決定可接受的中斷狀況為何，以及何時要容錯移轉至複寫的 VM。</span><span class="sxs-lookup"><span data-stu-id="1912c-212">Site Recovery allows application to decide what is an acceptable outage, and when to fail over to the replicated VMs.</span></span>

### <a name="azure-wide-service-disruption"></a><span data-ttu-id="1912c-213">全 Azure 服務中斷</span><span class="sxs-lookup"><span data-stu-id="1912c-213">Azure-wide service disruption</span></span>
<span data-ttu-id="1912c-214">在災害規劃中，您必須考量各種可能的災害。</span><span class="sxs-lookup"><span data-stu-id="1912c-214">In disaster planning, you must consider the entire range of possible disasters.</span></span> <span data-ttu-id="1912c-215">其中一種最嚴重的服務中斷可能會同時涉及所有的 Azure 區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-215">One of the most severe service disruptions would involve all Azure regions simultaneously.</span></span> <span data-ttu-id="1912c-216">如同其他服務中斷，您可以決定在該事件中接受暫時停機的風險。</span><span class="sxs-lookup"><span data-stu-id="1912c-216">As with other service disruptions, you might decide to accept the risk of temporary downtime in that event.</span></span> <span data-ttu-id="1912c-217">相較於涉及相依服務或單一區域的獨立服務中斷，跨區域的大規模服務中斷極為罕見。</span><span class="sxs-lookup"><span data-stu-id="1912c-217">Widespread service disruptions that span regions are much rarer than isolated service disruptions involving dependent services or single regions.</span></span>

<span data-ttu-id="1912c-218">不過，您可以決定某些關鍵任務應用程式需要有備份計劃，以防多個區域的服務皆中斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-218">However, you may decide that certain mission-critical applications require a backup plan for a multi-region service disruption.</span></span> <span data-ttu-id="1912c-219">此計劃可能包括容錯移轉到[替代雲端](#alternative-cloud)或[混合式內部部署與雲端解決方案](#hybrid-on-premises-and-cloud-solution)中的服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-219">This plan might include failing over to services in an [alternative cloud](#alternative-cloud) or a [hybrid on-premises and cloud solution](#hybrid-on-premises-and-cloud-solution).</span></span>

### <a name="reduced-application-functionality"></a><span data-ttu-id="1912c-220">降低的應用程式功能</span><span class="sxs-lookup"><span data-stu-id="1912c-220">Reduced application functionality</span></span>
<span data-ttu-id="1912c-221">設計良好的應用程式通常會透過實作鬆散結合的資訊交換模式，來使用可相互通訊的服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-221">A well-designed application typically uses services that communicate with each other though the implementation of loosely coupled information-interchange patterns.</span></span> <span data-ttu-id="1912c-222">容易進行災害復原的應用程式需要在服務層級區隔責任。</span><span class="sxs-lookup"><span data-stu-id="1912c-222">A DR-friendly application requires separation of responsibilities at the service level.</span></span> <span data-ttu-id="1912c-223">這可防止相依服務的中斷導致關閉整個應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-223">This prevents the disruption of a dependent service from bringing down the entire application.</span></span> <span data-ttu-id="1912c-224">例如，假設 Y 公司有一個 Web 商務應用程式。此應用程式可能由下列模組構成︰</span><span class="sxs-lookup"><span data-stu-id="1912c-224">For example, consider a web commerce application for Company Y. The following modules might constitute the application:</span></span>

* <span data-ttu-id="1912c-225">**產品型錄** 可讓使用者瀏覽產品。</span><span class="sxs-lookup"><span data-stu-id="1912c-225">**Product Catalog** allows users to browse products.</span></span>
* <span data-ttu-id="1912c-226">**購物車** 可讓使用者加入/移除購物車中的產品。</span><span class="sxs-lookup"><span data-stu-id="1912c-226">**Shopping Cart** allows users to add/remove products in their shopping cart.</span></span>
* <span data-ttu-id="1912c-227">**訂單狀態** 可顯示使用者訂單的運送狀態。</span><span class="sxs-lookup"><span data-stu-id="1912c-227">**Order Status** shows the shipping status of user orders.</span></span>
* <span data-ttu-id="1912c-228">**訂單提交** 可提交訂單並且付款，以完成購物工作階段。</span><span class="sxs-lookup"><span data-stu-id="1912c-228">**Order Submission** finalizes the shopping session by submitting the order with payment.</span></span>
* <span data-ttu-id="1912c-229">**訂單處理** 可驗證訂單的資料完整性並執行可用數量檢查。</span><span class="sxs-lookup"><span data-stu-id="1912c-229">**Order Processing** validates the order for data integrity and performs a quantity availability check.</span></span>

<span data-ttu-id="1912c-230">當此應用程式中的服務相依性無法使用時，服務在相依性復原之前如何運作？</span><span class="sxs-lookup"><span data-stu-id="1912c-230">When a service dependency in this application becomes unavailable, how does the service function until the dependency recovers?</span></span> <span data-ttu-id="1912c-231">完備的系統會透過設計階段和執行階段的責任區隔來實作隔離界限。</span><span class="sxs-lookup"><span data-stu-id="1912c-231">A well-designed system implements isolation boundaries through separation of responsibilities, both at design time and at runtime.</span></span> <span data-ttu-id="1912c-232">您可以將每個失敗歸類為可復原和不可復原。</span><span class="sxs-lookup"><span data-stu-id="1912c-232">You can categorize every failure as recoverable and non-recoverable.</span></span> <span data-ttu-id="1912c-233">不可復原的錯誤會讓服務停止運作，但您可以透過替代項目緩和可復原的錯誤。</span><span class="sxs-lookup"><span data-stu-id="1912c-233">Non-recoverable errors will bring down the service, but you can mitigate a recoverable error through alternatives.</span></span> <span data-ttu-id="1912c-234">透過自動處理錯誤及採取替代動作而解決的某些問題，使用者並不會察覺到。</span><span class="sxs-lookup"><span data-stu-id="1912c-234">Certain problems addressed by automatically handling faults and taking alternate actions are transparent to the user.</span></span> <span data-ttu-id="1912c-235">在更嚴重的服務中斷期間，應用程式可能完全無法使用。</span><span class="sxs-lookup"><span data-stu-id="1912c-235">During a more serious service disruption, the application might be completely unavailable.</span></span> <span data-ttu-id="1912c-236">第三個選項是繼續以降低的功能處理使用者要求。</span><span class="sxs-lookup"><span data-stu-id="1912c-236">A third option is to continue handling user requests with reduced functionality.</span></span>

<span data-ttu-id="1912c-237">比方說，如果裝載訂單的資料庫無法運作，「訂單處理」服務就會喪失其處理銷售交易的能力。</span><span class="sxs-lookup"><span data-stu-id="1912c-237">For instance, if the database for hosting orders goes down, the Order Processing service loses its ability to process sales transactions.</span></span> <span data-ttu-id="1912c-238">視架構而定，它可能難以或無法繼續執行應用程式的「提交訂單」和「訂單處理」服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-238">Depending on the architecture, it might be difficult or impossible for the Order Submission and Order Processing services of the application to continue.</span></span> <span data-ttu-id="1912c-239">如果應用程式並非設計用來處理此案例，則整個應用程式可能會離線。</span><span class="sxs-lookup"><span data-stu-id="1912c-239">If the application is not designed to handle this scenario, the entire application might go offline.</span></span> <span data-ttu-id="1912c-240">不過，如果產品資料儲存在不同的位置，則產品型錄模組仍可用來檢視產品。</span><span class="sxs-lookup"><span data-stu-id="1912c-240">However, if the product data is stored in a different location, then the Product Catalog module can still be used for viewing products.</span></span> <span data-ttu-id="1912c-241">但是，應用程式的其他組件則無法使用，例如訂購或庫存查詢。</span><span class="sxs-lookup"><span data-stu-id="1912c-241">However, other parts of the application are unavailable, such as ordering or inventory queries.</span></span>

<span data-ttu-id="1912c-242">決定要提供哪些降低的應用程式功能，既是業務決策也是技術決策。</span><span class="sxs-lookup"><span data-stu-id="1912c-242">Deciding what reduced application functionality is available is both a business decision and a technical decision.</span></span> <span data-ttu-id="1912c-243">您也必須決定應用程式要如何向使用者通知臨時性問題。</span><span class="sxs-lookup"><span data-stu-id="1912c-243">You must decide how the application will inform the users of any temporary problems.</span></span> <span data-ttu-id="1912c-244">在上述範例中，應用程式可能會允許檢視產品，並將產品加入購物車。</span><span class="sxs-lookup"><span data-stu-id="1912c-244">In the example above, the application might allow viewing products and adding them to a shopping cart.</span></span> <span data-ttu-id="1912c-245">不過，當使用者嘗試進行購買，應用程式會通知使用者，訂購功能暫時無法使用。</span><span class="sxs-lookup"><span data-stu-id="1912c-245">However, when the user attempts to make a purchase, the application notifies the user that the ordering functionality is temporarily unavailable.</span></span> <span data-ttu-id="1912c-246">對客戶而言，雖不理想，但的確能防止全應用程式的服務中斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-246">This isn't ideal for the customer, but it does prevent an application-wide service disruption.</span></span>

## <a name="data-strategies-for-disaster-recovery"></a><span data-ttu-id="1912c-247">災害復原的資料策略</span><span class="sxs-lookup"><span data-stu-id="1912c-247">Data strategies for disaster recovery</span></span>
<span data-ttu-id="1912c-248">在災害復原計劃中，如何適當處理資料是其中一項麻煩。</span><span class="sxs-lookup"><span data-stu-id="1912c-248">Proper data handling is a challenging aspect of a disaster recovery plan.</span></span> <span data-ttu-id="1912c-249">在復原過程中，通常會花最多時間在還原資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-249">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="1912c-250">不同的降低功能選擇會導致面臨從失敗中復原資料和失敗後一致性的困難挑戰。</span><span class="sxs-lookup"><span data-stu-id="1912c-250">Different choices for reducing functionality result in difficult challenges for data recovery from failure and consistency after failure.</span></span>

<span data-ttu-id="1912c-251">其中一項考量是需要還原或維護應用程式的資料複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-251">One consideration is the need to restore or maintain a copy of the application’s data.</span></span> <span data-ttu-id="1912c-252">您會將此資料用於次要網站上的參考和交易目的。</span><span class="sxs-lookup"><span data-stu-id="1912c-252">You will use this data for reference and transactional purposes at a secondary site.</span></span> <span data-ttu-id="1912c-253">內部部署需要經過所費不貲且冗長的規劃程序，才能實作多區域的災害復原策略。</span><span class="sxs-lookup"><span data-stu-id="1912c-253">An on-premises deployment requires an expensive and lengthy planning process to implement a multiple-region disaster recovery strategy.</span></span> <span data-ttu-id="1912c-254">為了方便起見，包括 Azure 在內的大部分雲端提供者欣然允許將應用程式部署至多個區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-254">Conveniently, most cloud providers, including Azure, readily allow the deployment of applications to multiple regions.</span></span> <span data-ttu-id="1912c-255">這些區域會分布於各地，這麼一來，多重區域的服務中斷應該極少出現。</span><span class="sxs-lookup"><span data-stu-id="1912c-255">These regions are geographically distributed in such a way that multiple-region service disruption should be extremely rare.</span></span> <span data-ttu-id="1912c-256">用於處理跨越區資料的策略是促使任何災害復原計畫成功的因素之一。</span><span class="sxs-lookup"><span data-stu-id="1912c-256">The strategy for handling data across regions is one of the contributing factors for the success of any disaster recovery plan.</span></span>

<span data-ttu-id="1912c-257">下列各節討論與資料備份、參考資料和交易資料相關的災害復原技術。</span><span class="sxs-lookup"><span data-stu-id="1912c-257">The following sections discuss disaster recovery techniques related to data backups, reference data, and transactional data.</span></span>

### <a name="backup-and-restore"></a><span data-ttu-id="1912c-258">備份與還原</span><span class="sxs-lookup"><span data-stu-id="1912c-258">Backup and restore</span></span>
<span data-ttu-id="1912c-259">應用程式資料的定期備份可支援一些災害復原案例。</span><span class="sxs-lookup"><span data-stu-id="1912c-259">Regular backups of application data can support some disaster recovery scenarios.</span></span> <span data-ttu-id="1912c-260">不同的儲存體資源需要不同的技術。</span><span class="sxs-lookup"><span data-stu-id="1912c-260">Different storage resources require different techniques.</span></span>

#### <a name="sql-database"></a><span data-ttu-id="1912c-261">SQL Database</span><span class="sxs-lookup"><span data-stu-id="1912c-261">SQL Database</span></span>
<span data-ttu-id="1912c-262">在基本、標準和進階 SQL Database 層中，您可以利用時間點還原來復原資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-262">For the Basic, Standard, and Premium SQL Database tiers, you can take advantage of point-in-time restore to recover your database.</span></span> <span data-ttu-id="1912c-263">如需詳細資訊，請參閱 [概觀：雲端商務持續性和 SQL Database 的資料庫災害復原](/azure/sql-database/sql-database-business-continuity/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-263">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="1912c-264">另一個選項是使用「SQL Database 的主動式異地複寫」。</span><span class="sxs-lookup"><span data-stu-id="1912c-264">Another option is to use Active Geo-Replication for SQL Database.</span></span> <span data-ttu-id="1912c-265">這會自動將資料庫變更複寫到相同 Azure 區域或甚至不同 Azure 區域中的次要資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-265">This automatically replicates database changes to secondary databases in the same Azure region or even in a different Azure region.</span></span> <span data-ttu-id="1912c-266">這可對本文中所呈現的一些較為手動的資料同步處理技術提供可能的替代方式。</span><span class="sxs-lookup"><span data-stu-id="1912c-266">This provides a potential alternative to some of the more manual data synchronization techniques presented in this article.</span></span> <span data-ttu-id="1912c-267">如需詳細資訊，請參閱 [概觀︰SQL Database 作用中異地複寫](/azure/sql-database/sql-database-geo-replication-overview/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-267">For more information, see [Overview: SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="1912c-268">您也可以使用較為手動的方式進行備份和還原。</span><span class="sxs-lookup"><span data-stu-id="1912c-268">You can also use a more manual approach for backup and restore.</span></span> <span data-ttu-id="1912c-269">使用 DATABASE COPY 命令建立具有交易一致性的資料庫備份複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-269">Use the DATABASE COPY command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="1912c-270">您也可以使用 Azure SQL Database 的匯入/匯出服務，其支援將資料庫匯出到 BACPAC 檔案 (此為包含資料庫結構描述和相關聯資料的壓縮檔案)，並儲存在 Azure Blob 儲存體中。</span><span class="sxs-lookup"><span data-stu-id="1912c-270">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span>

<span data-ttu-id="1912c-271">Azure 儲存體的內建備援功能會在相同區域中建立兩個備份檔案複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-271">The built-in redundancy of Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="1912c-272">不過，執行備份程序的頻率可決定您的 RPO，而 RPO 就是您在災害案例中可能會遺失的資料量。</span><span class="sxs-lookup"><span data-stu-id="1912c-272">However, the frequency of running the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="1912c-273">例如，假設您在每個整點執行備份，而災害發生在整點前的兩分鐘。</span><span class="sxs-lookup"><span data-stu-id="1912c-273">For example, imagine that you perform a backup at the top of each hour, and a disaster occurs two minutes before the top of the hour.</span></span> <span data-ttu-id="1912c-274">您會遺失上次執行備份後所記錄的 58 分鐘資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-274">You lose 58 minutes of data recorded after the last backup was performed.</span></span> <span data-ttu-id="1912c-275">此外，若要防止全區域的服務中斷，您應該將 BACPAC 檔案複製到替代區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-275">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="1912c-276">然後，您可選擇在替代區域中還原這些備份。</span><span class="sxs-lookup"><span data-stu-id="1912c-276">You then have the option of restoring those backups in the alternate region.</span></span> <span data-ttu-id="1912c-277">如需詳細資訊，請參閱 [概觀：雲端商務持續性和 SQL Database 的資料庫災害復原](/azure/sql-database/sql-database-business-continuity/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-277">For more details, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span>

#### <a name="sql-data-warehouse"></a><span data-ttu-id="1912c-278">SQL 資料倉儲</span><span class="sxs-lookup"><span data-stu-id="1912c-278">SQL Data Warehouse</span></span>
<span data-ttu-id="1912c-279">對於 SQL 資料倉儲，請使用[異地備份](/azure/sql-data-warehouse/backup-and-restore#geo-backups)還原至配對區域以進行災害復原。</span><span class="sxs-lookup"><span data-stu-id="1912c-279">For SQL Data Warehouse, use [geo-backups](/azure/sql-data-warehouse/backup-and-restore#geo-backups) to restore to a paired region for disaster recovery.</span></span> <span data-ttu-id="1912c-280">這些備份作業每隔 24 小時進行一次，且可於 20 分鐘內在配對區域內還原。</span><span class="sxs-lookup"><span data-stu-id="1912c-280">These backups are taken every 24 hours and can be restore within 20 minutes in the paired region.</span></span> <span data-ttu-id="1912c-281">依預設，所有 SQL 資料倉儲都會啟用這項功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-281">This feature is on by default for all SQL data warehouses.</span></span> <span data-ttu-id="1912c-282">如需有關如何還原資料倉儲的詳細資訊，請參閱[使用 PowerShell 從 Azure 地理區域還原](/azure/sql-data-warehouse/sql-data-warehouse-restore#restore-from-an-azure-geographical-region-using-powershell)。</span><span class="sxs-lookup"><span data-stu-id="1912c-282">For more information on how to restore your data warehouse, see [Restore from an Azure geographical region using PowerShell](/azure/sql-data-warehouse/sql-data-warehouse-restore#restore-from-an-azure-geographical-region-using-powershell).</span></span>

#### <a name="azure-storage"></a><span data-ttu-id="1912c-283">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="1912c-283">Azure Storage</span></span>
<span data-ttu-id="1912c-284">對於 Azure 儲存體，您可以開發自訂備份程序，或使用某個協力廠商備份工具。</span><span class="sxs-lookup"><span data-stu-id="1912c-284">For Azure Storage, you can develop a custom backup process or use one of many third-party backup tools.</span></span> <span data-ttu-id="1912c-285">請注意，在儲存體資源會相互參考的大多數應用程式設計中，有額外的複雜性。</span><span class="sxs-lookup"><span data-stu-id="1912c-285">Note that most application designs have additional complexities where storage resources reference each other.</span></span> <span data-ttu-id="1912c-286">比方說，假設 SQL Database 中有一個資料行連結至 Azure 儲存體中的 Blob。</span><span class="sxs-lookup"><span data-stu-id="1912c-286">For example, consider a SQL database that has a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="1912c-287">如果備份未同時進行，則資料庫可能有失敗前未備份 Blob 的指標。</span><span class="sxs-lookup"><span data-stu-id="1912c-287">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="1912c-288">應用程式或災害復原計畫必須實作相關程序來處理復原後的此種不一致情況。</span><span class="sxs-lookup"><span data-stu-id="1912c-288">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>

#### <a name="other-data-platforms"></a><span data-ttu-id="1912c-289">其他資料平台</span><span class="sxs-lookup"><span data-stu-id="1912c-289">Other data platforms</span></span>
<span data-ttu-id="1912c-290">其他基礎結構即服務 (IaaS) 所裝載的資料平台 (例如 Elasticsearch 或 MongoDB)，各自都有自己的功能以及在建立整合式備份和還原程序時的考量。</span><span class="sxs-lookup"><span data-stu-id="1912c-290">Other infrastructure-as-a-service (IaaS) hosted data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="1912c-291">對於這些資料平台，我們一般會建議使用任何原生或可用的整合式複寫或快照功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-291">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshotting capabilities.</span></span> <span data-ttu-id="1912c-292">如果這些功能不存在或不適合，再考慮使用 Azure 備份服務或受控/非受控磁碟快照集，以建立應用程式資料的時間點複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-292">If those capabilities do not exist or are not suitable, then consider using Azure Backup Service or managed/unmanaged disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="1912c-293">在所有情況下，皆請務必判斷如何達到一致的備份，尤其是當應用程式資料橫跨多個檔案系統，或是當您使用磁碟區管理員或軟體型 RAID 將多個磁碟機組合成單一檔案系統時。</span><span class="sxs-lookup"><span data-stu-id="1912c-293">In all cases, it’s important to determine how to achieve consistent backups, especially when application data spans multiple files systems, or when multiple drives are combined into a single file system using volume managers or software-based RAID.</span></span>

### <a name="reference-data-pattern-for-disaster-recovery"></a><span data-ttu-id="1912c-294">災害復原的參考資料模式</span><span class="sxs-lookup"><span data-stu-id="1912c-294">Reference data pattern for disaster recovery</span></span>
<span data-ttu-id="1912c-295">參考資料是可支援應用程式功能的唯讀資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-295">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="1912c-296">它通常不會頻繁變更。</span><span class="sxs-lookup"><span data-stu-id="1912c-296">It typically does not change frequently.</span></span> <span data-ttu-id="1912c-297">雖然備份和還原是一種用來處理全區域服務中斷的方法，但 RTO 相對較長。</span><span class="sxs-lookup"><span data-stu-id="1912c-297">Although backup and restore is one method to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="1912c-298">當您將應用程式部署到次要地區時，有些策略可改善參考資料的 RTO。</span><span class="sxs-lookup"><span data-stu-id="1912c-298">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

<span data-ttu-id="1912c-299">因為參考的資料變更很少，可以改善 RTO，藉由維護永久複本的次要地區中的參考資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-299">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy of the reference data in the secondary region.</span></span> <span data-ttu-id="1912c-300">這可排除在災害事件中還原備份所需的時間。</span><span class="sxs-lookup"><span data-stu-id="1912c-300">This eliminates the time required to restore backups in the event of a disaster.</span></span> <span data-ttu-id="1912c-301">為了符合多重區域的災害復原需求，您必須在多個區域上一起部署應用程式和參考資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-301">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span> <span data-ttu-id="1912c-302">您也可以將參考資料部署到角色本身、外部儲存體或兩者的組合。</span><span class="sxs-lookup"><span data-stu-id="1912c-302">You can deploy reference data to the role itself, to external storage, or to a combination of both.</span></span>

<span data-ttu-id="1912c-303">計算節點內的參考資料部署模型暗中符合災害復原需求。</span><span class="sxs-lookup"><span data-stu-id="1912c-303">The reference data deployment model within compute nodes implicitly satisfies the disaster recovery requirements.</span></span> <span data-ttu-id="1912c-304">您必須將參考資料的複本部署到每個區域，才可將參考資料部署至 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="1912c-304">Reference data deployment to SQL Database requires that you deploy a copy of the reference data to each region.</span></span> <span data-ttu-id="1912c-305">Azure 儲存體適用相同的策略。</span><span class="sxs-lookup"><span data-stu-id="1912c-305">The same strategy applies to Azure Storage.</span></span> <span data-ttu-id="1912c-306">您必須將 Azure 儲存體上儲存的任何參考資料複本部署到主要和次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-306">You must deploy a copy of any reference data that's stored in Azure Storage to the primary and secondary regions.</span></span>

![參考資料同時發佈到主要和次要地區](./images/disaster-recovery-azure-applications/reference-data-publication-to-both-primary-and-secondary-regions.png)

<span data-ttu-id="1912c-308">您必須對所有資料 (包括參考資料) 實作自己的應用程式特定備份常式。</span><span class="sxs-lookup"><span data-stu-id="1912c-308">You must implement your own application-specific backup routines for all data, including reference data.</span></span> <span data-ttu-id="1912c-309">跨區域的異地複寫複本只用於全區域的服務中斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-309">Geo-replicated copies across regions are used only in a region-wide service disruption.</span></span> <span data-ttu-id="1912c-310">若要避免延長停機時間，請將應用程式資料的關鍵性部分部署到次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-310">To prevent extended downtime, deploy the mission-critical parts of the application’s data to the secondary region.</span></span> <span data-ttu-id="1912c-311">如需這種拓撲的範例，請參閱 [主動-被動模型](#active-passive)。</span><span class="sxs-lookup"><span data-stu-id="1912c-311">For an example of this topology, see the [active-passive model](#active-passive).</span></span>

### <a name="transactional-data-pattern-for-disaster-recovery"></a><span data-ttu-id="1912c-312">災害復原的交易資料模式</span><span class="sxs-lookup"><span data-stu-id="1912c-312">Transactional data pattern for disaster recovery</span></span>
<span data-ttu-id="1912c-313">實作完整功能的災害模式策略時，必須將交易資料非同步複寫到次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-313">Implementation of a fully functional disaster mode strategy requires asynchronous replication of the transactional data to the secondary region.</span></span> <span data-ttu-id="1912c-314">可進行複寫的實際時間範圍將會決定應用程式的 RPO 特性。</span><span class="sxs-lookup"><span data-stu-id="1912c-314">The practical time windows within which the replication can occur will determine the RPO characteristics of the application.</span></span> <span data-ttu-id="1912c-315">在複寫時間範圍內，您仍可復原從主要區域遺失的資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-315">You might still recover the data that was lost from the primary region during the replication window.</span></span> <span data-ttu-id="1912c-316">您也可以稍後合併次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-316">You might also be able to merge with the secondary region later.</span></span>

<span data-ttu-id="1912c-317">下列架構範例對於在容錯移轉案例中以不同方式處理交易資料，提供了一些構想。</span><span class="sxs-lookup"><span data-stu-id="1912c-317">The following architecture examples provide some ideas on different ways of handling transactional data in a failover scenario.</span></span> <span data-ttu-id="1912c-318">請務必注意，這些範例並不詳盡。</span><span class="sxs-lookup"><span data-stu-id="1912c-318">It's important to note that these examples are not exhaustive.</span></span> <span data-ttu-id="1912c-319">例如，Azure SQL Database 可以取代佇列等中繼儲存位置。</span><span class="sxs-lookup"><span data-stu-id="1912c-319">For example, intermediate storage locations such as queues might be replaced with Azure SQL Database.</span></span> <span data-ttu-id="1912c-320">佇列本身可能是 Azure 儲存體或服務匯流排佇列 (請參閱 [Azure 佇列和服務匯流排佇列 - 比較和對比](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/))。</span><span class="sxs-lookup"><span data-stu-id="1912c-320">The queues themselves might be either Azure Storage or Azure Service Bus queues (see [Azure queues and Service Bus queues - compared and contrasted](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)).</span></span> <span data-ttu-id="1912c-321">伺服器存放裝置目的地也可能有所改變，例如 Azure 資料表，而不是 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="1912c-321">Server storage destinations might also vary, such as Azure tables instead of SQL Database.</span></span> <span data-ttu-id="1912c-322">此外，也可能會插入背景工作角色做為各種步驟中的媒介。</span><span class="sxs-lookup"><span data-stu-id="1912c-322">In addition, worker roles might be inserted as intermediaries in various steps.</span></span> <span data-ttu-id="1912c-323">目的不是要完全模擬這些架構，而是要考量復原交易資料和相關模組中的各種替代方案。</span><span class="sxs-lookup"><span data-stu-id="1912c-323">The intent is not to emulate these architectures exactly, but to consider various alternatives in the recovery of transactional data and related modules.</span></span>

#### <a name="replication-of-transactional-data-in-preparation-for-disaster-recovery"></a><span data-ttu-id="1912c-324">複寫交易資料以準備進行災害復原</span><span class="sxs-lookup"><span data-stu-id="1912c-324">Replication of transactional data in preparation for disaster recovery</span></span>
<span data-ttu-id="1912c-325">請考慮使用 Azure 儲存體佇列來保存交易資料的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-325">Consider an application that uses Azure Storage queues to hold transactional data.</span></span> <span data-ttu-id="1912c-326">這可讓背景工作角色將交易資料處理至分離架構中的伺服器資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-326">This allows worker roles to process the transactional data to the server database in a decoupled architecture.</span></span> <span data-ttu-id="1912c-327">如果前端角色必須立即查詢該資料，則交易需要使用某種形式的暫存快取。</span><span class="sxs-lookup"><span data-stu-id="1912c-327">This requires the transactions to use some form of temporary caching if the front-end roles require the immediate query of that data.</span></span> <span data-ttu-id="1912c-328">視資料遺失容錯層級而定，您可以選擇複寫佇列、資料庫或所有的儲存體資源。</span><span class="sxs-lookup"><span data-stu-id="1912c-328">Depending on the level of data-loss tolerance, you might choose to replicate the queues, the database, or all of the storage resources.</span></span> <span data-ttu-id="1912c-329">只利用資料庫複寫，如果主要區域故障，您仍可在主要區域恢復時復原佇列中的資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-329">With only database replication, if the primary region goes down, you can still recover the data in the queues when the primary region comes back.</span></span>

<span data-ttu-id="1912c-330">下圖顯示伺服器資料庫跨區域同步處理的架構。</span><span class="sxs-lookup"><span data-stu-id="1912c-330">The following diagram shows an architecture where the server database is synchronized across regions.</span></span>

![複寫交易資料以準備進行災害復原](./images/disaster-recovery-azure-applications/replicate-transactional-data-in-preparation-for-disaster-recovery.png)

<span data-ttu-id="1912c-332">實作此架構的最大挑戰是區域之間的複寫策略。</span><span class="sxs-lookup"><span data-stu-id="1912c-332">The biggest challenge to implementing this architecture is the replication strategy between regions.</span></span> <span data-ttu-id="1912c-333">[Azure SQL 資料同步](/azure/sql-database/sql-database-get-started-sql-data-sync/)服務會啟用這種類型的複寫。</span><span class="sxs-lookup"><span data-stu-id="1912c-333">The [Azure SQL Data Sync](/azure/sql-database/sql-database-get-started-sql-data-sync/) service enables this type of replication.</span></span> <span data-ttu-id="1912c-334">截至本文撰寫時，此服務還是預覽狀態，尚未建議用於生產環境。</span><span class="sxs-lookup"><span data-stu-id="1912c-334">As of this writing, the service is in preview and is not yet recommended for production environments.</span></span> <span data-ttu-id="1912c-335">如需詳細資訊，請參閱 [概觀：雲端商務持續性和 SQL Database 的資料庫災害復原](/azure/sql-database/sql-database-business-continuity/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-335">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="1912c-336">對於生產應用程式，您必須投資協力廠商解決方案或在程式碼中建立自己的複寫邏輯。</span><span class="sxs-lookup"><span data-stu-id="1912c-336">For production applications, you must invest in a third-party solution or create your own replication logic in code.</span></span> <span data-ttu-id="1912c-337">視架構而定，複寫可能是雙向的，而且更加複雜。</span><span class="sxs-lookup"><span data-stu-id="1912c-337">Depending on the architecture, the replication might be bidirectional, which is more complex.</span></span>

<span data-ttu-id="1912c-338">有一個可能的實作會使用前一個範例中的中繼佇列。</span><span class="sxs-lookup"><span data-stu-id="1912c-338">One potential implementation might make use of the intermediate queue in the previous example.</span></span> <span data-ttu-id="1912c-339">將資料處理至最終儲存目的地的背景工作角色，可以在主要和次要地區中進行變更。</span><span class="sxs-lookup"><span data-stu-id="1912c-339">The worker role that processes the data to the final storage destination might make the change in both the primary region and the secondary region.</span></span> <span data-ttu-id="1912c-340">這些不是一般工作，而複寫程式碼的完整指引已超出本文的範圍。</span><span class="sxs-lookup"><span data-stu-id="1912c-340">These are not trivial tasks, and complete guidance for replication code is beyond the scope of this article.</span></span> <span data-ttu-id="1912c-341">請對將資料複寫到次要區域的方法投入大量時間和測試。</span><span class="sxs-lookup"><span data-stu-id="1912c-341">Invest significant time and testing into the approach for replicating data to the secondary region.</span></span> <span data-ttu-id="1912c-342">額外處理和測試有助於確保容錯移轉和復原程序會正確地處理任何可能的資料不一致或重複的交易。</span><span class="sxs-lookup"><span data-stu-id="1912c-342">Additional processing and testing can help ensure that the failover and recovery processes correctly handle any possible data inconsistencies or duplicate transactions.</span></span>

> [!NOTE]
> <span data-ttu-id="1912c-343">本文件大部分著重於平台即服務 (PaaS)。</span><span class="sxs-lookup"><span data-stu-id="1912c-343">Most of this paper focuses on platform as a service (PaaS).</span></span> <span data-ttu-id="1912c-344">不過，有其他複寫和可用性選項可供使用 Azure 虛擬機器的混合式應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="1912c-344">However, additional replication and availability options for hybrid applications use Azure Virtual Machines.</span></span> <span data-ttu-id="1912c-345">這些混合式應用程式會使用基礎結構即服務 (IaaS) 在 Azure 中的虛擬機器上裝載 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="1912c-345">These hybrid applications use infrastructure as a service (IaaS) to host SQL Server on virtual machines in Azure.</span></span> <span data-ttu-id="1912c-346">這允許 SQL Server 中的傳統可用性方法，例如 AlwaysOn 可用性群組或記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="1912c-346">This allows traditional availability approaches in SQL Server, such as AlwaysOn Availability Groups or Log Shipping.</span></span> <span data-ttu-id="1912c-347">有些技術 (例如 AlwaysOn) 僅適用於內部部署 SQL Server 執行個體與 Azure 虛擬機器之間。</span><span class="sxs-lookup"><span data-stu-id="1912c-347">Some techniques, such as AlwaysOn, work only between on-premises SQL Server instances and Azure virtual machines.</span></span> <span data-ttu-id="1912c-348">如需詳細資訊，請參閱 [Azure 虛擬機器中的 SQL Server 高可用性和災害復原](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-348">For more information, see [High availability and disaster recovery for SQL Server in Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>
>
> 

#### <a name="reduced-application-functionality-for-transaction-capture"></a><span data-ttu-id="1912c-349">降低應用程式功能以擷取交易</span><span class="sxs-lookup"><span data-stu-id="1912c-349">Reduced application functionality for transaction capture</span></span>
<span data-ttu-id="1912c-350">請考慮建立以降低的功能運作的第二架構。</span><span class="sxs-lookup"><span data-stu-id="1912c-350">Consider a second architecture that operates with reduced functionality.</span></span> <span data-ttu-id="1912c-351">次要區域中的應用程式會停用所有功能，例如報告、商業智慧 (BI) 或清空佇列。</span><span class="sxs-lookup"><span data-stu-id="1912c-351">The application in the secondary region deactivates all the functionality, such as reporting, business intelligence (BI), or draining queues.</span></span> <span data-ttu-id="1912c-352">它只接受如商務需求所定義的最重要交易工作流程類型。</span><span class="sxs-lookup"><span data-stu-id="1912c-352">It accepts only the most important types of transactional workflows, as defined by business requirements.</span></span> <span data-ttu-id="1912c-353">系統會擷取交易並將它們寫入佇列。</span><span class="sxs-lookup"><span data-stu-id="1912c-353">The system captures the transactions and writes them to queues.</span></span> <span data-ttu-id="1912c-354">系統可能會在服務中斷的初期階段延後處理資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-354">The system might postpone processing the data during the initial stage of the service disruption.</span></span> <span data-ttu-id="1912c-355">如果主要區域的系統在預期的時間範圍內重新啟動，則主要區域中的背景工作角色可以清空佇列。</span><span class="sxs-lookup"><span data-stu-id="1912c-355">If the system on the primary region is reactivated within the expected time window, the worker roles in the primary region can drain the queues.</span></span> <span data-ttu-id="1912c-356">此程序可免除資料庫合併的需求。</span><span class="sxs-lookup"><span data-stu-id="1912c-356">This process eliminates the need for database merging.</span></span> <span data-ttu-id="1912c-357">如果主要區域服務中斷超出可容忍的範圍，應用程式即可開始處理佇列。</span><span class="sxs-lookup"><span data-stu-id="1912c-357">If the primary region service disruption goes beyond the tolerable window, the application can start processing the queues.</span></span>

<span data-ttu-id="1912c-358">在此案例中，次要區域中的資料庫包含必須在主要資料庫重新啟動後合併的遞增交易資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-358">In this scenario, the database in the secondary region contains incremental transactional data that must be merged after the primary is reactivated.</span></span> <span data-ttu-id="1912c-359">下圖顯示此策略來暫時儲存交易資料，直到還原主要區域為止。</span><span class="sxs-lookup"><span data-stu-id="1912c-359">The following diagram shows this strategy for temporarily storing transactional data until the primary region is restored.</span></span>

![降低應用程式功能以擷取交易](./images/disaster-recovery-azure-applications/reduced-application-functionality-for-transaction-capture.png)

<span data-ttu-id="1912c-361">如需復原 Azure 應用程式的資料管理技術的詳細討論，請參閱 [Failsafe︰恢復雲端架構指引](https://channel9.msdn.com/Series/FailSafe)。</span><span class="sxs-lookup"><span data-stu-id="1912c-361">For more discussion of data management techniques for resilient Azure applications, see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="deployment-topologies-for-disaster-recovery"></a><span data-ttu-id="1912c-362">災害復原的部署拓撲</span><span class="sxs-lookup"><span data-stu-id="1912c-362">Deployment topologies for disaster recovery</span></span>
<span data-ttu-id="1912c-363">您必須準備關鍵性應用程式，以便處理全區域的服務中斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-363">You must prepare mission-critical applications to handle region-wide service disruptions.</span></span> <span data-ttu-id="1912c-364">將多重區域部署策略納入作業規劃中。</span><span class="sxs-lookup"><span data-stu-id="1912c-364">Incorporate a multiple-region deployment strategy into the operational planning.</span></span>

<span data-ttu-id="1912c-365">多重區域部署可能涉及 IT 處理程序，以在災害後將應用程式和參考資料發佈到次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-365">Multiple-region deployments might involve IT processes to publish the application and reference data to the secondary region after a disaster.</span></span> <span data-ttu-id="1912c-366">如果應用程式需要立即容錯移轉，則部署程序可能涉及主動/被動設定或主動/主動設定。</span><span class="sxs-lookup"><span data-stu-id="1912c-366">If the application requires instant failover, the deployment process might involve an active/passive setup or an active/active setup.</span></span> <span data-ttu-id="1912c-367">這種部署類型會有在替代區域中執行的現有應用程式執行個體。</span><span class="sxs-lookup"><span data-stu-id="1912c-367">This type of deployment has existing instances of the application running in the alternate region.</span></span> <span data-ttu-id="1912c-368">Azure 流量管理員等路由服務可提供 DNS 層級的負載平衡服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-368">A routing service such as Azure Traffic Manager provides load-balancing services at the DNS level.</span></span> <span data-ttu-id="1912c-369">它可以偵測服務中斷，而必要時會將使用者路由到不同的區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-369">It can detect service disruptions and route the users to different regions when needed.</span></span>

<span data-ttu-id="1912c-370">成功的 Azure 災害復原包括從一開始就將該復原功能建置到解決方案中。</span><span class="sxs-lookup"><span data-stu-id="1912c-370">A successful Azure disaster recovery includes building that recovery into the solution from the start.</span></span> <span data-ttu-id="1912c-371">雲端可提供其他在災害期間從失敗復原的選項，而這些是傳統主機服務提供者所沒有的選項。</span><span class="sxs-lookup"><span data-stu-id="1912c-371">The cloud provides additional options for recovering from failures during a disaster that are not available in a traditional hosting provider.</span></span> <span data-ttu-id="1912c-372">具體來說，您可以在不同區域中以動態方式快速地配置資源，避免閒置資源在失敗發生前產生成本。</span><span class="sxs-lookup"><span data-stu-id="1912c-372">Specifically, you can dynamically and quickly allocate resources in a different region, avoiding the cost of idle resources prior to a failure.</span></span>

<span data-ttu-id="1912c-373">下列各節涵蓋災害復原的各種部署拓撲。</span><span class="sxs-lookup"><span data-stu-id="1912c-373">The following sections cover different deployment topologies for disaster recovery.</span></span> <span data-ttu-id="1912c-374">一般而言，增加成本或複雜性與取得額外可用性會有所折衷。</span><span class="sxs-lookup"><span data-stu-id="1912c-374">Typically, there's a tradeoff in increased cost or complexity for additional availability.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="1912c-375">單一區域部署</span><span class="sxs-lookup"><span data-stu-id="1912c-375">Single-region deployment</span></span>
<span data-ttu-id="1912c-376">單一區域部署並不是災害復原拓撲，而是為了與其他架構對比。</span><span class="sxs-lookup"><span data-stu-id="1912c-376">A single-region deployment is not really a disaster recovery topology, but is meant to contrast with the other architectures.</span></span> <span data-ttu-id="1912c-377">Azure 中的應用程式通常會使用單一區域部署，但這種方式並不符合災害復原拓撲的需求。</span><span class="sxs-lookup"><span data-stu-id="1912c-377">Single-region deployments are common for applications in Azure; however, they do not meet the requirements of a disaster recovery topology.</span></span>

<span data-ttu-id="1912c-378">下圖說明在單一 Azure 區域中執行的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-378">The following diagram depicts an application running in a single Azure region.</span></span> <span data-ttu-id="1912c-379">Azure 流量管理員以及使用容錯和升級網域會增加區域內的應用程式可用性。</span><span class="sxs-lookup"><span data-stu-id="1912c-379">Azure Traffic Manager and the use of fault and upgrade domains increase availability of the application within the region.</span></span>

![單一區域部署](./images/disaster-recovery-azure-applications/single-region-deployment.png)

<span data-ttu-id="1912c-381">在此案例中，資料庫是單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="1912c-381">In this scenario, the database is a single point of failure.</span></span> <span data-ttu-id="1912c-382">雖然 Azure 會將不同容錯網域的資料複寫到內部複本，但這樣的複製只會在相同的區域內發生。</span><span class="sxs-lookup"><span data-stu-id="1912c-382">Though Azure replicates the data across different fault domains to internal replicas, this replication occurs only within the same region.</span></span> <span data-ttu-id="1912c-383">應用程式經不起嚴重失敗。</span><span class="sxs-lookup"><span data-stu-id="1912c-383">The application cannot withstand a catastrophic failure.</span></span> <span data-ttu-id="1912c-384">如果該區域停止運作，則容錯網域也會停止運作，包括其中的所有服務執行個體和儲存體資源。</span><span class="sxs-lookup"><span data-stu-id="1912c-384">If the region becomes unavailable, then so do the fault domains, including all service instances and storage resources.</span></span>

<span data-ttu-id="1912c-385">對於所有應用程式 (最不重要的應用程式除外)，您必須設計一個計畫來將您的應用程式部署於多個區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-385">For all but the least critical applications, you must devise a plan to deploy your applications across multiple regions.</span></span> <span data-ttu-id="1912c-386">在考慮要使用哪一個部署拓撲時，您也應該考慮 RTO 和成本限制。</span><span class="sxs-lookup"><span data-stu-id="1912c-386">You should also consider RTO and cost constraints in considering which deployment topology to use.</span></span>

<span data-ttu-id="1912c-387">我們現在來看看可支援跨不同區域容錯移轉的特定方法。</span><span class="sxs-lookup"><span data-stu-id="1912c-387">Let's take a look now at specific approaches to supporting failover across different regions.</span></span> <span data-ttu-id="1912c-388">這些範例全都使用兩個區域來描述此程序。</span><span class="sxs-lookup"><span data-stu-id="1912c-388">These examples all use two regions to describe the process.</span></span>

### <a name="failover-using-azure-site-recovery"></a><span data-ttu-id="1912c-389">使用 Azure Site Recovery 進行容錯移轉</span><span class="sxs-lookup"><span data-stu-id="1912c-389">Failover using Azure Site Recovery</span></span>

<span data-ttu-id="1912c-390">當您使用 Azure Site Recovery 啟用 Azure VM 複寫時，它會在次要地區中建立數個資源：</span><span class="sxs-lookup"><span data-stu-id="1912c-390">When you enable Azure VM replication using Azure Site Recovery, it creates several resources in the secondary region:</span></span>

- <span data-ttu-id="1912c-391">資源群組。</span><span class="sxs-lookup"><span data-stu-id="1912c-391">Resource group.</span></span>
- <span data-ttu-id="1912c-392">虛擬網路 (VNet)。</span><span class="sxs-lookup"><span data-stu-id="1912c-392">Virtual network (VNet).</span></span>
- <span data-ttu-id="1912c-393">儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="1912c-393">Storage account.</span></span> 
- <span data-ttu-id="1912c-394">容錯移轉後要保存 VM 的可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="1912c-394">Availability sets to hold VMs after failover.</span></span>

<span data-ttu-id="1912c-395">主要區域中 VM 磁碟上的資料寫入會持續傳送到次要地區中的儲存體帳戶。</span><span class="sxs-lookup"><span data-stu-id="1912c-395">Data writes on the VM disks in the primary region are continuously transferred to the storage account in the secondary region.</span></span> <span data-ttu-id="1912c-396">目標儲存體帳戶會每隔幾分鐘產生復原點。</span><span class="sxs-lookup"><span data-stu-id="1912c-396">Recovery points are generated in the target storage account every few minutes.</span></span> <span data-ttu-id="1912c-397">當您起始容錯移轉時，系統會在目標資源群組、VNet 和可用性設定組中建立已復原的 VM。</span><span class="sxs-lookup"><span data-stu-id="1912c-397">When you initiate a failover, the recovered VMs are created in the target resource group, VNet, and availability set.</span></span> <span data-ttu-id="1912c-398">在容錯移轉時，您可以選擇任何可用的復原點。</span><span class="sxs-lookup"><span data-stu-id="1912c-398">During a failover, you can choose any available recovery point.</span></span>


### <a name="redeployment-to-a-secondary-azure-region"></a><span data-ttu-id="1912c-399">重新部署到次要 Azure 區域</span><span class="sxs-lookup"><span data-stu-id="1912c-399">Redeployment to a secondary Azure region</span></span>
<span data-ttu-id="1912c-400">對於重新部署到次要區域的方法，只有主要區域會有應用程式和資料庫在執行。</span><span class="sxs-lookup"><span data-stu-id="1912c-400">For the approach of redeployment to a secondary region, only the primary region has applications and databases running.</span></span> <span data-ttu-id="1912c-401">次要地區並未設定為自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1912c-401">The secondary region is not set up for an automatic failover.</span></span> <span data-ttu-id="1912c-402">因此當災害發生時，您必須在新的區域中加快服務的所有組件。</span><span class="sxs-lookup"><span data-stu-id="1912c-402">So when a disaster occurs, you must spin up all the parts of the service in the new region.</span></span> <span data-ttu-id="1912c-403">這包括將雲端服務上傳至 Azure、部署雲端服務、還原資料，以及變更 DNS 以重新路由傳送流量。</span><span class="sxs-lookup"><span data-stu-id="1912c-403">This includes uploading a cloud service to Azure, deploying the cloud service, restoring the data, and changing DNS to reroute the traffic.</span></span>

<span data-ttu-id="1912c-404">雖然這是最經濟實惠的多區域選項，但其 RTO 特性最差。</span><span class="sxs-lookup"><span data-stu-id="1912c-404">Although this is the most affordable of the multiple-region options, it has the worst RTO characteristics.</span></span> <span data-ttu-id="1912c-405">在此模型中，服務封裝和資料庫備份會儲存在內部部署或在次要地區的 Azure Blob 儲存體執行個體中。</span><span class="sxs-lookup"><span data-stu-id="1912c-405">In this model, the service package and database backups are stored either on-premises or in the Azure Blob storage instance of the secondary region.</span></span> <span data-ttu-id="1912c-406">不過，您必須先部署新的服務並還原資料，才能恢復正常作業。</span><span class="sxs-lookup"><span data-stu-id="1912c-406">However, you must deploy a new service and restore the data before it resumes operation.</span></span> <span data-ttu-id="1912c-407">即使系統會完全自動地從備份儲存體傳輸資料，但佈建新的資料庫環境仍會耗費大量時間。</span><span class="sxs-lookup"><span data-stu-id="1912c-407">Even with full automation of the data transfer from backup storage, provisioning a new database environment consumes a lot of time.</span></span> <span data-ttu-id="1912c-408">將資料從備份磁碟儲存體移到次要地區上的空白資料庫，是還原過程中成本最高的部分。</span><span class="sxs-lookup"><span data-stu-id="1912c-408">Moving data from the backup disk storage to the empty database on the secondary region is the most expensive part of the restore process.</span></span> <span data-ttu-id="1912c-409">不過，您必須這麼做才能使新資料庫進入運作狀態，因為它不會進行複寫。</span><span class="sxs-lookup"><span data-stu-id="1912c-409">You must do this, however, to bring the new database to an operational state because it isn't replicated.</span></span>

<span data-ttu-id="1912c-410">最好的方法是將服務封裝存放在次要地區的 Blob 儲存體中。</span><span class="sxs-lookup"><span data-stu-id="1912c-410">The best approach is to store the service packages in Blob storage in the secondary region.</span></span> <span data-ttu-id="1912c-411">如此一來，當您從內部部署開發電腦部署時，就不需要將封裝上傳至 Azure。</span><span class="sxs-lookup"><span data-stu-id="1912c-411">This eliminates the need to upload the package to Azure, which is what happens when you deploy from an on-premises development machine.</span></span> <span data-ttu-id="1912c-412">您可以使用 PowerShell 指令碼，將服務封裝從 Blob 儲存體快速地部署到新的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-412">You can quickly deploy the service packages to a new cloud service from Blob storage by using PowerShell scripts.</span></span>

<span data-ttu-id="1912c-413">此選項只適合用於可容忍高 RTO 的非關鍵性應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-413">This option is practical only for non-critical applications that can tolerate a high RTO.</span></span> <span data-ttu-id="1912c-414">比方說，這可能適用於可中斷幾小時，但必須在 24 小時內恢復運作的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-414">For instance, this might work for an application that can be down for several hours but is required to be available within 24 hours.</span></span>

![重新部署到次要 Azure 區域](./images/disaster-recovery-azure-applications/redeploy-to-a-secondary-azure-region.png)

### <a name="active-passive"></a><span data-ttu-id="1912c-416">主動-被動</span><span class="sxs-lookup"><span data-stu-id="1912c-416">Active-passive</span></span>
<span data-ttu-id="1912c-417">主動-被動拓撲是許多公司偏愛的選擇。</span><span class="sxs-lookup"><span data-stu-id="1912c-417">An active-passive topology is the choice that many companies favor.</span></span> <span data-ttu-id="1912c-418">比起重新部署方法，此拓撲增加的成本相對較少，所以可改善 RTO。</span><span class="sxs-lookup"><span data-stu-id="1912c-418">This topology provides improvements to the RTO with a relatively small increase in cost over the redeployment approach.</span></span> <span data-ttu-id="1912c-419">在此案例中，也是有主要和次要 Azure 地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-419">In this scenario, there is again a primary and a secondary Azure region.</span></span> <span data-ttu-id="1912c-420">所有的流量會移至主要區域的作用中部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-420">All of the traffic goes to the active deployment on the primary region.</span></span> <span data-ttu-id="1912c-421">因為資料庫同時在這兩個區域上，所以次要地區的災害復原準備更加完善。</span><span class="sxs-lookup"><span data-stu-id="1912c-421">The secondary region is better prepared for disaster recovery because the database is running on both regions.</span></span> <span data-ttu-id="1912c-422">此外，兩者之間已備妥同步處理機制。</span><span class="sxs-lookup"><span data-stu-id="1912c-422">Additionally, a synchronization mechanism is in place between them.</span></span> <span data-ttu-id="1912c-423">這種待命方法可以有兩種變化︰僅限資料庫的方法或次要地區中的完整部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-423">This standby approach can involve two variations: a database-only approach or a complete deployment in the secondary region.</span></span>

#### <a name="database-only"></a><span data-ttu-id="1912c-424">僅限資料庫</span><span class="sxs-lookup"><span data-stu-id="1912c-424">Database only</span></span>
<span data-ttu-id="1912c-425">在主動-被動拓撲的第一種變化中，只有主要區域已部署雲端服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-425">In the first variation of the active-passive topology, only the primary region has a deployed cloud service application.</span></span> <span data-ttu-id="1912c-426">不過，有別於重新部署方法，這兩個區域會同步處理資料庫的內容。</span><span class="sxs-lookup"><span data-stu-id="1912c-426">However, unlike the redeployment approach, both regions are synchronized with the contents of the database.</span></span> <span data-ttu-id="1912c-427">(如需詳細資訊，請參閱[災害復原的交易資料模式](#transactional-data-pattern-for-disaster-recovery)一節)。發生災害時，啟用需求比較少。</span><span class="sxs-lookup"><span data-stu-id="1912c-427">(For more information, see the section on [transactional data pattern for disaster recovery](#transactional-data-pattern-for-disaster-recovery).) When a disaster occurs, there are fewer activation requirements.</span></span> <span data-ttu-id="1912c-428">您會在次要地區中啟動應用程式、變更新資料庫的連接字串，並變更 DNS 項目，以重新路由傳送流量。</span><span class="sxs-lookup"><span data-stu-id="1912c-428">You start the application in the secondary region, change connection strings to the new database, and change the DNS entries to reroute traffic.</span></span>

<span data-ttu-id="1912c-429">如同重新部署方法，您應該已在次要地區的 Azure Blob 儲存體中儲存服務封裝，以便加快部署速度。</span><span class="sxs-lookup"><span data-stu-id="1912c-429">Like the redeployment approach, you should have already stored the service packages in Azure Blob storage in the secondary region for faster deployment.</span></span> <span data-ttu-id="1912c-430">不過，您不必承受資料庫還原作業所需的大部分額外負擔，因為資料庫已就緒且正在執行。</span><span class="sxs-lookup"><span data-stu-id="1912c-430">However, you don’t incur the majority of the overhead that database restore operation requires, because the database is ready and running.</span></span> <span data-ttu-id="1912c-431">這可節省大量的時間，讓此模式成為經濟實惠的 DR 模式 (也是最常使用的模式)。</span><span class="sxs-lookup"><span data-stu-id="1912c-431">This saves a significant amount of time, making this an affordable DR pattern (and the one most frequently used).</span></span>

![主動-被動, 僅限資料庫](./images/disaster-recovery-azure-applications/active-passive-database-only.png)

#### <a name="full-replica"></a><span data-ttu-id="1912c-433">完整複本</span><span class="sxs-lookup"><span data-stu-id="1912c-433">Full replica</span></span>
<span data-ttu-id="1912c-434">在主動-被動拓撲的第二種變化中，主要區域和次要地區都有完整的部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-434">In the second variation of the active-passive topology, both the primary region and the secondary region have a full deployment.</span></span> <span data-ttu-id="1912c-435">此部署包括雲端服務和已同步處理的資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-435">This deployment includes the cloud services and a synchronized database.</span></span> <span data-ttu-id="1912c-436">不過，只有主要區域會主動處理來自使用者的網路要求。</span><span class="sxs-lookup"><span data-stu-id="1912c-436">However, only the primary region is actively handling network requests from the users.</span></span> <span data-ttu-id="1912c-437">只有當主要區域發生服務中斷時，次要地區才會變成主動。</span><span class="sxs-lookup"><span data-stu-id="1912c-437">The secondary region becomes active only when the primary region experiences a service disruption.</span></span> <span data-ttu-id="1912c-438">在此情況下，所有新的網路要求會路由傳送到次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-438">In that case, all new network requests route to the secondary region.</span></span> <span data-ttu-id="1912c-439">Azure 流量管理員可以自動管理此容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="1912c-439">Azure Traffic Manager can manage this failover automatically.</span></span>

<span data-ttu-id="1912c-440">因為已經部署服務，所以容錯移轉發生的速度比僅限資料庫變化快。</span><span class="sxs-lookup"><span data-stu-id="1912c-440">Failover occurs faster than the database-only variation because the services are already deployed.</span></span> <span data-ttu-id="1912c-441">此拓撲提供了非常低的 RTO。</span><span class="sxs-lookup"><span data-stu-id="1912c-441">This topology provides a very low RTO.</span></span> <span data-ttu-id="1912c-442">次要的容錯移轉區域必須準備好在主要區域失敗後立即開始。</span><span class="sxs-lookup"><span data-stu-id="1912c-442">The secondary failover region must be ready to go immediately after failure of the primary region.</span></span>

<span data-ttu-id="1912c-443">伴隨著更快的回應時間，此拓撲會預先配置和部署備份服務，讓您不會在災害期間要配置新執行個體時卻沒有空間。</span><span class="sxs-lookup"><span data-stu-id="1912c-443">Along with a quicker response time, this topology pre-allocates and deploys backup services, avoiding the possibility of a lack of space to allocate new instances during a disaster.</span></span> <span data-ttu-id="1912c-444">如果您的次要 Azure 區域逼近容量上限，這點很重要。</span><span class="sxs-lookup"><span data-stu-id="1912c-444">This is important if your secondary Azure region is nearing capacity.</span></span> <span data-ttu-id="1912c-445">沒有任何服務等級協定 (SLA) 可保證您能夠立即在任何區域部署一或多個新的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-445">No service-level agreement (SLA) guarantees that you can instantly deploy one or more new cloud services in any region.</span></span>

<span data-ttu-id="1912c-446">若要以此模型達到最快的回應時間，您在主要和次要地區中必須具有類似的規模 (角色執行個體數目)。</span><span class="sxs-lookup"><span data-stu-id="1912c-446">For the fastest response time with this model, you must have similar scale (number of role instances) in the primary and secondary regions.</span></span> <span data-ttu-id="1912c-447">儘管有些優點，但支付未使用計算執行個體的代價很高，而這可能不是最審慎的財務選擇。</span><span class="sxs-lookup"><span data-stu-id="1912c-447">Despite the advantages, paying for unused compute instances is costly, and this might not be the most prudent financial choice.</span></span> <span data-ttu-id="1912c-448">基於這點，所以在次要地區上較常使用稍微相應縮減的雲端服務版本。</span><span class="sxs-lookup"><span data-stu-id="1912c-448">Because of this, it's more common to use a slightly scaled-down version of cloud services on the secondary region.</span></span> <span data-ttu-id="1912c-449">然後您即可視需要，快速地容錯移轉和相應擴大次要部署。</span><span class="sxs-lookup"><span data-stu-id="1912c-449">Then you can quickly fail over and scale out the secondary deployment if necessary.</span></span> <span data-ttu-id="1912c-450">您應讓容錯移轉程序自動化，以便在無法存取主要區域後，根據負載啟動其他執行個體。</span><span class="sxs-lookup"><span data-stu-id="1912c-450">You should automate the failover process so that after the primary region is inaccessible, you activate additional instances, depending on the load.</span></span> <span data-ttu-id="1912c-451">這可能會牽涉到使用自動調整機制，如 [虛擬機器擴展集](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-451">This might involve the use of an autoscaling mechanism like [virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="1912c-452">在下圖顯示的模型中，主要和次要地區均包含主動-被動拓撲中完整部署的雲端服務。</span><span class="sxs-lookup"><span data-stu-id="1912c-452">The following diagram shows the model where the primary and secondary regions contain a fully deployed cloud service in an active-passive topology.</span></span>

![主動-被動, 完整複本](./images/disaster-recovery-azure-applications/active-passive-full-replica.png)

### <a name="active-active"></a><span data-ttu-id="1912c-454">主動-主動</span><span class="sxs-lookup"><span data-stu-id="1912c-454">Active-active</span></span>
<span data-ttu-id="1912c-455">在主動-主動拓撲中，雲端服務和資料庫已完整部署於這兩個區域中。</span><span class="sxs-lookup"><span data-stu-id="1912c-455">In an active-active topology, the cloud services and database are fully deployed in both regions.</span></span> <span data-ttu-id="1912c-456">不同於主動-被動模式，這兩個區域都會接收使用者流量。</span><span class="sxs-lookup"><span data-stu-id="1912c-456">Unlike the active-passive model, both regions receive user traffic.</span></span> <span data-ttu-id="1912c-457">此選項會產生最快的復原時間。</span><span class="sxs-lookup"><span data-stu-id="1912c-457">This option yields the quickest recovery time.</span></span> <span data-ttu-id="1912c-458">服務已經調整成能夠處理每個區域的部分負載。</span><span class="sxs-lookup"><span data-stu-id="1912c-458">The services are already scaled to handle a portion of the load at each region.</span></span> <span data-ttu-id="1912c-459">已啟用 DNS 來使用次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-459">DNS is already enabled to use the secondary region.</span></span> <span data-ttu-id="1912c-460">在決定如何將使用者路由到適當區域時，有額外的複雜性。</span><span class="sxs-lookup"><span data-stu-id="1912c-460">There's additional complexity in determining how to route users to the appropriate region.</span></span> <span data-ttu-id="1912c-461">循環配置資源排程或許可行。</span><span class="sxs-lookup"><span data-stu-id="1912c-461">Round-robin scheduling might be possible.</span></span> <span data-ttu-id="1912c-462">使用者比較可能使用其資料的主要複本所在的特定區域。</span><span class="sxs-lookup"><span data-stu-id="1912c-462">It's more likely that certain users would use a specific region where the primary copy of their data resides.</span></span>

<span data-ttu-id="1912c-463">在容錯移轉的情況下，只需停用主要區域的 DNS。</span><span class="sxs-lookup"><span data-stu-id="1912c-463">In case of failover, simply disable DNS to the primary region.</span></span> <span data-ttu-id="1912c-464">這會將所有流量都路由傳送到次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-464">This routes all traffic to the secondary region.</span></span>

<span data-ttu-id="1912c-465">即使在此模型中，仍有一些變化。</span><span class="sxs-lookup"><span data-stu-id="1912c-465">Even in this model, there are some variations.</span></span> <span data-ttu-id="1912c-466">例如，下圖顯示的主要區域擁有資料庫的主要複本。</span><span class="sxs-lookup"><span data-stu-id="1912c-466">For example, the following diagram depicts a primary region which owns the master copy of the database.</span></span> <span data-ttu-id="1912c-467">兩個區域中的雲端服務會寫入至該主要資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-467">The cloud services in both regions write to that primary database.</span></span> <span data-ttu-id="1912c-468">次要部署可以主要或複寫的資料庫讀取資料。</span><span class="sxs-lookup"><span data-stu-id="1912c-468">The secondary deployment can read from the primary or replicated database.</span></span> <span data-ttu-id="1912c-469">此範例中的複寫是單向的。</span><span class="sxs-lookup"><span data-stu-id="1912c-469">Replication in this example is one-way.</span></span>

![主動-主動](./images/disaster-recovery-azure-applications/active-active.png)

<span data-ttu-id="1912c-471">上圖中的主動-主動架構有一個缺點。</span><span class="sxs-lookup"><span data-stu-id="1912c-471">There is a downside to the active-active architecture in the preceding diagram.</span></span> <span data-ttu-id="1912c-472">第二個區域必須存取第一個區域中的資料庫，這是因為主要複本位於那裡。</span><span class="sxs-lookup"><span data-stu-id="1912c-472">The second region must access the database in the first region because the master copy resides there.</span></span> <span data-ttu-id="1912c-473">當您存取區域外部的資料時，效能會明顯降低</span><span class="sxs-lookup"><span data-stu-id="1912c-473">Performance significantly drops off when you access data from outside a region.</span></span> <span data-ttu-id="1912c-474">在跨區域的資料庫呼叫中，您應該考慮某種類型的批次策略，以改善這些呼叫的效能。</span><span class="sxs-lookup"><span data-stu-id="1912c-474">In cross-region database calls, you should consider some type of batching strategy to improve the performance of these calls.</span></span> <span data-ttu-id="1912c-475">如需詳細資訊，請參閱[如何使用批次處理來改善 SQL Database 應用程式效能](/azure/sql-database/sql-database-use-batching-to-improve-performance/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-475">For more information, see [How to use batching to improve SQL Database application performance](/azure/sql-database/sql-database-use-batching-to-improve-performance/).</span></span>

<span data-ttu-id="1912c-476">替代架構可能會牽涉到每個區域直接存取其本身的資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-476">An alternative architecture might involve each region accessing its own database directly.</span></span> <span data-ttu-id="1912c-477">在該模型中，需要某種類型的雙向複寫，才能同步處理每個區域中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="1912c-477">In that model, some type of bidirectional replication is required to synchronize the databases in each region.</span></span>

<span data-ttu-id="1912c-478">在先前的拓撲中，降低 RTO 一般會增加成本和複雜度。</span><span class="sxs-lookup"><span data-stu-id="1912c-478">With the previous topologies, decreasing RTO generally increases costs and complexity.</span></span> <span data-ttu-id="1912c-479">主動-主動拓撲則與此成本模式背離。</span><span class="sxs-lookup"><span data-stu-id="1912c-479">The active-active topology deviates from this cost pattern.</span></span> <span data-ttu-id="1912c-480">在主動-主動拓撲中，主要區域上的執行個體可能不需要像主動-被動拓撲中這麼多。</span><span class="sxs-lookup"><span data-stu-id="1912c-480">In the active-active topology, you might not need as many instances on the primary region as you would in the active-passive topology.</span></span> <span data-ttu-id="1912c-481">如果主動-被動架構中的主要區域上有 10 個執行個體，則主動-主動架構中的每個區域可能只需要 5 個執行個體。</span><span class="sxs-lookup"><span data-stu-id="1912c-481">If you have 10 instances on the primary region in an active-passive architecture, you might need only 5 in each region in an active-active architecture.</span></span> <span data-ttu-id="1912c-482">兩個區域現在會分擔負載。</span><span class="sxs-lookup"><span data-stu-id="1912c-482">Both regions now share the load.</span></span> <span data-ttu-id="1912c-483">如果您在有 10 個執行個體等待容錯移轉的被動區域上保持暖待命狀態，這可能比主動-被動拓撲更節省成本。</span><span class="sxs-lookup"><span data-stu-id="1912c-483">This might be a cost savings over the active-passive topology if you keep a warm standby on the passive region with 10 instances waiting for failover.</span></span>

<span data-ttu-id="1912c-484">請注意在您還原主要區域前，次要地區可能會收到突然湧入的新使用者。</span><span class="sxs-lookup"><span data-stu-id="1912c-484">Realize that until you restore the primary region, the secondary region might receive a sudden surge of new users.</span></span> <span data-ttu-id="1912c-485">如果當主要區域遭遇服務中斷時，每部伺服器上有 10000 名使用者，則次要地區會突然必須處理 20000 名使用者。</span><span class="sxs-lookup"><span data-stu-id="1912c-485">If there are 10,000 users on each server when the primary region experiences a service disruption, the secondary region suddenly has to handle 20,000 users.</span></span> <span data-ttu-id="1912c-486">監視次要地區的規則時，必須偵測這種增加量並且讓次要地區中的執行個體加倍。</span><span class="sxs-lookup"><span data-stu-id="1912c-486">Monitoring rules on the secondary region must detect this increase and double the instances in the secondary region.</span></span> <span data-ttu-id="1912c-487">如需詳細資訊，請參閱 [失敗偵測](#failure-detection)一節。</span><span class="sxs-lookup"><span data-stu-id="1912c-487">For more information on this, see the section on [failure detection](#failure-detection).</span></span>

## <a name="hybrid-on-premises-and-cloud-solution"></a><span data-ttu-id="1912c-488">混合式內部部署與雲端解決方案</span><span class="sxs-lookup"><span data-stu-id="1912c-488">Hybrid on-premises and cloud solution</span></span>
<span data-ttu-id="1912c-489">災害復原的其他策略之一是設計一個可在內部部署和雲端執行的混合式應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-489">One additional strategy for disaster recovery is to architect a hybrid application that runs on-premises and in the cloud.</span></span> <span data-ttu-id="1912c-490">視應用程式而定，主要區域可能位於任一個位置。</span><span class="sxs-lookup"><span data-stu-id="1912c-490">Depending on the application, the primary region might be either location.</span></span> <span data-ttu-id="1912c-491">請考量先前的架構，再想像以主要或次要地區做為內部部署位置。</span><span class="sxs-lookup"><span data-stu-id="1912c-491">Consider the previous architectures and imagine the primary or secondary region as an on-premises location.</span></span>

<span data-ttu-id="1912c-492">這些混合式架構中有一些挑戰。</span><span class="sxs-lookup"><span data-stu-id="1912c-492">There are some challenges in these hybrid architectures.</span></span> <span data-ttu-id="1912c-493">首先，本文大致已處理 PaaS 架構模式。</span><span class="sxs-lookup"><span data-stu-id="1912c-493">First, most of this article has addressed PaaS architecture patterns.</span></span> <span data-ttu-id="1912c-494">Azure 中的 PaaS 應用程式通常仰賴 Azure 特有的概念，例如角色、雲端服務和流量管理員。</span><span class="sxs-lookup"><span data-stu-id="1912c-494">Typical PaaS applications in Azure rely on Azure-specific constructs such as roles, cloud services, and Traffic Manager.</span></span> <span data-ttu-id="1912c-495">建立這類型 PaaS 應用程式的內部部署解決方案，會需要截然不同的架構。</span><span class="sxs-lookup"><span data-stu-id="1912c-495">Creating an on-premises solution for this type of PaaS application would require a significantly different architecture.</span></span> <span data-ttu-id="1912c-496">從管理或成本的觀點來看，這可能不可行。</span><span class="sxs-lookup"><span data-stu-id="1912c-496">This might not be feasible from a management or cost perspective.</span></span>

<span data-ttu-id="1912c-497">不過，對於已移轉至雲端的傳統架構 (例如 IaaS 型架構)，混合式的災害復原解決方案的挑戰比較小。</span><span class="sxs-lookup"><span data-stu-id="1912c-497">However, a hybrid solution for disaster recovery has fewer challenges for traditional architectures that have been migrated to the cloud, such as IaaS-based architectures.</span></span> <span data-ttu-id="1912c-498">IaaS 應用程式會使用雲端中可有直接內部部署對等項目的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="1912c-498">IaaS applications use virtual machines in the cloud that can have direct on-premises equivalents.</span></span> <span data-ttu-id="1912c-499">您也可以使用虛擬網路來連接雲端的機器與內部部署網路資源。</span><span class="sxs-lookup"><span data-stu-id="1912c-499">You can also use virtual networks to connect machines in the cloud with on-premises network resources.</span></span> <span data-ttu-id="1912c-500">這可為僅限的 PaaS 應用程式帶來多種可能性。</span><span class="sxs-lookup"><span data-stu-id="1912c-500">This allows several possibilities that are not possible with PaaS-only applications.</span></span> <span data-ttu-id="1912c-501">例如，SQL Server 可以利用災害復原解決方案，例如 AlwaysOn 可用性群組和資料庫鏡像。</span><span class="sxs-lookup"><span data-stu-id="1912c-501">For example, SQL Server can take advantage of disaster recovery solutions such as AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="1912c-502">如需詳細資訊，請參閱 [Azure 虛擬機器中的 SQL Server 高可用性和災害復原](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-502">For details, see [High availability and disaster recovery for SQL Server in Azure virtual machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

<span data-ttu-id="1912c-503">IaaS 解決方案也為內部部署應用程式提供比較簡單的路徑，以便使用 Azure 做為容錯移轉選項。</span><span class="sxs-lookup"><span data-stu-id="1912c-503">IaaS solutions also provide an easier path for on-premises applications to use Azure as the failover option.</span></span> <span data-ttu-id="1912c-504">您在現有的內部部署區域中可能有功能完整的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-504">You might have a fully functioning application in an existing on-premises region.</span></span> <span data-ttu-id="1912c-505">不過，如果您沒有足夠的資源可維護不同位置的區域以供容錯移轉，該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="1912c-505">However, what if you lack the resources to maintain a geographically separate region for failover?</span></span> <span data-ttu-id="1912c-506">您可決定使用虛擬機器和虛擬網路來取得在 Azure 中執行的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-506">You might decide to use virtual machines and virtual networks to get your application running in Azure.</span></span> <span data-ttu-id="1912c-507">在該情況下，定義可將資料同步處理到雲端的程序。</span><span class="sxs-lookup"><span data-stu-id="1912c-507">In that case, define processes that synchronize data to the cloud.</span></span> <span data-ttu-id="1912c-508">然後 Azure 部署會變成要用於容錯移轉的次要地區。</span><span class="sxs-lookup"><span data-stu-id="1912c-508">The Azure deployment then becomes the secondary region to use for failover.</span></span> <span data-ttu-id="1912c-509">主要區域會保留內部部署應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-509">The primary region remains the on-premises application.</span></span> <span data-ttu-id="1912c-510">如需 IaaS 架構和功能的詳細資訊，請參閱 [虛擬機器文件](https://azure.microsoft.com/documentation/services/virtual-machines/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-510">For more information about IaaS architectures and capabilities, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="alternative-cloud"></a><span data-ttu-id="1912c-511">替代雲端</span><span class="sxs-lookup"><span data-stu-id="1912c-511">Alternative cloud</span></span>
<span data-ttu-id="1912c-512">有時候，廣泛的 Microsoft Azure 功能可能仍無法滿足貴組織所需的內部合規性規則或原則。</span><span class="sxs-lookup"><span data-stu-id="1912c-512">There are situations where the broad capabilities of Microsoft Azure still may not meet internal compliance rules or policies required by your organization.</span></span> <span data-ttu-id="1912c-513">甚至準備萬全且專為在災害期間實作備份系統所設計，在雲端服務提供者全面中斷服務的情況下，仍有所不足。</span><span class="sxs-lookup"><span data-stu-id="1912c-513">Even the best preparation and design to implement backup systems during a disaster are inadequate during a global service disruption of a cloud service provider.</span></span>

<span data-ttu-id="1912c-514">您應該比較可用性需求與提高可用性的成本和複雜度。</span><span class="sxs-lookup"><span data-stu-id="1912c-514">You should compare availability requirements with the cost and complexity of increased availability.</span></span> <span data-ttu-id="1912c-515">請執行風險分析，並定義您的解決方案的 RTO 和 RPO。</span><span class="sxs-lookup"><span data-stu-id="1912c-515">Perform a risk analysis, and define the RTO and RPO for your solution.</span></span> <span data-ttu-id="1912c-516">如果您的應用程式無法容忍任何停機時間，您可能要考慮使用其他雲端解決方案。</span><span class="sxs-lookup"><span data-stu-id="1912c-516">If your application cannot tolerate any downtime, you might consider using an additional cloud solution.</span></span> <span data-ttu-id="1912c-517">除非整個網際網路中斷，否則 Azure 全面無法存取時仍可使用另一個雲端解決方案。</span><span class="sxs-lookup"><span data-stu-id="1912c-517">Unless the entire Internet goes down, another cloud solution might still be available if Azure becomes globally inaccessible.</span></span>

<span data-ttu-id="1912c-518">如同混合式案例一樣，先前災害復原架構中的容錯移轉部署也可以存在於另一個雲端解決方案中。</span><span class="sxs-lookup"><span data-stu-id="1912c-518">As with the hybrid scenario, the failover deployments in the previous disaster recovery architectures can also exist within another cloud solution.</span></span> <span data-ttu-id="1912c-519">替代雲端 DR 網站只能用於 RTO 允許極短停機時間的解決方案。</span><span class="sxs-lookup"><span data-stu-id="1912c-519">Alternative cloud DR sites should be used only for solutions whose RTO allows very little, if any, downtime.</span></span> <span data-ttu-id="1912c-520">請注意，使用 Azure 外部 DR 網站的解決方案需要執行更多工作才能設定、開發、部署和維護。</span><span class="sxs-lookup"><span data-stu-id="1912c-520">Note that a solution that uses a DR site outside Azure will require more work to configure, develop, deploy, and maintain.</span></span> <span data-ttu-id="1912c-521">此外，經過實證的做法也比較難以在跨雲端的架構中實作。</span><span class="sxs-lookup"><span data-stu-id="1912c-521">It's also more difficult to implement proven practices in a cross-cloud architecture.</span></span> <span data-ttu-id="1912c-522">雖然雲端平台有類似的高階概念，但 API 和架構不同。</span><span class="sxs-lookup"><span data-stu-id="1912c-522">Although cloud platforms have similar high-level concepts, the APIs and architectures are different.</span></span>

<span data-ttu-id="1912c-523">如果您的 DR 策略依賴多個雲端平台，則將抽象層納入解決方案的設計中便很重要。</span><span class="sxs-lookup"><span data-stu-id="1912c-523">If your DR strategy relies upon multiple cloud platforms, it's valuable to include abstraction layers in the design of the solution.</span></span> <span data-ttu-id="1912c-524">這可讓您不需要在發生災害時針對不同的雲端平台，開發及維護兩個不同版本的相同應用程式。</span><span class="sxs-lookup"><span data-stu-id="1912c-524">This eliminates the need to develop and maintain two different versions of the same application for different cloud platforms in case of disaster.</span></span> <span data-ttu-id="1912c-525">如同混合式案例，在這些情況下，使用 Azure 虛擬機器或 Azure 容器服務，可能會比使用雲端特有的 PaaS 設計簡單。</span><span class="sxs-lookup"><span data-stu-id="1912c-525">As with the hybrid scenario, the use of Azure Virtual Machines or Azure Container Service might be easier in these cases than the use of cloud-specific PaaS designs.</span></span>

## <a name="automation"></a><span data-ttu-id="1912c-526">自動化</span><span class="sxs-lookup"><span data-stu-id="1912c-526">Automation</span></span>
<span data-ttu-id="1912c-527">先前所討論的某些模式必須快速啟動離線部署，以及還原系統的特定部分。</span><span class="sxs-lookup"><span data-stu-id="1912c-527">Some of the patterns that we just discussed require quick activation of offline deployments as well as restoration of specific parts of a system.</span></span> <span data-ttu-id="1912c-528">自動化指令碼能夠啟動隨選資源及快速部署解決方案。</span><span class="sxs-lookup"><span data-stu-id="1912c-528">Automation scripts can activate resources on demand and deploy solutions rapidly.</span></span> <span data-ttu-id="1912c-529">下面的 DR 相關自動化範例使用 [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx)，但使用 [Azure CLI](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli) 或[服務管理 REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx) 也是很好的選項。</span><span class="sxs-lookup"><span data-stu-id="1912c-529">The DR-related automation examples below use [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx), but using the [Azure CLI](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli) or the [Service Management REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx) are also good options.</span></span>

<span data-ttu-id="1912c-530">自動化指令碼可管理 Azure 未能透明處理的 DR 層面。</span><span class="sxs-lookup"><span data-stu-id="1912c-530">Automation scripts manage aspects of DR not transparently handled by Azure.</span></span> <span data-ttu-id="1912c-531">這種方式可產生一致且可重複的結果，進而減少人為錯誤。</span><span class="sxs-lookup"><span data-stu-id="1912c-531">This produces consistent and repeatable results, minimizing human error.</span></span> <span data-ttu-id="1912c-532">預先定義的 DR 指令碼也可減少災害發生期間重建系統及其構成部分所需的時間。</span><span class="sxs-lookup"><span data-stu-id="1912c-532">Predefined DR scripts also reduce the time to rebuild a system and its constituent parts during a disaster.</span></span> <span data-ttu-id="1912c-533">當網站已關閉且每分鐘都在虧錢時，您不會想嘗試以手動方式指出如何還原網站。</span><span class="sxs-lookup"><span data-stu-id="1912c-533">You don’t want to try to manually figure out how to restore your site while it's down and losing money every minute.</span></span>

<span data-ttu-id="1912c-534">從頭到尾重複地測試您的指令碼。</span><span class="sxs-lookup"><span data-stu-id="1912c-534">Test your scripts repeatedly from start to finish.</span></span> <span data-ttu-id="1912c-535">驗證其基本功能之後，請務必在[災害模擬](#disaster-simulation)中進行測試。</span><span class="sxs-lookup"><span data-stu-id="1912c-535">After verifying their basic functionality, make sure to test them in [disaster simulation](#disaster-simulation).</span></span> <span data-ttu-id="1912c-536">這有助於揭露指令碼或處理程序中的缺失。</span><span class="sxs-lookup"><span data-stu-id="1912c-536">This helps uncover defects in the scripts or processes.</span></span>

<span data-ttu-id="1912c-537">自動化的最佳做法是建立 Azure 災害復原 PowerShell 指令碼或命令列介面 (CLI) 指令碼的儲存機制。</span><span class="sxs-lookup"><span data-stu-id="1912c-537">A best practice with automation is to create a repository of PowerShell scripts or command-line interface (CLI) scripts for Azure disaster recovery.</span></span> <span data-ttu-id="1912c-538">清楚標示並加以分類，以便快速存取。</span><span class="sxs-lookup"><span data-stu-id="1912c-538">Clearly mark and categorize them for quick access.</span></span> <span data-ttu-id="1912c-539">指定主要人員來負責管理指令碼的存放庫和版本控制。</span><span class="sxs-lookup"><span data-stu-id="1912c-539">Designate a primary person to manage the repository and versioning of the scripts.</span></span> <span data-ttu-id="1912c-540">詳細記載這些指令碼，並提供參數說明和指令碼使用範例。</span><span class="sxs-lookup"><span data-stu-id="1912c-540">Document them well with explanations of parameters and examples of script use.</span></span> <span data-ttu-id="1912c-541">此外，請務必讓此文件與您的 Azure 部署保持同步。</span><span class="sxs-lookup"><span data-stu-id="1912c-541">Also ensure that you keep this documentation in sync with your Azure deployments.</span></span> <span data-ttu-id="1912c-542">這強調由主要人員負責存放庫所有組件的目的。</span><span class="sxs-lookup"><span data-stu-id="1912c-542">This underscores the purpose of having a primary person in charge of all parts of the repository.</span></span>

## <a name="failure-detection"></a><span data-ttu-id="1912c-543">失敗偵測</span><span class="sxs-lookup"><span data-stu-id="1912c-543">Failure detection</span></span>
<span data-ttu-id="1912c-544">若要正確處理可用性和災害復原的問題，您必須能夠偵測及診斷失敗。</span><span class="sxs-lookup"><span data-stu-id="1912c-544">To correctly handle problems with availability and disaster recovery, you must be able to detect and diagnose failures.</span></span> <span data-ttu-id="1912c-545">執行進階的伺服器和部署監視，以在系統或其元件突然無法使用時快速注意到。</span><span class="sxs-lookup"><span data-stu-id="1912c-545">Perform advanced server and deployment monitoring to quickly recognize when a system or its components suddenly become unavailable.</span></span> <span data-ttu-id="1912c-546">監視工具會評估雲端服務和其相依項目的整體健康狀態，所以可以執行部分的這項工作。</span><span class="sxs-lookup"><span data-stu-id="1912c-546">Monitoring tools that assess the overall health of the cloud service and its dependencies can perform part of this work.</span></span> <span data-ttu-id="1912c-547">[System Center 2016](https://www.microsoft.com/cloud-platform/system-center) 是其中一項合適的 Microsoft 工具。</span><span class="sxs-lookup"><span data-stu-id="1912c-547">One suitable Microsoft tool is [System Center 2016](https://www.microsoft.com/cloud-platform/system-center).</span></span> <span data-ttu-id="1912c-548">協力廠商工具也可以提供監視功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-548">Third-party tools can also provide monitoring capabilities.</span></span> <span data-ttu-id="1912c-549">大部分監視解決方案會追蹤關鍵效能計數器和服務可用性。</span><span class="sxs-lookup"><span data-stu-id="1912c-549">Most monitoring solutions track key performance counters and service availability.</span></span>

<span data-ttu-id="1912c-550">雖然這些工具很重要，但您必須規劃雲端服務內的錯誤偵測和報告功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-550">Although these tools are vital, you must plan for fault detection and reporting within a cloud service.</span></span> <span data-ttu-id="1912c-551">您也必須規劃適當使用 Azure 診斷。</span><span class="sxs-lookup"><span data-stu-id="1912c-551">You must also plan to properly use Azure Diagnostics.</span></span> <span data-ttu-id="1912c-552">自訂效能計數器或事件記錄檔項目也可以是整體策略的一部分。</span><span class="sxs-lookup"><span data-stu-id="1912c-552">Custom performance counters or event-log entries can also be part of the overall strategy.</span></span> <span data-ttu-id="1912c-553">這可在發生失敗時提供更多資料，以便快速診斷問題及恢復完整功能。</span><span class="sxs-lookup"><span data-stu-id="1912c-553">This provides more data during failures to quickly diagnose the problem and restore full capabilities.</span></span> <span data-ttu-id="1912c-554">它也提供其他計量，以便監視工具用來判斷應用程式健康狀態。</span><span class="sxs-lookup"><span data-stu-id="1912c-554">It also provides additional metrics that the monitoring tools can use to determine application health.</span></span> <span data-ttu-id="1912c-555">如需詳細資訊，請參閱 [在 Azure 雲端服務中啟用 Azure 診斷](/azure/cloud-services/cloud-services-dotnet-diagnostics/)。</span><span class="sxs-lookup"><span data-stu-id="1912c-555">For more information, see [Enabling Azure Diagnostics in Azure Cloud Services](/azure/cloud-services/cloud-services-dotnet-diagnostics/).</span></span> <span data-ttu-id="1912c-556">如需如何規劃整體「健康狀態模型」的討論，請參閱 [Failsafe︰恢復雲端架構指引](https://channel9.msdn.com/Series/FailSafe)。</span><span class="sxs-lookup"><span data-stu-id="1912c-556">For a discussion of how to plan for an overall “health model,” see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="disaster-simulation"></a><span data-ttu-id="1912c-557">災害模擬</span><span class="sxs-lookup"><span data-stu-id="1912c-557">Disaster simulation</span></span>
<span data-ttu-id="1912c-558">模擬測試牽涉到在工作樓層建立小型的真實情況，以觀察團隊成員的反應。</span><span class="sxs-lookup"><span data-stu-id="1912c-558">Simulation testing involves creating small real-life situations on the work floor to observe how the team members react.</span></span> <span data-ttu-id="1912c-559">模擬也會顯示解決方案在復原計畫中的有效性。</span><span class="sxs-lookup"><span data-stu-id="1912c-559">Simulations also show how effective the solutions are in the recovery plan.</span></span> <span data-ttu-id="1912c-560">以建立的案例不干擾實際業務，但仍覺得像是「真實」情況的方式執行模擬。</span><span class="sxs-lookup"><span data-stu-id="1912c-560">Execute simulations so that the created scenarios don't disrupt actual business, while still feeling like real situations.</span></span>

<span data-ttu-id="1912c-561">請考慮在應用程式中設計某種「切換表單」，以手動模擬可用性問題。</span><span class="sxs-lookup"><span data-stu-id="1912c-561">Consider architecting a type of “switchboard” in the application to manually simulate availability issues.</span></span> <span data-ttu-id="1912c-562">例如，透過軟體交換技術，讓排序模組無法運作，以觸發資料庫存取例外狀況。</span><span class="sxs-lookup"><span data-stu-id="1912c-562">For instance, through a soft switch, trigger database access exceptions for an ordering module by causing it to malfunction.</span></span> <span data-ttu-id="1912c-563">您可以對網路介面層級的其他模組，採取類似的輕量型方法。</span><span class="sxs-lookup"><span data-stu-id="1912c-563">You can take similar lightweight approaches for other modules at the network interface level.</span></span>

<span data-ttu-id="1912c-564">模擬會反白顯示任何處理不當的問題。</span><span class="sxs-lookup"><span data-stu-id="1912c-564">The simulation highlights any issues that were inadequately addressed.</span></span> <span data-ttu-id="1912c-565">模擬案例必須可完全控制。</span><span class="sxs-lookup"><span data-stu-id="1912c-565">The simulated scenarios must be completely controllable.</span></span> <span data-ttu-id="1912c-566">這表示，即使復原計畫似乎失敗，您可以讓情況還原到正常狀態，而不會造成任何重大損害。</span><span class="sxs-lookup"><span data-stu-id="1912c-566">This means that, even if the recovery plan seems to be failing, you can restore the situation back to normal without causing any significant damage.</span></span> <span data-ttu-id="1912c-567">此外，您也一定要知會管理高層何時及如何執行模擬演習。</span><span class="sxs-lookup"><span data-stu-id="1912c-567">It’s also important that you inform higher-level management about when and how the simulation exercises will be executed.</span></span> <span data-ttu-id="1912c-568">此計劃應詳述模擬期間受到影響的時間和資源。</span><span class="sxs-lookup"><span data-stu-id="1912c-568">This plan should detail the time or resources affected during the simulation.</span></span> <span data-ttu-id="1912c-569">也要定義測試災害復原計劃時的成功量值。</span><span class="sxs-lookup"><span data-stu-id="1912c-569">Also define the measures of success when testing your disaster recovery plan.</span></span>

<span data-ttu-id="1912c-570">如果您使用 Azure Site Recovery，您可以執行移轉至 Azure 的測試容錯移轉，以驗證您的複寫策略，或在沒有資料遺失或停機的情況下執行災害復原演練。</span><span class="sxs-lookup"><span data-stu-id="1912c-570">If you are using Azure Site Recovery, you can execute a test failover to Azure, to validate your replication strategy or perform a disaster recovery drill without any data loss or downtime.</span></span> <span data-ttu-id="1912c-571">測試容錯移轉不會影響正在進行的 VM 複寫或您的生產環境。</span><span class="sxs-lookup"><span data-stu-id="1912c-571">A test failover does not affect on the ongoing VM replication or your production environment.</span></span>

<span data-ttu-id="1912c-572">其他幾項技術可以測試災害復原計劃。</span><span class="sxs-lookup"><span data-stu-id="1912c-572">Several other techniques can test disaster recovery plans.</span></span> <span data-ttu-id="1912c-573">不過，其中大部分都只是這些基本技巧的變更版本。</span><span class="sxs-lookup"><span data-stu-id="1912c-573">However, most of them are simply variations of these basic techniques.</span></span> <span data-ttu-id="1912c-574">這項側是的目的是要評估復原計劃的可行性。</span><span class="sxs-lookup"><span data-stu-id="1912c-574">The intent of this testing is to evaluate the feasibility of the recovery plan.</span></span> <span data-ttu-id="1912c-575">災害復原測試著重於詳細資訊，以在基本復原計劃中找出漏洞。</span><span class="sxs-lookup"><span data-stu-id="1912c-575">Disaster recovery testing focuses on the details to discover gaps in the basic recovery plan.</span></span>

## <a name="service-specific-guidance"></a><span data-ttu-id="1912c-576">服務特有的指引</span><span class="sxs-lookup"><span data-stu-id="1912c-576">Service-specific guidance</span></span>

<span data-ttu-id="1912c-577">下列主題會說明災害復原特有的 Azure 服務：</span><span class="sxs-lookup"><span data-stu-id="1912c-577">The following topics describe disaster recovery specific Azure services:</span></span>

| <span data-ttu-id="1912c-578">服務</span><span class="sxs-lookup"><span data-stu-id="1912c-578">Service</span></span> | <span data-ttu-id="1912c-579">話題</span><span class="sxs-lookup"><span data-stu-id="1912c-579">Topic</span></span> |
|---------|-------|
| <span data-ttu-id="1912c-580">適用於 MySQL 的 Azure 資料庫</span><span class="sxs-lookup"><span data-stu-id="1912c-580">Azure Database for MySQL</span></span> | [<span data-ttu-id="1912c-581">使用「適用於 MySQL 的 Azure 資料庫」的商務持續性概觀</span><span class="sxs-lookup"><span data-stu-id="1912c-581">Overview of business continuity with Azure Database for MySQL</span></span>](/azure/mysql/concepts-business-continuity) |
| <span data-ttu-id="1912c-582">適用於 PostgreSQL 的 Azure 資料庫</span><span class="sxs-lookup"><span data-stu-id="1912c-582">Azure Database for PostgreSQL</span></span> | [<span data-ttu-id="1912c-583">使用「適用於 PostgreSQL 的 Azure 資料庫」的商務持續性概觀</span><span class="sxs-lookup"><span data-stu-id="1912c-583">Overview of business continuity with Azure Database for PostgreSQL</span></span>](/azure/postgresql/concepts-business-continuity)
| <span data-ttu-id="1912c-584">雲端服務</span><span class="sxs-lookup"><span data-stu-id="1912c-584">Cloud Services</span></span> | [<span data-ttu-id="1912c-585">發生影響 Azure 雲端服務的 Azure 服務中斷事件時該怎麼辦</span><span class="sxs-lookup"><span data-stu-id="1912c-585">What to do in the event of an Azure service disruption that impacts Azure Cloud Services</span></span>](/azure/cloud-services/cloud-services-disaster-recovery-guidance) |
| <span data-ttu-id="1912c-586">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="1912c-586">Cosmos DB</span></span> | [<span data-ttu-id="1912c-587">Azure Cosmos DB 中商務持續性的自動區域性容錯移轉</span><span class="sxs-lookup"><span data-stu-id="1912c-587">Automatic regional failover for business continuity in Azure Cosmos DB</span></span>](/azure/cosmos-db/regional-failover)
| <span data-ttu-id="1912c-588">Key Vault</span><span class="sxs-lookup"><span data-stu-id="1912c-588">Key Vault</span></span> | [<span data-ttu-id="1912c-589">Azure Key Vault 的可用性與備援</span><span class="sxs-lookup"><span data-stu-id="1912c-589">Azure Key Vault availability and redundancy</span></span>](/azure/key-vault/key-vault-disaster-recovery-guidance) |
|<span data-ttu-id="1912c-590">儲存體</span><span class="sxs-lookup"><span data-stu-id="1912c-590">Storage</span></span> | [<span data-ttu-id="1912c-591">如果 Azure 儲存體發生中斷怎麼辦</span><span class="sxs-lookup"><span data-stu-id="1912c-591">What to do if an Azure Storage outage occurs</span></span>](/azure/storage/storage-disaster-recovery-guidance) |
| <span data-ttu-id="1912c-592">SQL Database</span><span class="sxs-lookup"><span data-stu-id="1912c-592">SQL Database</span></span> | [<span data-ttu-id="1912c-593">還原 Azure SQL Database 或容錯移轉到次要資料庫</span><span class="sxs-lookup"><span data-stu-id="1912c-593">Restore an Azure SQL Database or failover to a secondary</span></span>](/azure/sql-database/sql-database-disaster-recovery) |
| <span data-ttu-id="1912c-594">虛擬機器</span><span class="sxs-lookup"><span data-stu-id="1912c-594">Virtual machines</span></span> | [<span data-ttu-id="1912c-595">發生影響 Azure 虛擬機器的 Azure 服務中斷事件時該怎麼辦</span><span class="sxs-lookup"><span data-stu-id="1912c-595">What to do in the event that an Azure service disruption impacts Azure virtual machines</span></span>](/azure/virtual-machines/virtual-machines-disaster-recovery-guidance) |
| <span data-ttu-id="1912c-596">虛擬網路</span><span class="sxs-lookup"><span data-stu-id="1912c-596">Virtual networks</span></span> | [<span data-ttu-id="1912c-597">虛擬網路 – 商務持續性</span><span class="sxs-lookup"><span data-stu-id="1912c-597">Virtual Network – Business Continuity</span></span>](/azure/virtual-network/virtual-network-disaster-recovery-guidance) |

