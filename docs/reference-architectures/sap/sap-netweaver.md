---
title: 在 Azure 虛擬機器上部署適用於 AnyDB 的 SAP NetWeaver (Windows)
description: 在 Linux 環境中具有高可用性的 Azure 上執行 SAP S/4HANA 的經過證實做法。
author: lbrader
ms.date: 05/11/2018
ms.openlocfilehash: f4a33e7a3f30bdd6d8bdd41599a5e3b47501b874
ms.sourcegitcommit: c4106b58ad08f490e170e461009a4693578294ea
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/10/2018
ms.locfileid: "43016034"
---
# <a name="deploy-sap-netweaver-windows-for-anydb-on-azure-virtual-machines"></a><span data-ttu-id="89611-103">在 Azure 虛擬機器上部署適用於 AnyDB 的 SAP NetWeaver (Windows)</span><span class="sxs-lookup"><span data-stu-id="89611-103">Deploy SAP NetWeaver (Windows) for AnyDB on Azure Virtual Machines</span></span>

<span data-ttu-id="89611-104">此參考架構會顯示一組經過證實的做法，能在 Windows 環境中具有高可用性的 Azure 上執行 SAP NetWeaver。</span><span class="sxs-lookup"><span data-stu-id="89611-104">This reference architecture shows a set of proven practices for running SAP NetWeaver in a Windows environment on Azure with high availability.</span></span> <span data-ttu-id="89611-105">資料庫是 AnyDB，這是任何支援 DBMS 的 SAP 字詞，不包括 SAP HANA。</span><span class="sxs-lookup"><span data-stu-id="89611-105">The database is AnyDB, the SAP term for any supported DBMS besides SAP HANA.</span></span> <span data-ttu-id="89611-106">這個架構是以特定虛擬機器 (VM) 大小進行部署，大小可以變更以符合您的組織需求。</span><span class="sxs-lookup"><span data-stu-id="89611-106">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![](./images/sap-netweaver.png)

<span data-ttu-id="89611-107">下載這個架構的 [Visio 檔案][visio-download]。</span><span class="sxs-lookup"><span data-stu-id="89611-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE] 
> <span data-ttu-id="89611-108">部署此參考架構需要 SAP 產品的適當授權和其他非 Microsoft 技術。</span><span class="sxs-lookup"><span data-stu-id="89611-108">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="89611-109">架構</span><span class="sxs-lookup"><span data-stu-id="89611-109">Architecture</span></span>
<span data-ttu-id="89611-110">此架構由下列基礎結構和關鍵軟體元件組成。</span><span class="sxs-lookup"><span data-stu-id="89611-110">The architecture consists of the following infrastructure and key software components.</span></span>

<span data-ttu-id="89611-111">**虛擬網路**。</span><span class="sxs-lookup"><span data-stu-id="89611-111">**Virtual network**.</span></span> <span data-ttu-id="89611-112">Azure 虛擬網路服務會安全地讓 Azure 資源彼此連線。</span><span class="sxs-lookup"><span data-stu-id="89611-112">The Azure Virtual Network service securely connects Azure resources to each other.</span></span> <span data-ttu-id="89611-113">在此架構中，虛擬網路是透過在[中樞輪輻](../hybrid-networking/hub-spoke.md)中樞中所部署的 VPN 閘道，連線至內部部署環境。</span><span class="sxs-lookup"><span data-stu-id="89611-113">In this architecture, the virtual network connects to an on-premises environment through a VPN gateway deployed in the hub of a [hub-spoke](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="89611-114">輪輻是虛擬網路，用於 SAP 應用程式和資料庫層。</span><span class="sxs-lookup"><span data-stu-id="89611-114">The spoke is the virtual network used for the SAP applications and database tier.</span></span>

<span data-ttu-id="89611-115">**子網路**。</span><span class="sxs-lookup"><span data-stu-id="89611-115">**Subnets**.</span></span> <span data-ttu-id="89611-116">虛擬網路會針對以下各個層級細分為不同的子網路：應用程式 (SAP NetWeaver)、資料庫、共用服務 (jumpbox) 和 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="89611-116">The virtual network is subdivided into separate subnets for each tier: application (SAP NetWeaver), database, shared services (the jumpbox), and Active Directory.</span></span>
    
<span data-ttu-id="89611-117">**虛擬機器**。</span><span class="sxs-lookup"><span data-stu-id="89611-117">**Virtual machines**.</span></span> <span data-ttu-id="89611-118">此架構會針對應用程式層和資料庫層使用虛擬機器，群組如下：</span><span class="sxs-lookup"><span data-stu-id="89611-118">This architecture uses virtual machines for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="89611-119">**SAP NetWeaver**。</span><span class="sxs-lookup"><span data-stu-id="89611-119">**SAP NetWeaver**.</span></span> <span data-ttu-id="89611-120">應用程式層會使用 Windows 虛擬機器，並執行 SAP 中央服務和 SAP 應用程式伺服器。</span><span class="sxs-lookup"><span data-stu-id="89611-120">The application tier uses Windows virtual machines and runs SAP Central Services and SAP application servers.</span></span> <span data-ttu-id="89611-121">執行中央服務的虛擬機器會設定為 Windows Server 容錯移轉叢集以取得高可用性，受 SIOS DataKeeper 叢集版本所支援。</span><span class="sxs-lookup"><span data-stu-id="89611-121">The VMs that run Central Services are configured as a Windows Server Failover Cluster for high availability, supported by SIOS DataKeeper Cluster Edition.</span></span>
- <span data-ttu-id="89611-122">**AnyDB**。</span><span class="sxs-lookup"><span data-stu-id="89611-122">**AnyDB**.</span></span> <span data-ttu-id="89611-123">資料庫層會執行 AnyDB 作為來源資料庫，例如 Microsoft SQL Server、Oracle 或 IBM DB2。</span><span class="sxs-lookup"><span data-stu-id="89611-123">The database tier runs AnyDB as the source database, such as Microsoft SQL Server, Oracle, or IBM DB2.</span></span>
- <span data-ttu-id="89611-124">**Jumpbox**。</span><span class="sxs-lookup"><span data-stu-id="89611-124">**Jumpbox**.</span></span> <span data-ttu-id="89611-125">也稱為防禦主機。</span><span class="sxs-lookup"><span data-stu-id="89611-125">Also called a bastion host.</span></span> <span data-ttu-id="89611-126">這是網路上系統管理員用來連線到其他虛擬機器的安全虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="89611-126">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span>
- <span data-ttu-id="89611-127">**Windows Server Active Directory 網域控制站**。</span><span class="sxs-lookup"><span data-stu-id="89611-127">**Windows Server Active Directory domain controllers**.</span></span> <span data-ttu-id="89611-128">會針對所有虛擬機器和網域中的使用者使用網域控制站。</span><span class="sxs-lookup"><span data-stu-id="89611-128">The domain controllers are used on all VMs and users in the domain.</span></span>

<span data-ttu-id="89611-129">**負載平衡器**。</span><span class="sxs-lookup"><span data-stu-id="89611-129">**Load balancers**.</span></span> <span data-ttu-id="89611-130">會使用 [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) 執行個體，將流量分配到應用程式層子網路中的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="89611-130">[Azure Load Balancer](/azure/load-balancer/load-balancer-overview) instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span> <span data-ttu-id="89611-131">您可以在資料層中使用內建的 SAP 負載平衡器、Azure Load Balancer 或其他機制，根據 DBMS 來達到高可用性。</span><span class="sxs-lookup"><span data-stu-id="89611-131">At the data tier, high availability may be achieved using built-in SAP load balancers, Azure Load Balancer, or other mechanisms, depending on the DBMS.</span></span> <span data-ttu-id="89611-132">如需詳細資訊，請參閱[適用於 SAP NetWeaver 的 Azure 虛擬機器 DBMS 部署](/azure/virtual-machines/workloads/sap/dbms-guide)。</span><span class="sxs-lookup"><span data-stu-id="89611-132">For more information, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span> 

<span data-ttu-id="89611-133">**可用性設定組**。</span><span class="sxs-lookup"><span data-stu-id="89611-133">**Availability sets**.</span></span> <span data-ttu-id="89611-134">SAP Web Dispatcher、SAP 應用程式伺服器和 (A)SCS 的虛擬機器角色會分組到個別[可用性設定組](/azure/virtual-machines/windows/tutorial-availability-sets)，每個角色都會佈建至少兩部虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="89611-134">Virtual machines for the SAP Web Dispatcher, SAP application server, and (A)SCS, roles are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="89611-135">這讓虛擬機器能夠符合適用於較高[服務等級協定](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA) 的資格。</span><span class="sxs-lookup"><span data-stu-id="89611-135">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="89611-136">**NIC**。</span><span class="sxs-lookup"><span data-stu-id="89611-136">**NICs**.</span></span> <span data-ttu-id="89611-137">[網路介面卡](/azure/virtual-network/virtual-network-network-interface) (NIC) 會啟用虛擬網路上虛擬機器的所有通訊。</span><span class="sxs-lookup"><span data-stu-id="89611-137">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="89611-138">**網路安全性群組**。</span><span class="sxs-lookup"><span data-stu-id="89611-138">**Network security groups**.</span></span> <span data-ttu-id="89611-139">若要限制虛擬網路中的傳入、傳出及內部子網路流量，您可以建立[網路安全性群組](/azure/virtual-network/virtual-networks-nsg) (NSG)。</span><span class="sxs-lookup"><span data-stu-id="89611-139">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, you can create [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs).</span></span>

<span data-ttu-id="89611-140">**閘道**。</span><span class="sxs-lookup"><span data-stu-id="89611-140">**Gateway**.</span></span> <span data-ttu-id="89611-141">閘道會將您的內部部署網路擴充至 Azure 虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="89611-141">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="89611-142">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) 是建議的 Azure 服務，用來建立不會經過公用網際網路的私人連線，但是也可以使用[站對站](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)連線。</span><span class="sxs-lookup"><span data-stu-id="89611-142">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="89611-143">**Azure 儲存體**。</span><span class="sxs-lookup"><span data-stu-id="89611-143">**Azure Storage**.</span></span> <span data-ttu-id="89611-144">若要提供虛擬機器虛擬硬碟 (VHD) 的持續性儲存體，則需要 [Azure 儲存體](/azure/storage/storage-standard-storage)。</span><span class="sxs-lookup"><span data-stu-id="89611-144">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/storage-standard-storage) is required.</span></span> <span data-ttu-id="89611-145">[雲端見證](/windows-server/failover-clustering/deploy-cloud-witness)也會使用它來實作容錯移轉叢集作業。</span><span class="sxs-lookup"><span data-stu-id="89611-145">It is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to implement a failover cluster operation.</span></span> 

## <a name="recommendations"></a><span data-ttu-id="89611-146">建議</span><span class="sxs-lookup"><span data-stu-id="89611-146">Recommendations</span></span>
<span data-ttu-id="89611-147">您的需求可能和此處所述的架構不同。</span><span class="sxs-lookup"><span data-stu-id="89611-147">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="89611-148">請使用以下建議作為起點。</span><span class="sxs-lookup"><span data-stu-id="89611-148">Use these recommendations as a starting point.</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="89611-149">SAP Web Dispatcher 集區</span><span class="sxs-lookup"><span data-stu-id="89611-149">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="89611-150">Web Dispatcher 元件是用來作為 SAP 應用程式伺服器之間 SAP 流量的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="89611-150">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="89611-151">為了達到 Web Dispatcher 元件的高可用性，會使用 Azure Load Balancer 來實作平行 Web Dispatcher 設定。</span><span class="sxs-lookup"><span data-stu-id="89611-151">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup.</span></span> <span data-ttu-id="89611-152">Web Dispatcher 會針對平衡器集區中可用 Web Dispatcher 之間的 HTTP(S) 流量分配，使用循環配置資源組態。</span><span class="sxs-lookup"><span data-stu-id="89611-152">Web Dispatcher uses in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers pool.</span></span>

<span data-ttu-id="89611-153">如需在 Azure 虛擬機器中執行 SAP NetWeaver 的詳細資訊，請參閱 [SAP NetWeaver 的 Azure 虛擬機器規劃和實作](/azure/virtual-machines/workloads/sap/planning-guide)。</span><span class="sxs-lookup"><span data-stu-id="89611-153">For details about running SAP NetWeaver in Azure VMs, see [Azure Virtual Machines planning and implementation for SAP NetWeaver](/azure/virtual-machines/workloads/sap/planning-guide).</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="89611-154">應用程式伺服器集區</span><span class="sxs-lookup"><span data-stu-id="89611-154">Application servers pool</span></span>

<span data-ttu-id="89611-155">若要管理 ABAP 應用程式伺服器的登入群組，請使用 SMLG 交易。</span><span class="sxs-lookup"><span data-stu-id="89611-155">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="89611-156">它會在中央服務的訊息伺服器內使用負載平衡函式，以針對 SAPGUI 和 RFC 流量，分配 SAP 應用程式伺服器集區之間的工作負載。</span><span class="sxs-lookup"><span data-stu-id="89611-156">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="89611-157">與高可用性中央服務的應用程式伺服器連線是透過叢集虛擬網路名稱。</span><span class="sxs-lookup"><span data-stu-id="89611-157">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="89611-158">SAP 中央服務叢集</span><span class="sxs-lookup"><span data-stu-id="89611-158">SAP Central Services cluster</span></span>

<span data-ttu-id="89611-159">此參考架構會在應用程式層中的虛擬機器上執行中央服務。</span><span class="sxs-lookup"><span data-stu-id="89611-159">This reference architecture runs Central Services on VMs in the application tier.</span></span> <span data-ttu-id="89611-160">部署到單一虛擬機器 (不需要高可用性時的典型部署) 時，中央服務是潛在的單一失敗點 (SPOF)。</span><span class="sxs-lookup"><span data-stu-id="89611-160">The Central Services is a potential single point of failure (SPOF) when deployed to a single VM—typical deployment when high availability is not a requirement.</span></span> <span data-ttu-id="89611-161">若要實作高可用性解決方案，可以使用共用磁碟叢集或檔案共用叢集。</span><span class="sxs-lookup"><span data-stu-id="89611-161">To implement a high availability solution, either a shared disk cluster or a file share cluster can be used.</span></span>

<span data-ttu-id="89611-162">若要設定共用磁碟叢集的虛擬機器，請使用 [Windows Server 容錯移轉叢集](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/)。</span><span class="sxs-lookup"><span data-stu-id="89611-162">To configure VMs for a shared disk cluster, use [Windows Server Failover Cluster](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span></span> <span data-ttu-id="89611-163">建議將[雲端見證](/windows-server/failover-clustering/deploy-cloud-witness)作為仲裁見證。</span><span class="sxs-lookup"><span data-stu-id="89611-163">[Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) is recommended as a quorum witness.</span></span> <span data-ttu-id="89611-164">若要支援容錯移轉叢集環境，[SIOS DataKeeper 叢集版本](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8)會執行叢集共用磁碟區函式，方法為複寫叢集節點所擁有的獨立磁碟。</span><span class="sxs-lookup"><span data-stu-id="89611-164">To support the failover cluster environment, [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) performs the cluster shared volume function by replicating independent disks owned by the cluster nodes.</span></span> <span data-ttu-id="89611-165">Azure 本身不支援共用磁碟，因此需要 SIOS 所提供的解決方案。</span><span class="sxs-lookup"><span data-stu-id="89611-165">Azure does not natively support shared disks and therefore requires solutions provided by SIOS.</span></span>

<span data-ttu-id="89611-166">如需詳細資訊，請參閱「3.</span><span class="sxs-lookup"><span data-stu-id="89611-166">For details, see "3.</span></span> <span data-ttu-id="89611-167">在 Azure 上的 SIOS 執行 ASCS 的 SAP 客戶重要更新」，位於[在 Microsoft 平台上執行 SAP 應用程式](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)。</span><span class="sxs-lookup"><span data-stu-id="89611-167">Important Update for SAP Customers Running ASCS on SIOS on Azure” at [Running SAP applications on the Microsoft platform](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/).</span></span>

<span data-ttu-id="89611-168">處理叢集的另一種方式是使用 Windows Server 容錯移轉叢集實作檔案共用叢集。</span><span class="sxs-lookup"><span data-stu-id="89611-168">Another way to handle clustering is to implement a file share cluster using Windows Server Failover Cluster.</span></span> <span data-ttu-id="89611-169">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) 最近修改了中央服務部署模式，來透過 UNC 路徑存取 /sapmnt 全域目錄。</span><span class="sxs-lookup"><span data-stu-id="89611-169">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) recently modified the Central Services deployment pattern to access the /sapmnt global directories via a UNC path.</span></span> <span data-ttu-id="89611-170">這項變更會針對 SIOS，或中央服務虛擬機器上的其他共用磁碟解決方案[移除需求](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/)。</span><span class="sxs-lookup"><span data-stu-id="89611-170">This change [removes the requirement](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) for SIOS or other shared disk solutions on the Central Services VMs.</span></span> <span data-ttu-id="89611-171">但是仍然建議確保 /sapmnt UNC 共用是[高可用性](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/)。</span><span class="sxs-lookup"><span data-stu-id="89611-171">It is still recommended to ensure that the /sapmnt UNC share is [highly available](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span></span> <span data-ttu-id="89611-172">可以藉由使用 Windows Server 容錯移轉叢集與[相應放大檔案伺服器](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) 和 Windows Server 2016 中的[儲存空間直接存取](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) 功能，在中央服務執行個體上完成這個操作。</span><span class="sxs-lookup"><span data-stu-id="89611-172">This can be done on the Central Services instance by using Windows Server Failover Cluster with [Scale Out File Server](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) and the [Storage Spaces Direct](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) feature in Windows Server 2016.</span></span> 

### <a name="availability-sets"></a><span data-ttu-id="89611-173">可用性設定組</span><span class="sxs-lookup"><span data-stu-id="89611-173">Availability sets</span></span>

<span data-ttu-id="89611-174">可用性設定組會將伺服器分配到不同實體基礎結構並且更新群組，以改善服務可用性。</span><span class="sxs-lookup"><span data-stu-id="89611-174">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="89611-175">將執行相同角色的虛擬機器放到可用性設定組，以協助防範 Azure 基礎結構維護所造成的停機時間，並符合 [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA)。</span><span class="sxs-lookup"><span data-stu-id="89611-175">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLAs).</span></span> <span data-ttu-id="89611-176">建議您針對每個可用性設定組使用兩部以上的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="89611-176">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="89611-177">集合中的所有虛擬機器必須執行相同的角色。</span><span class="sxs-lookup"><span data-stu-id="89611-177">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="89611-178">請勿在相同的可用性設定組中混用不同角色的伺服器。</span><span class="sxs-lookup"><span data-stu-id="89611-178">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="89611-179">例如，不要將中央服務節點放置在與應用程式伺服器相同的可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="89611-179">For example, don't place a Central Services node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="89611-180">NIC</span><span class="sxs-lookup"><span data-stu-id="89611-180">NICs</span></span>

<span data-ttu-id="89611-181">傳統內部部署 SAP 部署會為每部機器實作多個網路介面卡 (NIC)，以隔離系統管理流量與商務流量。</span><span class="sxs-lookup"><span data-stu-id="89611-181">Traditional on-premises SAP deployments implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="89611-182">在 Azure 上，虛擬網路是軟體定義網路，它會透過相同的網路網狀架構傳送所有流量。</span><span class="sxs-lookup"><span data-stu-id="89611-182">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="89611-183">因此，不需要使用多個 NIC。</span><span class="sxs-lookup"><span data-stu-id="89611-183">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="89611-184">不過，如果您的組織需要隔離流量，您可以對每部虛擬機器部署多個 NIC、將每個 NIC 連線到不同的子網路，然後使用 NSG 以強制執行不同的存取控制原則。</span><span class="sxs-lookup"><span data-stu-id="89611-184">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="89611-185">子網路和 NSG</span><span class="sxs-lookup"><span data-stu-id="89611-185">Subnets and NSGs</span></span>

<span data-ttu-id="89611-186">此架構會將虛擬網路位址空間細分為子網路。</span><span class="sxs-lookup"><span data-stu-id="89611-186">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="89611-187">此參考架構主要著重在應用程式層子網路。</span><span class="sxs-lookup"><span data-stu-id="89611-187">This reference architecture focuses primarily on the application tier subnet.</span></span> <span data-ttu-id="89611-188">每個子網路可以與定義子網路存取原則的 NSG 相關聯。</span><span class="sxs-lookup"><span data-stu-id="89611-188">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="89611-189">將應用程式伺服器放在不同的子網路上，您就可以藉由管理子網路安全性原則 (而非個別伺服器)，以便更輕鬆地保護它們。</span><span class="sxs-lookup"><span data-stu-id="89611-189">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="89611-190">當 NSG 與子網路產生關聯時，它會套用至子網路內的所有伺服器。</span><span class="sxs-lookup"><span data-stu-id="89611-190">When a NSG is associated with a subnet, it applies to all the servers within the subnet.</span></span> <span data-ttu-id="89611-191">如需使用 NSG 對子網路中伺服器進行更細微控制的詳細資訊，請參閱[使用網路安全性群組篩選網路流量](https://azure.microsoft.com/en-us/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/)。</span><span class="sxs-lookup"><span data-stu-id="89611-191">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/en-us/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="89611-192">負載平衡器</span><span class="sxs-lookup"><span data-stu-id="89611-192">Load balancers</span></span>

<span data-ttu-id="89611-193">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) 會處理對 SAP 應用程式伺服器集區之 HTTP(S) 流量的負載平衡。</span><span class="sxs-lookup"><span data-stu-id="89611-193">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic to a pool of SAP application servers.</span></span>

<span data-ttu-id="89611-194">針對透過 DIAG 通訊協定或遠端函式呼叫 (RFC)，從 SAP GUI 用戶端連線 SAP 伺服器的流量，中央服務訊息伺服器會透過 SAP 應用程式伺服器[登入群組](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing)進行負載平衡，因此不需要額外負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="89611-194">For traffic from SAP GUI clients connecting a SAP server via DIAG protocol or Remote Function Calls (RFC), the Central Services message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="89611-195">Azure 儲存體</span><span class="sxs-lookup"><span data-stu-id="89611-195">Azure Storage</span></span>

<span data-ttu-id="89611-196">針對所有資料庫伺服器虛擬機器，建議您使用 Azure 進階儲存體以獲得一致的讀取/寫入延遲。</span><span class="sxs-lookup"><span data-stu-id="89611-196">For all database server virtual machines, we recommend using Azure Premium Storage for consistent read/write latency.</span></span> <span data-ttu-id="89611-197">對於將進階儲存體用於所有作業系統磁碟和資料磁碟的任何單一執行個體虛擬機器，請參閱[虛擬機器的 SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines)。</span><span class="sxs-lookup"><span data-stu-id="89611-197">For any single instance virtual machine using Premium Storage for all operating system disks and data disks, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="89611-198">此外，針對生產環境 SAP 系統，我們建議在所有情況下都使用進階 [Azure 受控磁碟](/azure/storage/storage-managed-disks-overview)。</span><span class="sxs-lookup"><span data-stu-id="89611-198">Also, for production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) in all cases.</span></span> <span data-ttu-id="89611-199">基於可靠性的考量，會使用受控磁碟來管理磁碟的 VHD 檔案。</span><span class="sxs-lookup"><span data-stu-id="89611-199">For reliability, Managed Disks are used to manage the VHD files for the disks.</span></span> <span data-ttu-id="89611-200">受控磁碟可確保可用性設定組內的虛擬機器磁碟是各自獨立的，以避免發生單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="89611-200">Managed disks ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="89611-201">針對 SAP 應用程式伺服器 (包括中央服務虛擬機器)，您可以使用 Azure 標準儲存體來降低成本，因為應用程式的執行會發生在記憶體中，並只會使用磁碟來記錄。</span><span class="sxs-lookup"><span data-stu-id="89611-201">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and disks are used for logging only.</span></span> <span data-ttu-id="89611-202">不過，目前標準儲存體只針對非受控儲存體經過認證。</span><span class="sxs-lookup"><span data-stu-id="89611-202">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="89611-203">因為應用程式伺服器未裝載任何資料，您也可以使用較小的 P4 和 P6 進階儲存體磁碟以協助降低成本。</span><span class="sxs-lookup"><span data-stu-id="89611-203">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="89611-204">[雲端見證](/windows-server/failover-clustering/deploy-cloud-witness)也會使用 Azure 儲存體，以針對遠離叢集所在主要區域的遠端 Azure 區域中的裝置維護仲裁。</span><span class="sxs-lookup"><span data-stu-id="89611-204">Azure Storage is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to maintain quorum with a device in a remote Azure region away from the primary region where the cluster resides.</span></span>

<span data-ttu-id="89611-205">針對備份資料存放區，我們建議您使用 Azure [coolaccess 層](/azure/storage/storage-blob-storage-tiers)和[封存存取層儲存體](/azure/storage/storage-blob-storage-tiers)。</span><span class="sxs-lookup"><span data-stu-id="89611-205">For the backup data store, we recommend using Azure [coolaccess tier](/azure/storage/storage-blob-storage-tiers) and [archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="89611-206">這些儲存體層是符合成本效益的方式，用來儲存不常存取的長時間執行資料。</span><span class="sxs-lookup"><span data-stu-id="89611-206">These storage tiers are cost-effective ways to store long-lived data that is infrequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="89611-207">效能考量</span><span class="sxs-lookup"><span data-stu-id="89611-207">Performance considerations</span></span>

<span data-ttu-id="89611-208">SAP 應用程式伺服器會執行與資料庫伺服器的持續通訊。</span><span class="sxs-lookup"><span data-stu-id="89611-208">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="89611-209">針對在任何資料庫平台上執行的效能關鍵性應用程式 (包括 SAP HANA)，請考慮啟用[寫入加速器](/azure/virtual-machines/linux/how-to-enable-write-accelerator)以改善記錄寫入延遲。</span><span class="sxs-lookup"><span data-stu-id="89611-209">For performance-critical applications running on any database platforms, including SAP HANA, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="89611-210">若要最佳化伺服器間的通訊，請使用[加速網路](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/)。</span><span class="sxs-lookup"><span data-stu-id="89611-210">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="89611-211">請注意，這些加速器僅適用於特定虛擬機器系列。</span><span class="sxs-lookup"><span data-stu-id="89611-211">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="89611-212">若要達到高 IOPS 和磁碟頻寬輸送量，可將儲存體磁碟區[效能最佳化](/azure/virtual-machines/windows/premium-storage-performance)的常見做法套用於 Azure 儲存體配置。</span><span class="sxs-lookup"><span data-stu-id="89611-212">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/windows/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="89611-213">例如，將多個磁碟合併在一起來建立等量磁碟區，能夠改善 IO 效能。</span><span class="sxs-lookup"><span data-stu-id="89611-213">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="89611-214">在不常變更的儲存體內容上啟用讀取快取，能夠增強資料擷取的速度。</span><span class="sxs-lookup"><span data-stu-id="89611-214">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span>

<span data-ttu-id="89611-215">針對 SQL 上的 SAP，[在 Azure 上部署 SAP 應用程式的前 10 名主要考量](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/)部落格提供針對 SQL Server 上 SAP 工作負載最佳化 Azure 儲存體的絕佳建議。</span><span class="sxs-lookup"><span data-stu-id="89611-215">For SAP on SQL, the [Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) blog offers excellent advice on optimizing Azure storage for SAP workloads on SQL Server.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="89611-216">延展性考量</span><span class="sxs-lookup"><span data-stu-id="89611-216">Scalability considerations</span></span>

<span data-ttu-id="89611-217">在 SAP 應用程式層中，Azure 會提供各種不同的虛擬機器大小可進行相應增加或相應放大。如需完整清單，請參閱 [SAP 附註 1928533](https://launchpad.support.sap.com/#/notes/1928533) - Azure 上的 SAP 應用程式︰支援的產品和 Azure 虛擬機器類型。</span><span class="sxs-lookup"><span data-stu-id="89611-217">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM Types.</span></span> <span data-ttu-id="89611-218">(需要 SAP Service Marketplace 帳戶才能進行存取)。</span><span class="sxs-lookup"><span data-stu-id="89611-218">(SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="89611-219">SAP 應用程式伺服器和中央服務叢集可以藉由新增更多執行個體來相應增加/相應減少或相應放大。</span><span class="sxs-lookup"><span data-stu-id="89611-219">SAP application servers and the Central Services clusters can scale up/down or scale out by adding more instances.</span></span> <span data-ttu-id="89611-220">AnyDB 資料庫可以相應增加/相應減少，但是無法相應放大。AnyDB 的 SAP 資料庫容器不支援分區化。</span><span class="sxs-lookup"><span data-stu-id="89611-220">The AnyDB database can scale up/down but does not scale out. The SAP database container for AnyDB does not support sharding.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="89611-221">可用性考量</span><span class="sxs-lookup"><span data-stu-id="89611-221">Availability considerations</span></span>

<span data-ttu-id="89611-222">資源備援是高可用性基礎結構解決方案中的一般主題。</span><span class="sxs-lookup"><span data-stu-id="89611-222">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="89611-223">針對具有寬鬆 SLA 的企業，單一執行個體 Azure 虛擬機器會提供執行時間 SLA。</span><span class="sxs-lookup"><span data-stu-id="89611-223">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="89611-224">如需詳細資訊，請參閱 [Azure 服務等級協定](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="89611-224">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="89611-225">在 SAP 應用程式的這個分散式安裝中，會複寫基底安裝來達到高可用性。</span><span class="sxs-lookup"><span data-stu-id="89611-225">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="89611-226">針對每一層的架構，高可用性設計會有所不同。</span><span class="sxs-lookup"><span data-stu-id="89611-226">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="89611-227">應用程式層</span><span class="sxs-lookup"><span data-stu-id="89611-227">Application tier</span></span>

<span data-ttu-id="89611-228">SAP Web Dispatcher 的高可用性是以備援執行個體來達成。</span><span class="sxs-lookup"><span data-stu-id="89611-228">High availability for SAP Web Dispatcher is achieved with redundant instances.</span></span> <span data-ttu-id="89611-229">請參閱 SAP 文件中的 [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm)。</span><span class="sxs-lookup"><span data-stu-id="89611-229">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP Documentation.</span></span>

<span data-ttu-id="89611-230">中央服務的高可用性是使用 Windows Server 容錯移轉叢集來實作。</span><span class="sxs-lookup"><span data-stu-id="89611-230">High availability of the Central Services is implemented with Windows Server Failover Cluster.</span></span> <span data-ttu-id="89611-231">部署在 Azure 上的時候，可以使用兩種方法來設定容錯移轉叢集的叢集儲存體：叢集共用磁碟區或檔案共用。</span><span class="sxs-lookup"><span data-stu-id="89611-231">When deployed on Azure, the cluster storage for the failover cluster can be configured using two approaches: either a clustered shared volume or a file share.</span></span>

<span data-ttu-id="89611-232">因為無法在 Azure 上使用共用磁碟，所以會使用 SIOS Datakeeper 來複寫連結到叢集節點的獨立磁碟內容，並且讓磁碟機作為叢集管理員的叢集共用磁碟區。</span><span class="sxs-lookup"><span data-stu-id="89611-232">Since shared disks are not possible on Azure, SIOS Datakeeper is used to replicate the content of independent disks attached to the cluster nodes and to abstract the drives as a cluster shared volume for the cluster manager.</span></span> <span data-ttu-id="89611-233">如需實作詳細資料，請參閱[在 Azure 上叢集 SAP ASCS](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/)。</span><span class="sxs-lookup"><span data-stu-id="89611-233">For implementation details, see [Clustering SAP ASCS on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span></span>

<span data-ttu-id="89611-234">另一個選項是使用由[相應放大檔案伺服器](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) 提供服務的檔案共用。</span><span class="sxs-lookup"><span data-stu-id="89611-234">Another option is to use a file share served up by the [Scale Out Fileserver](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS).</span></span> <span data-ttu-id="89611-235">SOFS 提供彈性檔案共用，您可以用來作為 Windows 叢集的叢集共用磁碟區。</span><span class="sxs-lookup"><span data-stu-id="89611-235">SOFS offers resilient file shares you can use as a cluster shared volume for the Windows cluster.</span></span> <span data-ttu-id="89611-236">SOFS 叢集可以在多個中央服務節點之間共用。</span><span class="sxs-lookup"><span data-stu-id="89611-236">A SOFS cluster can be shared among multiple Central Services nodes.</span></span> <span data-ttu-id="89611-237">在此文件撰寫當下，SOFS 只適用於高可用性設計，因為 SOFS 叢集不會跨區域擴充，以提供災害復原支援。</span><span class="sxs-lookup"><span data-stu-id="89611-237">As of this writing, SOFS is used only for high availability design, because the SOFS cluster does not extend across regions to provide disaster recovery support.</span></span>

<span data-ttu-id="89611-238">藉由應用程式伺服器集區內的負載平衡流量來達到 SAP 應用程式伺服器的高可用性。</span><span class="sxs-lookup"><span data-stu-id="89611-238">High availability for the SAP application servers is achieved by load balancing traffic within a pool of application servers.</span></span>
<span data-ttu-id="89611-239">請參閱[於 Microsoft Azure 上執行的 SAP 認證和設定](/azure/virtual-machines/workloads/sap/sap-certifications)。</span><span class="sxs-lookup"><span data-stu-id="89611-239">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="database-tier"></a><span data-ttu-id="89611-240">資料庫層</span><span class="sxs-lookup"><span data-stu-id="89611-240">Database tier</span></span>

<span data-ttu-id="89611-241">此參考架構假設來源資料庫是在 AnyDB 上執行，亦即例如 SQL Server、SAP ASE、IBM DB2 或 Oracle 的 DBMS。</span><span class="sxs-lookup"><span data-stu-id="89611-241">This reference architecture assumes the source database is running on AnyDB—that is, a DBMS such as SQL Server, SAP ASE, IBM DB2, or Oracle.</span></span> <span data-ttu-id="89611-242">資料庫層的原生複寫功能提供複寫節點之間手動或自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="89611-242">The database tier's native replication feature provides either manual or automatic failover between replicated nodes.</span></span>

<span data-ttu-id="89611-243">如需特定資料庫系統的實作詳細資訊，請參閱[針對 SAP NetWeaver 的 Azure 虛擬機器 DBMS 部署](/azure/virtual-machines/workloads/sap/dbms-guide)。</span><span class="sxs-lookup"><span data-stu-id="89611-243">For implementation details about specific database systems, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

## <a name="disaster-recovery-considerations"></a><span data-ttu-id="89611-244">災害復原考量</span><span class="sxs-lookup"><span data-stu-id="89611-244">Disaster recovery considerations</span></span>

<span data-ttu-id="89611-245">針對災害復原 (DR)，您必須能夠容錯移轉到次要區域。</span><span class="sxs-lookup"><span data-stu-id="89611-245">For disaster recovery (DR), you must be able to fail over to a secondary region.</span></span> <span data-ttu-id="89611-246">每一層會使用不同的策略來提供災害復原 (DR) 保護。</span><span class="sxs-lookup"><span data-stu-id="89611-246">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="89611-247">**應用程式伺服器層**。</span><span class="sxs-lookup"><span data-stu-id="89611-247">**Application servers tier**.</span></span> <span data-ttu-id="89611-248">SAP 應用程式伺服器不包含商務資料。</span><span class="sxs-lookup"><span data-stu-id="89611-248">SAP application servers do not contain business data.</span></span> <span data-ttu-id="89611-249">在 Azure 上，簡易 DR 策略是在次要區域建立 SAP 應用程式伺服器，然後將它們關機。</span><span class="sxs-lookup"><span data-stu-id="89611-249">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="89611-250">在主要應用程式伺服器上進行任何組態變更或核心更新時，必須將相同的變更複製到次要區域中的虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="89611-250">Upon any configuration changes or kernel updates on the primary application server, the same changes must be copied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="89611-251">例如，將核心可執行檔複製到 DR 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="89611-251">For example, the kernel executables copied to the DR virtual machines.</span></span> <span data-ttu-id="89611-252">如需將應用程式伺服器自動複寫到次要區域中，[Azure Site Recovery](/azure/site-recovery/site-recovery-overview) 是建議的解決方案。</span><span class="sxs-lookup"><span data-stu-id="89611-252">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span>

- <span data-ttu-id="89611-253">**中央服務**。</span><span class="sxs-lookup"><span data-stu-id="89611-253">**Central Services**.</span></span> <span data-ttu-id="89611-254">這個 SAP 應用程式堆疊的元件也不會保存商務資料。</span><span class="sxs-lookup"><span data-stu-id="89611-254">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="89611-255">您可以在災害復原區域中建置虛擬機器，來執行中央服務角色。</span><span class="sxs-lookup"><span data-stu-id="89611-255">You can build a VM in the disaster recovery region to run the Central Services role.</span></span> <span data-ttu-id="89611-256">主要中央服務節點中同步處理的唯一內容是 /sapmnt 共用內容。</span><span class="sxs-lookup"><span data-stu-id="89611-256">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="89611-257">另外，如果組態變更或核心更新是在主要中央服務伺服器上發生，必須在執行中央服務的災害復原區域中的虛擬機器上重複執行這些變更或更新。</span><span class="sxs-lookup"><span data-stu-id="89611-257">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the disaster recovery region running Central Services.</span></span> <span data-ttu-id="89611-258">若要同步處理兩部伺服器，您可以使用 Azure Site Recovery 複寫叢集節點，或者只使用定期排程備份作業將 /sapmnt 複製到災害復原區域。</span><span class="sxs-lookup"><span data-stu-id="89611-258">To synchronize the two servers, you can use either Azure Site Recovery to replicate the cluster nodes or simply use a regularly scheduled copy job to copy /sapmnt to the disaster recovery region.</span></span> <span data-ttu-id="89611-259">如需這個簡易複寫方法之建置、複製及測試容錯移轉程序的詳細資訊，請下載 [SAP NetWeaver：建置 Hyper-V 和以 Microsoft Azure 作為基礎的災害復原解決方案](http://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx)，並參考「4.3.</span><span class="sxs-lookup"><span data-stu-id="89611-259">For details about this simple replication method's build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](http://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to "4.3.</span></span> <span data-ttu-id="89611-260">SAP SPOF layer (ASCS)。」</span><span class="sxs-lookup"><span data-stu-id="89611-260">SAP SPOF layer (ASCS)."</span></span>

- <span data-ttu-id="89611-261">**資料庫層**。</span><span class="sxs-lookup"><span data-stu-id="89611-261">**Database tier**.</span></span> <span data-ttu-id="89611-262">DR 的最佳實作方式是使用資料庫自己的整合複寫技術。</span><span class="sxs-lookup"><span data-stu-id="89611-262">DR is best implemented with the database's own integrated replication technology.</span></span> <span data-ttu-id="89611-263">舉例來說，如果是 SQL Server，我們建議使用 AlwaysOn 可用性群組以在遠端區域中建立複本，使用手動容錯移轉以非同步方式複寫交易。</span><span class="sxs-lookup"><span data-stu-id="89611-263">In the case of SQL Server, for example, we recommend using AlwaysOn Availability Group to establish a replica in a remote region, replicating transactions asynchronously with manual failover.</span></span> <span data-ttu-id="89611-264">非同步複寫可避免對主要網站的互動式工作負載效能造成影響。</span><span class="sxs-lookup"><span data-stu-id="89611-264">Asynchronous replication avoids an impact to the performance of interactive workloads at the primary site.</span></span> <span data-ttu-id="89611-265">手動容錯移轉讓人員有機會評估 DR 影響，並判斷透過 DR 網站的運作是否適當。</span><span class="sxs-lookup"><span data-stu-id="89611-265">Manual failover offers the opportunity for a person to evaluate the DR impact and decide if operating from the DR site is justified.</span></span>

<span data-ttu-id="89611-266">若要使用 Azure Site Recovery 自動建置原始的完整複寫生產環境網站，您必須執行自訂[部署指令碼](/azure/site-recovery/site-recovery-runbook-automation)。</span><span class="sxs-lookup"><span data-stu-id="89611-266">To use Azure Site Recovery to automatically build out a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="89611-267">Site Recovery 首先會在可用性設定組中部署虛擬機器，然後執行指令碼以新增負載平衡器之類的資源。</span><span class="sxs-lookup"><span data-stu-id="89611-267">Site Recovery first deploys the VMs in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="89611-268">管理性考量</span><span class="sxs-lookup"><span data-stu-id="89611-268">Manageability considerations</span></span>

<span data-ttu-id="89611-269">Azure 會提供幾個函式來[監視和診斷](/azure/architecture/best-practices/monitoring)整體基礎結構。</span><span class="sxs-lookup"><span data-stu-id="89611-269">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="89611-270">此外，Azure 虛擬機器的增強型監視會由 Azure Operations Management Suite (OMS) 處理。</span><span class="sxs-lookup"><span data-stu-id="89611-270">Also, enhanced monitoring of Azure virtual machines is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="89611-271">若要提供以 SAP 作為基礎的 SAP 基礎結構之資源與服務效能監視，請使用 [Azure SAP 增強型監視](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment)延伸模組。</span><span class="sxs-lookup"><span data-stu-id="89611-271">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment) extension is used.</span></span> <span data-ttu-id="89611-272">此延伸模組會將 Azure 監視統計資料輸入 SAP 應用程式，以進行作業系統監視和 DBA Cockpit 函式。</span><span class="sxs-lookup"><span data-stu-id="89611-272">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="89611-273">安全性考量</span><span class="sxs-lookup"><span data-stu-id="89611-273">Security considerations</span></span>

<span data-ttu-id="89611-274">SAP 有它自己的「使用者管理引擎 (UME)」，可控制角色型存取和 SAP 應用程式內的授權。</span><span class="sxs-lookup"><span data-stu-id="89611-274">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="89611-275">如需詳細資訊，請參閱[適用於 ABAP 的 SAP NetWeaver 應用程式伺服器安全性指南](https://help.sap.com/doc/7b932ef4728810148a4b1a83b0e91070/1610 001/en-US/frameset.htm?4dde53b3e9142e51e10000000a42189c.html)和 [SAP NetWeaver 應用程式伺服器 Java 安全性指南](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm)。</span><span class="sxs-lookup"><span data-stu-id="89611-275">For details, see [SAP NetWeaver Application Server for ABAP Security Guide](https://help.sap.com/doc/7b932ef4728810148a4b1a83b0e91070/1610 001/en-US/frameset.htm?4dde53b3e9142e51e10000000a42189c.html) and [SAP NetWeaver Application Server Java Security Guide](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span></span>

<span data-ttu-id="89611-276">如需額外的網路安全性，請考慮實作[網路 DMZ](../dmz/secure-vnet-hybrid.md)，它會使用網路虛擬設備，在 Web Dispatcher 的子網路前面建立防火牆。</span><span class="sxs-lookup"><span data-stu-id="89611-276">For additional network security, consider implementing a [network DMZ](../dmz/secure-vnet-hybrid.md), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher.</span></span>

<span data-ttu-id="89611-277">針對基礎結構安全性，資料在傳輸中和靜止時會加密。</span><span class="sxs-lookup"><span data-stu-id="89611-277">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="89611-278">[Azure 虛擬機器 (VM) 上的 SAP NetWeaver - 規劃和實作指南](/azure/virtual-machines/workloads/sap/planning-guide)的「安全性考量」一節會開始說明網路安全性。</span><span class="sxs-lookup"><span data-stu-id="89611-278">The "Security considerations” section of the [SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security.</span></span> <span data-ttu-id="89611-279">本指南也會指定您在防火牆上必須開啟才能允許應用程式通訊的網路連接埠。</span><span class="sxs-lookup"><span data-stu-id="89611-279">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="89611-280">如需加密 Windows 虛擬機器磁碟，您可以使用 [Azure 磁碟加密](/azure/security/azure-security-disk-encryption)。</span><span class="sxs-lookup"><span data-stu-id="89611-280">To encrypt Windows virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="89611-281">它會使用 Windows 的 BitLocker 功能來提供作業系統和資料磁碟的磁碟區加密。</span><span class="sxs-lookup"><span data-stu-id="89611-281">It uses the BitLocker feature of Windows to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="89611-282">此解決方案也可與 Azure Key Vault 搭配使用，協助您控制及管理金鑰保存庫訂用帳戶中的磁碟加密金鑰與祕密。</span><span class="sxs-lookup"><span data-stu-id="89611-282">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="89611-283">虛擬機器磁碟上的所有待用資料都會在您的 Azure 儲存體中加密。</span><span class="sxs-lookup"><span data-stu-id="89611-283">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

## <a name="communities"></a><span data-ttu-id="89611-284">社群</span><span class="sxs-lookup"><span data-stu-id="89611-284">Communities</span></span>

<span data-ttu-id="89611-285">社群可以回答問題並協助您設定成功的部署。</span><span class="sxs-lookup"><span data-stu-id="89611-285">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="89611-286">請考慮下列：</span><span class="sxs-lookup"><span data-stu-id="89611-286">Consider the following:</span></span>

- [<span data-ttu-id="89611-287">在 Microsoft 平台上執行 SAP 應用程式部落格</span><span class="sxs-lookup"><span data-stu-id="89611-287">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="89611-288">Azure 社群支援</span><span class="sxs-lookup"><span data-stu-id="89611-288">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="89611-289">SAP 社群</span><span class="sxs-lookup"><span data-stu-id="89611-289">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="89611-290">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="89611-290">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
