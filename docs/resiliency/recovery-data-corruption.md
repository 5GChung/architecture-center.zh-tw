---
title: "從資料損毀或意外刪除復原"
description: "有關如何從意外損毀資料或刪除資料恢復資料，和設計可恢復、高可用性、容錯的應用程式，以及規劃災害復原的文章"
author: adamglick
ms.date: 08/18/2016
ms.openlocfilehash: b75c774f85c42f64472167897f08a7302ab50a3f
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="azure-resiliency-technical-guidance-recovery-from-data-corruption-or-accidental-deletion"></a><span data-ttu-id="405f8-103">Azure 復原技術指導：從資料損毀或意外刪除復原</span><span class="sxs-lookup"><span data-stu-id="405f8-103">Azure resiliency technical guidance: recovery from data corruption or accidental deletion</span></span>
<span data-ttu-id="405f8-104">健全的商務持續性計畫的一部分為對資料損毀或遭意外刪除有所計畫。</span><span class="sxs-lookup"><span data-stu-id="405f8-104">Part of a robust business continuity plan is having a plan if your data gets corrupted or accidentally deleted.</span></span> <span data-ttu-id="405f8-105">以下是因為應用程式錯誤或操作員錯誤而損毀或意外刪除資料之後，有關復原的資訊。</span><span class="sxs-lookup"><span data-stu-id="405f8-105">The following is information about recovery after data has been corrupted or accidentally deleted, due to application errors or operator error.</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="405f8-106">虛擬機器</span><span class="sxs-lookup"><span data-stu-id="405f8-106">Virtual Machines</span></span>
<span data-ttu-id="405f8-107">若要保護 Azure 虛擬機器 (有時稱為基礎結構即服務 VM) 不受應用程式錯誤或意外刪除，請使用 [Azure 備份](https://azure.microsoft.com/services/backup/)。</span><span class="sxs-lookup"><span data-stu-id="405f8-107">To protect your Azure Virtual Machines (sometimes called infrastructure-as-a-service VMs) from application errors or accidental deletion, use [Azure Backup](https://azure.microsoft.com/services/backup/).</span></span> <span data-ttu-id="405f8-108">Azure 備份可讓您跨多個 VM 磁碟建立一致的備份。</span><span class="sxs-lookup"><span data-stu-id="405f8-108">Azure Backup enables the creation of backups that are consistent across multiple VM disks.</span></span> <span data-ttu-id="405f8-109">此外，備份保存庫可以跨區域複寫，以從區域耗損提供復原。</span><span class="sxs-lookup"><span data-stu-id="405f8-109">In addition, the Backup Vault can be replicated across regions to provide recovery from region loss.</span></span>

## <a name="storage"></a><span data-ttu-id="405f8-110">儲存體</span><span class="sxs-lookup"><span data-stu-id="405f8-110">Storage</span></span>
<span data-ttu-id="405f8-111">請注意，雖然 Azure 儲存體透過自動化複本提供資料恢復，這無法防止您的應用程式程式碼 (或開發人員/使用者) 不會因為意外或非特意刪除、更新等而損毀資料。</span><span class="sxs-lookup"><span data-stu-id="405f8-111">Note that while Azure Storage provides data resiliency through automated replicas, this does not prevent your application code (or developers/users) from corrupting data through accidental or unintended deletion, update, and so on.</span></span> <span data-ttu-id="405f8-112">維護應用程式或使用者錯誤的資料精確度需要更進階的技術，例如複製資料到具有稽核記錄檔的次要儲存體位置。</span><span class="sxs-lookup"><span data-stu-id="405f8-112">Maintaining data fidelity in the face of application or user error requires more advanced techniques, such as copying the data to a secondary storage location with an audit log.</span></span> <span data-ttu-id="405f8-113">開發人員可以利用 Blob [快照集功能](https://msdn.microsoft.com/library/azure/ee691971.aspx)，這可以為 Blob 內容建立唯讀時間點快照集。</span><span class="sxs-lookup"><span data-stu-id="405f8-113">Developers can take advantage of the blob [snapshot capability](https://msdn.microsoft.com/library/azure/ee691971.aspx), which can create read-only point-in-time snapshots of blob contents.</span></span> <span data-ttu-id="405f8-114">這可用來當做 Azure 儲存體 Blob 的資料精確度解決方案的基礎。</span><span class="sxs-lookup"><span data-stu-id="405f8-114">This can be used as the basis of a data-fidelity solution for Azure Storage blobs.</span></span>

### <a name="blob-and-table-storage-backup"></a><span data-ttu-id="405f8-115">Blob 和資料表儲存體備份</span><span class="sxs-lookup"><span data-stu-id="405f8-115">Blob and Table Storage Backup</span></span>
<span data-ttu-id="405f8-116">雖然 Blob 和資料表都很持久，但是它們一律會呈現資料的目前狀態。</span><span class="sxs-lookup"><span data-stu-id="405f8-116">While blobs and tables are highly durable, they always represent the current state of the data.</span></span> <span data-ttu-id="405f8-117">從不想要的修改或刪除資料復原可能需要將資料還原到先前的狀態。</span><span class="sxs-lookup"><span data-stu-id="405f8-117">Recovery from unwanted modification or deletion of data may require restoring data to a previous state.</span></span> <span data-ttu-id="405f8-118">這可以利用 Azure 所提供用來儲存和保留時間點複本的功能來達成。</span><span class="sxs-lookup"><span data-stu-id="405f8-118">This can be achieved by taking advantage of the capabilities provided by Azure to store and retain point-in-time copies.</span></span>

<span data-ttu-id="405f8-119">針對 Azure Blob，您可以使用 [Blob 快照集功能](https://msdn.microsoft.com/library/ee691971.aspx)執行時間點備份。</span><span class="sxs-lookup"><span data-stu-id="405f8-119">For Azure Blobs, you can perform point-in-time backups using the [blob snapshot feature](https://msdn.microsoft.com/library/ee691971.aspx).</span></span> <span data-ttu-id="405f8-120">針對每個快照集，您只需支付自從上一個快照集狀態後，在 Blob 中儲存差異所需的儲存體。</span><span class="sxs-lookup"><span data-stu-id="405f8-120">For each snapshot, you are only charged for the storage required to store the differences within the blob since the last snapshot state.</span></span> <span data-ttu-id="405f8-121">快照集取決於其根據的原始 Blob，因此建議對另一個 Blob 或甚至是另一個儲存體帳戶進行複製作業。</span><span class="sxs-lookup"><span data-stu-id="405f8-121">The snapshots are dependent on the existence of the original blob they are based on, so a copy operation to another blob or even another storage account is advisable.</span></span> <span data-ttu-id="405f8-122">這可確保該備份資料可正確地受到保護，防止被意外刪除。</span><span class="sxs-lookup"><span data-stu-id="405f8-122">This ensures that backup data is properly protected against accidental deletion.</span></span> <span data-ttu-id="405f8-123">對於 Azure 資料表，您可以對不同的資料表或 Azure Blob 建立時間點複本。</span><span class="sxs-lookup"><span data-stu-id="405f8-123">For Azure Tables, you can make point-in-time copies to a different table or to Azure Blobs.</span></span> <span data-ttu-id="405f8-124">執行資料表和 Blob 應用程式層級備份的更詳細指導方針與範例可以在這裡找到：</span><span class="sxs-lookup"><span data-stu-id="405f8-124">More detailed guidance and examples of performing application-level backups of tables and blobs can be found here:</span></span>

* [<span data-ttu-id="405f8-125">保護您的資料表以免發生應用程式錯誤</span><span class="sxs-lookup"><span data-stu-id="405f8-125">Protecting Your Tables Against Application Errors</span></span>](https://blogs.msdn.microsoft.com/windowsazurestorage/2010/05/03/protecting-your-tables-against-application-errors/)
* [<span data-ttu-id="405f8-126">保護您的 Blob 以免發生應用程式錯誤</span><span class="sxs-lookup"><span data-stu-id="405f8-126">Protecting Your Blobs Against Application Errors</span></span>](https://blogs.msdn.microsoft.com/windowsazurestorage/2010/04/29/protecting-your-blobs-against-application-errors/)

## <a name="database"></a><span data-ttu-id="405f8-127">資料庫</span><span class="sxs-lookup"><span data-stu-id="405f8-127">Database</span></span>
<span data-ttu-id="405f8-128">有好幾種 [商務持續性](/azure/sql-database/sql-database-business-continuity/) (備份、還原) 選項可供 Azure SQL Database 使用。</span><span class="sxs-lookup"><span data-stu-id="405f8-128">There are several [business continuity](/azure/sql-database/sql-database-business-continuity/) (backup, restore) options available for Azure SQL Database.</span></span> <span data-ttu-id="405f8-129">透過[資料庫複製](/azure/sql-database/sql-database-copy/)功能，或透過[匯出](/azure/sql-database/sql-database-export/)與[匯入](https://msdn.microsoft.com/library/hh710052.aspx) SQL Server 的 bacpac 檔案即可複製資料庫。</span><span class="sxs-lookup"><span data-stu-id="405f8-129">Databases can be copied by using the [Database Copy](/azure/sql-database/sql-database-copy/) functionality, or by  [exporting](/azure/sql-database/sql-database-export/) and [importing](https://msdn.microsoft.com/library/hh710052.aspx) a SQL Server bacpac file.</span></span> <span data-ttu-id="405f8-130">資料庫複製可提供交易一致的結果，而 bacpac (透過匯入/匯出服務) 則不會。</span><span class="sxs-lookup"><span data-stu-id="405f8-130">Database Copy provides transactionally consistent results, while a bacpac (through the import/export service) does not.</span></span> <span data-ttu-id="405f8-131">這兩種選項都會在服務中心內以佇列為基礎的服務形式執行，並且目前不提供完成時間 SLA。</span><span class="sxs-lookup"><span data-stu-id="405f8-131">Both of these options run as queue-based services within the data center, and they do not currently provide a time-to-completion SLA.</span></span>

> [!NOTE]
> <span data-ttu-id="405f8-132">資料庫複製和匯入/匯出選項對來源資料庫有極明顯程度的負載。</span><span class="sxs-lookup"><span data-stu-id="405f8-132">The database copy and import/export options place a significant degree of load on the source database.</span></span> <span data-ttu-id="405f8-133">這些選項可能會觸發資源競爭或節流事件。</span><span class="sxs-lookup"><span data-stu-id="405f8-133">They can trigger resource contention or throttling events.</span></span>
> 
> 

### <a name="sql-database-backup"></a><span data-ttu-id="405f8-134">SQL Database 備份</span><span class="sxs-lookup"><span data-stu-id="405f8-134">SQL Database Backup</span></span>
<span data-ttu-id="405f8-135">Microsoft Azure SQL Database 的時間點備份，是透過 [複製您的 Azure SQL Database](/azure/sql-database/sql-database-copy/)達成。</span><span class="sxs-lookup"><span data-stu-id="405f8-135">Point-in-time backups for Microsoft Azure SQL Database are achieved by [copying your Azure SQL database](/azure/sql-database/sql-database-copy/).</span></span> <span data-ttu-id="405f8-136">您可以使用此命令對相同邏輯資料庫伺服器或不同伺服器建立資料庫的交易一致複本。</span><span class="sxs-lookup"><span data-stu-id="405f8-136">You can use this command to create a transactionally consistent copy of a database on the same logical database server or to a different server.</span></span> <span data-ttu-id="405f8-137">在任一情況下，資料庫複本完整可運作，且完全獨立於來源資料庫。</span><span class="sxs-lookup"><span data-stu-id="405f8-137">In either case, the database copy is fully functional and completely independent of the source database.</span></span> <span data-ttu-id="405f8-138">您所建立的每個複本代表一個時間點復原選項。</span><span class="sxs-lookup"><span data-stu-id="405f8-138">Each copy you create represents a point-in-time recovery option.</span></span> <span data-ttu-id="405f8-139">您可以將新的資料庫重新命名為來源資料庫名稱，藉以完全復原資料庫狀態。</span><span class="sxs-lookup"><span data-stu-id="405f8-139">You can recover the database state completely by renaming the new database with the source database name.</span></span> <span data-ttu-id="405f8-140">或者，您可以使用 Transact-SQL 查詢，從新的資料庫復原特定資料子集。</span><span class="sxs-lookup"><span data-stu-id="405f8-140">Alternatively, you can recover a specific subset of data from the new database by using Transact-SQL queries.</span></span> <span data-ttu-id="405f8-141">如需 SQL Database 的其他詳細資訊，請參閱 [使用 Azure SQL Database 的商務持續性概觀](/azure/sql-database/sql-database-business-continuity/)。</span><span class="sxs-lookup"><span data-stu-id="405f8-141">For additional details about SQL Database, see [Overview of business continuity with Azure SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span>

### <a name="sql-server-on-virtual-machines-backup"></a><span data-ttu-id="405f8-142">虛擬機器備份上的 SQL Server</span><span class="sxs-lookup"><span data-stu-id="405f8-142">SQL Server on Virtual Machines Backup</span></span>
<span data-ttu-id="405f8-143">針對做為服務虛擬機器用於 Azure 基礎結構的 SQL Server (通常稱為 IaaS 或 IaaS VM)，有兩個選項：傳統備份和記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="405f8-143">For SQL Server used with Azure infrastructure as a service virtual machines (often called IaaS or IaaS VMs), there are two options: traditional backups and log shipping.</span></span> <span data-ttu-id="405f8-144">使用傳統備份可讓您還原到特定時間點，但復原程序緩慢。</span><span class="sxs-lookup"><span data-stu-id="405f8-144">Using traditional backups enables you to restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="405f8-145">還原傳統備份需要從最初的完整備份開始，然後套用之後所建立的任何備份。</span><span class="sxs-lookup"><span data-stu-id="405f8-145">Restoring traditional backups requires starting with an initial full backup, and then applying any backups taken after that.</span></span> <span data-ttu-id="405f8-146">第二個選項是設定記錄傳送的工作階段，將記錄備份的還原延遲 (例如，兩個小時)。</span><span class="sxs-lookup"><span data-stu-id="405f8-146">The second option is to configure a log shipping session to delay the restore of log backups (for example, by two hours).</span></span> <span data-ttu-id="405f8-147">這會提供從在主要伺服器上所造成的錯誤復原的時間。</span><span class="sxs-lookup"><span data-stu-id="405f8-147">This provides a window to recover from errors made on the primary.</span></span>

## <a name="other-azure-platform-services"></a><span data-ttu-id="405f8-148">其他 Azure 平台服務</span><span class="sxs-lookup"><span data-stu-id="405f8-148">Other Azure platform services</span></span>
<span data-ttu-id="405f8-149">某些 Azure 平台服務會將資訊儲存在使用者控制的儲存體帳戶或 Azure SQL Database。</span><span class="sxs-lookup"><span data-stu-id="405f8-149">Some Azure platform services store information in a user-controlled storage account or Azure SQL Database.</span></span> <span data-ttu-id="405f8-150">如果帳戶或儲存體資源遭到刪除或損毀，這可能造成服務的嚴重錯誤。</span><span class="sxs-lookup"><span data-stu-id="405f8-150">If the account or storage resource is deleted or corrupted, this could cause serious errors with the service.</span></span> <span data-ttu-id="405f8-151">在這些情況下，請務必維護備份，如果資料遭到刪除或損毀，便可讓您重新建立這些資源。</span><span class="sxs-lookup"><span data-stu-id="405f8-151">In these cases, it is important to maintain backups that would enable you to re-create these resources if they were deleted or corrupted.</span></span>

<span data-ttu-id="405f8-152">針對 Azure 網站和 Azure 行動服務，您必須備份及維護相關聯的資料庫。</span><span class="sxs-lookup"><span data-stu-id="405f8-152">For Azure Web Sites and Azure Mobile Services, you must backup and maintain the associated databases.</span></span> <span data-ttu-id="405f8-153">針對 Azure 媒體服務和虛擬機器，您必須維護相關聯的 Azure 儲存體帳戶和該帳戶中的所有資源。</span><span class="sxs-lookup"><span data-stu-id="405f8-153">For Azure Media Service and Virtual Machines, you must maintain the associated Azure Storage account and all resources in that account.</span></span> <span data-ttu-id="405f8-154">例如，針對虛擬機器，您必須在 Azure Blob 儲存體中備份和管理 VM 磁碟。</span><span class="sxs-lookup"><span data-stu-id="405f8-154">For example, for Virtual Machines, you must back up and manage the VM disks in Azure blob storage.</span></span>

## <a name="checklists-for-data-corruption-or-accidental-deletion"></a><span data-ttu-id="405f8-155">資料損毀或意外刪除的檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-155">Checklists for data corruption or accidental deletion</span></span>
## <a name="virtual-machines-checklist"></a><span data-ttu-id="405f8-156">虛擬機器檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-156">Virtual Machines checklist</span></span>
1. <span data-ttu-id="405f8-157">檢閱此文件的＜虛擬機器＞一節。</span><span class="sxs-lookup"><span data-stu-id="405f8-157">Review the Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="405f8-158">使用 Azure 備份來備份及維護 VM 磁碟 (或使用 Azure Blob 儲存體和 VHD 的快照集之您自己的備份系統)。</span><span class="sxs-lookup"><span data-stu-id="405f8-158">Back up and maintain the VM disks with Azure Backup (or your own backup system by using Azure blob storage and VHD snapshots).</span></span>

## <a name="storage-checklist"></a><span data-ttu-id="405f8-159">儲存體檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-159">Storage checklist</span></span>
1. <span data-ttu-id="405f8-160">檢閱此文件的＜儲存體＞一節。</span><span class="sxs-lookup"><span data-stu-id="405f8-160">Review the Storage section of this document.</span></span>
2. <span data-ttu-id="405f8-161">定期備份重要的儲存體資源。</span><span class="sxs-lookup"><span data-stu-id="405f8-161">Regularly back up critical storage resources.</span></span>
3. <span data-ttu-id="405f8-162">考慮對 Blob 使用快照集功能。</span><span class="sxs-lookup"><span data-stu-id="405f8-162">Consider using the snapshot feature for blobs.</span></span>

## <a name="database-checklist"></a><span data-ttu-id="405f8-163">資料庫檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-163">Database checklist</span></span>
1. <span data-ttu-id="405f8-164">檢閱此文件的＜資料庫＞一節。</span><span class="sxs-lookup"><span data-stu-id="405f8-164">Review the Database section of this document.</span></span>
2. <span data-ttu-id="405f8-165">使用資料庫複製命令建立時間點備份。</span><span class="sxs-lookup"><span data-stu-id="405f8-165">Create point-in-time backups by using the Database Copy command.</span></span>

## <a name="sql-server-on-virtual-machines-backup-checklist"></a><span data-ttu-id="405f8-166">虛擬機器備份上的 SQL Server 檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-166">SQL Server on Virtual Machines Backup checklist</span></span>
1. <span data-ttu-id="405f8-167">檢閱此文件的＜虛擬機器備份上的 SQL Server＞一節。</span><span class="sxs-lookup"><span data-stu-id="405f8-167">Review the SQL Server on Virtual Machines Backup section of this document.</span></span>
2. <span data-ttu-id="405f8-168">使用傳統備份和還原技術。</span><span class="sxs-lookup"><span data-stu-id="405f8-168">Use traditional backup and restore techniques.</span></span>
3. <span data-ttu-id="405f8-169">建立延後的記錄傳送工作階段。</span><span class="sxs-lookup"><span data-stu-id="405f8-169">Create a delayed log shipping session.</span></span>

## <a name="web-apps-checklist"></a><span data-ttu-id="405f8-170">Web Apps 檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-170">Web Apps checklist</span></span>
1. <span data-ttu-id="405f8-171">備份及維護相關聯的資料庫，如果有的話。</span><span class="sxs-lookup"><span data-stu-id="405f8-171">Back up and maintain the associated database, if any.</span></span>

## <a name="media-services-checklist"></a><span data-ttu-id="405f8-172">媒體服務檢查清單</span><span class="sxs-lookup"><span data-stu-id="405f8-172">Media Services checklist</span></span>
1. <span data-ttu-id="405f8-173">備份及維護相關聯的儲存體資源。</span><span class="sxs-lookup"><span data-stu-id="405f8-173">Back up and maintain the associated storage resources.</span></span>

## <a name="more-information"></a><span data-ttu-id="405f8-174">詳細資訊</span><span class="sxs-lookup"><span data-stu-id="405f8-174">More information</span></span>
<span data-ttu-id="405f8-175">如需有關 Azure 的備份和還原功能的詳細資訊，請參閱 [儲存體、備份和復原案例](https://azure.microsoft.com/documentation/scenarios/storage-backup-recovery/)。</span><span class="sxs-lookup"><span data-stu-id="405f8-175">For more information about backup and restore features in Azure, see [Storage, backup and recovery scenarios](https://azure.microsoft.com/documentation/scenarios/storage-backup-recovery/).</span></span>


