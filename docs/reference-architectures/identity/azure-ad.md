---
title: 整合內部部署 AD 網域與 Azure Active Directory
description: 如何使用 Azure Active Directory 實作安全的混合式網路架構。
author: telmosampaio
pnp.series.title: Identity management
ms.date: 11/28/2016
pnp.series.next: adds-extend-domain
pnp.series.prev: ./index
cardTitle: Integrate on-premises AD with Azure AD
ms.openlocfilehash: b5cd4d353c6d6b149c9c1b5547f8da8c25ad5a85
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429225"
---
# <a name="integrate-on-premises-active-directory-domains-with-azure-active-directory"></a><span data-ttu-id="3d98a-103">整合內部部署 Active Directory 網域與 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="3d98a-103">Integrate on-premises Active Directory domains with Azure Active Directory</span></span>

<span data-ttu-id="3d98a-104">Azure Active Directory (Azure AD) 是雲端式的多租用戶目錄和身分識別服務。</span><span class="sxs-lookup"><span data-stu-id="3d98a-104">Azure Active Directory (Azure AD) is a cloud based multi-tenant directory and identity service.</span></span> <span data-ttu-id="3d98a-105">此參考架構會顯示最佳做法，供您整合內部部署 Active Directory 網域與 Azure AD 以提供雲端式身分識別驗證。</span><span class="sxs-lookup"><span data-stu-id="3d98a-105">This reference architecture shows best practices for integrating on-premises Active Directory domains with Azure AD to provide cloud-based identity authentication.</span></span> [<span data-ttu-id="3d98a-106">**部署這個解決方案**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="3d98a-107">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="3d98a-107">[![0]][0]</span></span> 

<span data-ttu-id="3d98a-108">下載這個架構的 [Visio 檔案][visio-download]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="3d98a-109">為求簡化，此圖只顯示與 Azure AD 直接相關的連線，而不顯示可能會在驗證和身分識別同盟期間發生的通訊協定相關流量。</span><span class="sxs-lookup"><span data-stu-id="3d98a-109">For simplicity, this diagram only shows the connections directly related to Azure AD, and not protocol-related traffic that may occur as part of authentication and identity federation.</span></span> <span data-ttu-id="3d98a-110">例如，Web 應用程式可能會將網頁瀏覽器重新導向為透過 Azure AD 驗證要求。</span><span class="sxs-lookup"><span data-stu-id="3d98a-110">For example, a web application may redirect the web browser to authenticate the request through Azure AD.</span></span> <span data-ttu-id="3d98a-111">通過驗證之後，即可將要求傳回給 Web 應用程式，其中會具有適當的身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-111">Once authenticated, the request can be passed back to the web application, with the appropriate identity information.</span></span>
> 

<span data-ttu-id="3d98a-112">此參少架構的典型使用案例包括：</span><span class="sxs-lookup"><span data-stu-id="3d98a-112">Typical uses for this reference architecture include:</span></span>

* <span data-ttu-id="3d98a-113">部署在 Azure 中的 Web 應用程式，其可存取隸屬於貴組織的遠端使用者。</span><span class="sxs-lookup"><span data-stu-id="3d98a-113">Web applications deployed in Azure that provide access to remote users who belong to your organization.</span></span>
* <span data-ttu-id="3d98a-114">為使用者實作自助式功能，例如重設其密碼，以及委派群組管理。</span><span class="sxs-lookup"><span data-stu-id="3d98a-114">Implementing self-service capabilities for end-users, such as resetting their passwords, and delegating group management.</span></span> <span data-ttu-id="3d98a-115">請注意，這需要 Azure AD Premium 版本。</span><span class="sxs-lookup"><span data-stu-id="3d98a-115">Note that this requires Azure AD Premium edition.</span></span>
* <span data-ttu-id="3d98a-116">內部部署網路和應用程式的 Azure VNet 未使用 VPN 通道或 ExpressRoute 線路連線的架構。</span><span class="sxs-lookup"><span data-stu-id="3d98a-116">Architectures in which the on-premises network and the application's Azure VNet are not connected using a VPN tunnel or ExpressRoute circuit.</span></span>

> [!NOTE]
> <span data-ttu-id="3d98a-117">Azure AD 可以驗證存在於組織目錄中使用者和應用程式的身分識別。</span><span class="sxs-lookup"><span data-stu-id="3d98a-117">Azure AD can authenticate the identity of users and applications that exist in an organization’s directory.</span></span> <span data-ttu-id="3d98a-118">某些應用程式和服務 (例如 SQL Server) 可能需要電腦驗證，但這並非此解決方案的適用情況。</span><span class="sxs-lookup"><span data-stu-id="3d98a-118">Some applications and services, such as SQL Server, may require computer authentication, in which case this solution is not appropriate.</span></span>
> 

<span data-ttu-id="3d98a-119">如需了解其他考量，請參閱[選擇解決方案以整合內部部署 Active Directory 與 Azure][considerations]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-119">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span> 

## <a name="architecture"></a><span data-ttu-id="3d98a-120">架構</span><span class="sxs-lookup"><span data-stu-id="3d98a-120">Architecture</span></span>

<span data-ttu-id="3d98a-121">此架構具有下列元件。</span><span class="sxs-lookup"><span data-stu-id="3d98a-121">The architecture has the following components.</span></span>

* <span data-ttu-id="3d98a-122">**Azure AD 租用戶**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-122">**Azure AD tenant**.</span></span> <span data-ttu-id="3d98a-123">這是貴組織所建立之 [Azure AD][azure-active-directory] 的執行個體。</span><span class="sxs-lookup"><span data-stu-id="3d98a-123">An instance of [Azure AD][azure-active-directory] created by your organization.</span></span> <span data-ttu-id="3d98a-124">它可以儲存從內部部署 Active Directory 所複製過來的物件以作為雲端應用程式的目錄服務，並且也可以提供識別服務。</span><span class="sxs-lookup"><span data-stu-id="3d98a-124">It acts as a directory service for cloud applications by storing objects copied from the on-premises Active Directory and provides identity services.</span></span>
* <span data-ttu-id="3d98a-125">**Web 層子網路**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-125">**Web tier subnet**.</span></span> <span data-ttu-id="3d98a-126">此子網路會保存執行 Web 應用程式的 VM。</span><span class="sxs-lookup"><span data-stu-id="3d98a-126">This subnet holds VMs that run a web application.</span></span> <span data-ttu-id="3d98a-127">Azure AD 可作為此應用程式的身分識別 Broker。</span><span class="sxs-lookup"><span data-stu-id="3d98a-127">Azure AD can act as an identity broker for this application.</span></span>
* <span data-ttu-id="3d98a-128">**內部部署 AD DS 伺服器**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-128">**On-premises AD DS server**.</span></span> <span data-ttu-id="3d98a-129">內部部署目錄和識別服務。</span><span class="sxs-lookup"><span data-stu-id="3d98a-129">An on-premise directory and identity service.</span></span> <span data-ttu-id="3d98a-130">AD DS 目錄可與 Azure AD 同步，以便讓它能夠驗證內部部署使用者。</span><span class="sxs-lookup"><span data-stu-id="3d98a-130">The AD DS directory can be synchronized with Azure AD to enable it to authenticate on-premise users.</span></span>
* <span data-ttu-id="3d98a-131">**Azure AD Connect 同步處理伺服器**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-131">**Azure AD Connect sync server**.</span></span> <span data-ttu-id="3d98a-132">執行 [Azure AD Connect][azure-ad-connect] 同步處理服務的內部部署電腦。</span><span class="sxs-lookup"><span data-stu-id="3d98a-132">An on-premises computer that runs the [Azure AD Connect][azure-ad-connect] sync service.</span></span> <span data-ttu-id="3d98a-133">此服務會將保留在內部部署 Active Directory 的資訊同步處理至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="3d98a-133">This service synchronizes information held in the on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="3d98a-134">例如，如果您佈建或取消佈建內部部署群組和使用者，這些變更會傳播至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="3d98a-134">For example, if you provision or deprovision groups and users on-premises, these changes propagate to Azure AD.</span></span> 
  
  > [!NOTE]
  > <span data-ttu-id="3d98a-135">為求安全，Azure AD 會將使用者的密碼儲存為雜湊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-135">For security reasons, Azure AD stores user's passwords as a hash.</span></span> <span data-ttu-id="3d98a-136">如果使用者需要重設密碼，這必須在內部部署環境中執行，而且必須將新的雜湊傳送至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="3d98a-136">If a user requires a password reset, this must be performed on-premises and the new hash must be sent to Azure AD.</span></span> <span data-ttu-id="3d98a-137">Azure AD Premium 版本有功能可自動執行這項工作，讓使用者能夠重設自己的密碼。</span><span class="sxs-lookup"><span data-stu-id="3d98a-137">Azure AD Premium editions include features that can automate this task to enable users to reset their own passwords.</span></span>
  > 

* <span data-ttu-id="3d98a-138">**多層式架構 (N-tier) 應用程式的 VM**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-138">**VMs for N-tier application**.</span></span> <span data-ttu-id="3d98a-139">此部署包含多層式架構應用程式的基礎結構。</span><span class="sxs-lookup"><span data-stu-id="3d98a-139">The deployment includes infrastructure for an N-tier application.</span></span> <span data-ttu-id="3d98a-140">如需這些資源的詳細資訊，請參閱[執行多層式架構的 VM][implementing-a-multi-tier-architecture-on-Azure]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-140">For more information about these resources, see [Run VMs for an N-tier architecture][implementing-a-multi-tier-architecture-on-Azure].</span></span>

## <a name="recommendations"></a><span data-ttu-id="3d98a-141">建議</span><span class="sxs-lookup"><span data-stu-id="3d98a-141">Recommendations</span></span>

<span data-ttu-id="3d98a-142">下列建議適用於大部分的案例。</span><span class="sxs-lookup"><span data-stu-id="3d98a-142">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="3d98a-143">除非您有特定的需求會覆寫它們，否則請遵循下列建議。</span><span class="sxs-lookup"><span data-stu-id="3d98a-143">Follow these recommendations unless you have a specific requirement that overrides them.</span></span> 

### <a name="azure-ad-connect-sync-service"></a><span data-ttu-id="3d98a-144">Azure AD Connect 同步處理服務</span><span class="sxs-lookup"><span data-stu-id="3d98a-144">Azure AD Connect sync service</span></span>

<span data-ttu-id="3d98a-145">Azure AD Connect 同步處理服務可確保雲端中儲存的身分識別資訊，會與保留在內部部署環境中的資訊一致。</span><span class="sxs-lookup"><span data-stu-id="3d98a-145">The Azure AD Connect sync service ensures that identity information stored in the cloud is consistent with that held on-premises.</span></span> <span data-ttu-id="3d98a-146">您可以使用 Azure AD Connect 軟體安裝此服務。</span><span class="sxs-lookup"><span data-stu-id="3d98a-146">You install this service using the Azure AD Connect software.</span></span> 

<span data-ttu-id="3d98a-147">在實作 Azure AD Connect 同步處理之前，請判斷貴組織的同步處理需求。</span><span class="sxs-lookup"><span data-stu-id="3d98a-147">Before implementing Azure AD Connect sync, determine the synchronization requirements of your organization.</span></span> <span data-ttu-id="3d98a-148">例如，要同步處理哪些項目、從哪個網域，以及多久進行一次。</span><span class="sxs-lookup"><span data-stu-id="3d98a-148">For example, what to synchronize, from which domains, and how frequently.</span></span> <span data-ttu-id="3d98a-149">如需詳細資訊，請參閱[判斷目錄同步處理需求][aad-sync-requirements]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-149">For more information, see [Determine directory synchronization requirements][aad-sync-requirements].</span></span>

<span data-ttu-id="3d98a-150">您可以在 VM 或裝載於內部部署環境的電腦上，執行 Azure AD Connect 同步處理服務。</span><span class="sxs-lookup"><span data-stu-id="3d98a-150">You can run the Azure AD Connect sync service on a VM or a computer hosted on-premises.</span></span> <span data-ttu-id="3d98a-151">根據 Active Directory 目錄中資訊的變動性，在首次與 Azure AD 同步處理之後，Azure AD Connect 同步處理服務的負載不會太高。</span><span class="sxs-lookup"><span data-stu-id="3d98a-151">Depending on the volatility of the information in your Active Directory directory, the load on the Azure AD Connect sync service is unlikely to be high after the initial synchronization with Azure AD.</span></span> <span data-ttu-id="3d98a-152">在 VM 上執行服務，可讓您在需要時輕鬆地調整伺服器。</span><span class="sxs-lookup"><span data-stu-id="3d98a-152">Running the service on a VM makes it easier to scale the server if needed.</span></span> <span data-ttu-id="3d98a-153">請依照＜監視考量＞一節所述監視 VM 上的活動，以判斷是否有必要調整。</span><span class="sxs-lookup"><span data-stu-id="3d98a-153">Monitor the activity on the VM as described in the Monitoring considerations section to determine whether scaling is necessary.</span></span>

<span data-ttu-id="3d98a-154">如果您的樹系中有多個內部部署網域，建議您將整個樹系的資訊儲存起來，並同步處理至單一 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="3d98a-154">If you have multiple on-premises domains in a forest, we recommend storing and synchronizing information for the entire forest to a single Azure AD tenant.</span></span> <span data-ttu-id="3d98a-155">篩選在多個網域中出現之身分識別的資訊，讓每個身分識別只在 Azure AD 中出現一次，而不是重複出現。</span><span class="sxs-lookup"><span data-stu-id="3d98a-155">Filter information for identities that occur in more than one domain, so that each identity appears only once in Azure AD, rather than being duplicated.</span></span> <span data-ttu-id="3d98a-156">重複出現會導致同步處理資料時發生不一致的情形。</span><span class="sxs-lookup"><span data-stu-id="3d98a-156">Duplication can lead to inconsistencies when data is synchronized.</span></span> <span data-ttu-id="3d98a-157">如需詳細資訊，請參閱下面的＜拓撲＞一節。</span><span class="sxs-lookup"><span data-stu-id="3d98a-157">For more information, see the Topology section below.</span></span> 

<span data-ttu-id="3d98a-158">使用篩選，以便只將必要的資料儲存在 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="3d98a-158">Use filtering so that only necessary data is stored in Azure AD.</span></span> <span data-ttu-id="3d98a-159">例如，貴組織可能不會想要將非使用中帳戶的相關資訊儲存在 Azure AD 中。</span><span class="sxs-lookup"><span data-stu-id="3d98a-159">For example, your organization might not want to store information about inactive accounts in Azure AD.</span></span> <span data-ttu-id="3d98a-160">您可以進行群組型、網域型、組織單位 (OU) 型或屬性型篩選。</span><span class="sxs-lookup"><span data-stu-id="3d98a-160">Filtering can be group-based, domain-based, organization unit (OU)-based, or attribute-based.</span></span> <span data-ttu-id="3d98a-161">您可以結合多個篩選器，以產生更複雜的規則。</span><span class="sxs-lookup"><span data-stu-id="3d98a-161">You can combine filters to generate more complex rules.</span></span> <span data-ttu-id="3d98a-162">例如，您可以對網域所保有、在選取的屬性中具有特定值的物件進行同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d98a-162">For example, you could synchronize objects held in a domain that have a specific value in a selected attribute.</span></span> <span data-ttu-id="3d98a-163">如需詳細資訊，請參閱 [Azure AD Connect 同步處理：設定篩選][aad-filtering]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-163">For detailed information, see [Azure AD Connect sync: Configure Filtering][aad-filtering].</span></span>

<span data-ttu-id="3d98a-164">若要為 AD Connect 同步處理服務實作高可用性功能，請執行次要的預備伺服器。</span><span class="sxs-lookup"><span data-stu-id="3d98a-164">To implement high availability for the AD Connect sync service, run a secondary staging server.</span></span> <span data-ttu-id="3d98a-165">如需詳細資訊，請參閱＜拓撲建議＞一節。</span><span class="sxs-lookup"><span data-stu-id="3d98a-165">For more information, see the Topology recommendations section.</span></span>

### <a name="security-recommendations"></a><span data-ttu-id="3d98a-166">安全性建議</span><span class="sxs-lookup"><span data-stu-id="3d98a-166">Security recommendations</span></span>

<span data-ttu-id="3d98a-167">**使用者密碼管理。**</span><span class="sxs-lookup"><span data-stu-id="3d98a-167">**User password management.**</span></span> <span data-ttu-id="3d98a-168">Azure AD Premium 版本支援密碼回寫，此功能可讓您的內部部署使用者從 Azure 入口網站內執行自助式密碼重設作業。</span><span class="sxs-lookup"><span data-stu-id="3d98a-168">The Azure AD Premium editions support password writeback, enabling your on-premises users to perform self-service password resets from within the Azure portal.</span></span> <span data-ttu-id="3d98a-169">請在檢閱過貴組織的密碼安全性原則後，才啟用此功能。</span><span class="sxs-lookup"><span data-stu-id="3d98a-169">This feature should only be enabled after reviewing your organization's password security policy.</span></span> <span data-ttu-id="3d98a-170">例如，您可以限制哪些使用者可以變更其密碼，並可以量身打造密碼管理體驗。</span><span class="sxs-lookup"><span data-stu-id="3d98a-170">For example, you can restrict which users can change their passwords, and you can tailor the password management experience.</span></span> <span data-ttu-id="3d98a-171">如需詳細資訊，請參閱[自訂密碼管理以符合您的組織的需求][aad-password-management]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-171">For more information, see [Customizing Password Management to fit your organization's needs][aad-password-management].</span></span> 

<span data-ttu-id="3d98a-172">**保護可從外部存取的內部部署應用程式。**</span><span class="sxs-lookup"><span data-stu-id="3d98a-172">**Protect on-premises applications that can be accessed externally.**</span></span> <span data-ttu-id="3d98a-173">使用 Azure AD 應用程式 Proxy 可對外部使用者提供透過 Azure AD 存取內部部署 Web 應用程式的服務，且其存取權會受到控制。</span><span class="sxs-lookup"><span data-stu-id="3d98a-173">Use the Azure AD Application Proxy to provide controlled access to on-premises web applications for external users through Azure AD.</span></span> <span data-ttu-id="3d98a-174">只有擁有您 Azure 目錄有效認證的使用者有權使用應用程式。</span><span class="sxs-lookup"><span data-stu-id="3d98a-174">Only users that have valid credentials in your Azure directory have permission to use the application.</span></span> <span data-ttu-id="3d98a-175">如需詳細資訊，請參閱[在 Azure 入口網站中啟用應用程式 Proxy][aad-application-proxy]一文。</span><span class="sxs-lookup"><span data-stu-id="3d98a-175">For more information, see the article [Enable Application Proxy in the Azure portal][aad-application-proxy].</span></span>

<span data-ttu-id="3d98a-176">**主動監視 Azure AD 中是否有可疑活動的跡象。**</span><span class="sxs-lookup"><span data-stu-id="3d98a-176">**Actively monitor Azure AD for signs of suspicious activity.**</span></span>    <span data-ttu-id="3d98a-177">請考慮使用 Azure AD Premium P2 版本，其包含 Azure AD Identity Protection。</span><span class="sxs-lookup"><span data-stu-id="3d98a-177">Consider using Azure AD Premium P2 edition, which includes Azure AD Identity Protection.</span></span> <span data-ttu-id="3d98a-178">Identity Protection 會使用調適性機器學習服務演算法和啟發學習法，來偵測異常以及可能表示身分識別已遭入侵的風險事件。</span><span class="sxs-lookup"><span data-stu-id="3d98a-178">Identity Protection uses adaptive machine learning algorithms and heuristics to detect anomalies and risk events that may indicate that an identity has been compromised.</span></span> <span data-ttu-id="3d98a-179">例如，它可以偵測到潛在的不尋常活動，例如異常登入活動、從不明來源或從具有可疑活動之 IP 位址進行的登入，或是從可能受感染的裝置進行的登入。</span><span class="sxs-lookup"><span data-stu-id="3d98a-179">For example, it can detect potentially unusual activity such as irregular sign-in activities, sign-ins from unknown sources or from IP addresses with suspicious activity, or sign-ins from devices that may be infected.</span></span> <span data-ttu-id="3d98a-180">Identity Protection 會使用此資料來產生報告和警示，讓您調查這些風險事件並採取適當動作。</span><span class="sxs-lookup"><span data-stu-id="3d98a-180">Using this data, Identity Protection generates reports and alerts that enables you to investigate these risk events and take appropriate action.</span></span> <span data-ttu-id="3d98a-181">如需詳細資訊，請參閱 [Azure Active Directory Identity Protection][aad-identity-protection]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-181">For more information, see [Azure Active Directory Identity Protection][aad-identity-protection].</span></span>
  
<span data-ttu-id="3d98a-182">您可以在 Azure 入口網站中使用 Azure AD 的報告功能，監視系統中所發生的安全性相關活動。</span><span class="sxs-lookup"><span data-stu-id="3d98a-182">You can use the reporting feature of Azure AD in the Azure portal to monitor security-related activities occurring in your system.</span></span> <span data-ttu-id="3d98a-183">如需如何使用這些報告的詳細資訊，請參閱 [Azure Active Directory 報告指南][aad-reporting-guide]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-183">For more information about using these reports, see [Azure Active Directory Reporting Guide][aad-reporting-guide].</span></span>

### <a name="topology-recommendations"></a><span data-ttu-id="3d98a-184">拓撲建議</span><span class="sxs-lookup"><span data-stu-id="3d98a-184">Topology recommendations</span></span>

<span data-ttu-id="3d98a-185">請設定 Azure AD Connect，以實作與貴組織的需求最相符的拓撲。</span><span class="sxs-lookup"><span data-stu-id="3d98a-185">Configure Azure AD Connect to implement a topology that most closely matches the requirements of your organization.</span></span> <span data-ttu-id="3d98a-186">Azure AD Connect 所支援的拓撲如下：</span><span class="sxs-lookup"><span data-stu-id="3d98a-186">Topologies that Azure AD Connect supports include the following:</span></span>

* <span data-ttu-id="3d98a-187">**單一樹系、單一 Azure AD 目錄**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-187">**Single forest, single Azure AD directory**.</span></span> <span data-ttu-id="3d98a-188">在此拓撲中，Azure AD Connect 會將物件和身分識別資訊從單一內部部署樹系中的一或多個網域，同步處理至單一 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="3d98a-188">In this topology, Azure AD Connect synchronizes objects and identity information from one or more domains in a single on-premises forest into a single Azure AD tenant.</span></span> <span data-ttu-id="3d98a-189">這是 Azure AD Connect 的快速安裝會實作的預設拓撲。</span><span class="sxs-lookup"><span data-stu-id="3d98a-189">This is the default topology implemented by the express installation of Azure AD Connect.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="3d98a-190">除非您要以預備模式執行伺服器，否則請勿使用多個 Azure AD Connect 同步處理伺服器將相同內部部署樹系中的不同網域連線到相同的 Azure AD 租用戶，如下所述。</span><span class="sxs-lookup"><span data-stu-id="3d98a-190">Don't use multiple Azure AD Connect sync servers to connect different domains in the same on-premises forest to the same Azure AD tenant, unless you are running a server in staging mode, described below.</span></span>
  > 
  > 

* <span data-ttu-id="3d98a-191">**多樹系、單一 Azure AD 目錄**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-191">**Multiple forests, single Azure AD directory**.</span></span> <span data-ttu-id="3d98a-192">在此拓撲中，Azure AD Connect 會將物件和身分識別資訊從多個樹系同步處理至單一 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="3d98a-192">In this topology, Azure AD Connect synchronizes objects and identity information from multiple forests into a single Azure AD tenant.</span></span> <span data-ttu-id="3d98a-193">如果貴組織有多個內部部署樹系，請使用此拓撲。</span><span class="sxs-lookup"><span data-stu-id="3d98a-193">Use this topology if your organization has more than one on-premises forest.</span></span> <span data-ttu-id="3d98a-194">您可以合併身分識別資訊，讓每個唯一的使用者只會在 Azure AD 目錄中顯示一次，即使同一名使用者存在於多個樹系亦然。</span><span class="sxs-lookup"><span data-stu-id="3d98a-194">You can consolidate identity information so that each unique user is represented once in the Azure AD directory, even if the same user exists in more than one forest.</span></span> <span data-ttu-id="3d98a-195">所有樹系都會使用相同的 Azure AD Connect 同步處理伺服器。</span><span class="sxs-lookup"><span data-stu-id="3d98a-195">All forests use the same Azure AD Connect sync server.</span></span> <span data-ttu-id="3d98a-196">Azure AD Connect 同步處理伺服器不必屬於任何網域，但必須可從所有樹系加以連線。</span><span class="sxs-lookup"><span data-stu-id="3d98a-196">The Azure AD Connect sync server does not have to be part of any domain, but it must be reachable from all forests.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="3d98a-197">在此拓撲中，請勿使用不同的 Azure AD Connect 同步處理伺服器將每個內部部署樹系連線至單一 Azure AD 租用戶。</span><span class="sxs-lookup"><span data-stu-id="3d98a-197">In this topology, don't use separate Azure AD Connect sync servers to connect each on-premises forest to a single Azure AD tenant.</span></span> <span data-ttu-id="3d98a-198">如果使用者出現在多個樹系中，這可能會導致 Azure AD 中有重複的身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-198">This can result in duplicated identity information in Azure AD if users are present in more than one forest.</span></span>
  > 
  > 

* <span data-ttu-id="3d98a-199">**多個樹系，個別拓撲**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-199">**Multiple forests, separate topologies**.</span></span> <span data-ttu-id="3d98a-200">此拓撲會將不同樹系的身分識別資訊合併至單一 Azure AD 租用戶，將所有樹系視為不同的實體。</span><span class="sxs-lookup"><span data-stu-id="3d98a-200">This topology merges identity information from separate forests into a single Azure AD tenant, treating all forests as separate entities.</span></span> <span data-ttu-id="3d98a-201">如果您要合併不同組織的樹系，而且每個使用者的身分識別資訊只保留在一個樹系中，此拓撲會很實用。</span><span class="sxs-lookup"><span data-stu-id="3d98a-201">This topology is useful if you are combining forests from different organizations and the identity information for each user is held in only one forest.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="3d98a-202">如果每個樹系中的全域通訊清單 (GAL) 都進行同步處理，某個樹系中的使用者可能會出現在另一個樹系中作為連絡人。</span><span class="sxs-lookup"><span data-stu-id="3d98a-202">If the global address lists (GAL) in each forest are synchronized, a user in one forest may be present in another as a contact.</span></span> <span data-ttu-id="3d98a-203">如果貴組織已使用 Forefront Identity Manager 2010 或 Microsoft Identity Manager 2016 實作 GALSync，便可能發生此情形。</span><span class="sxs-lookup"><span data-stu-id="3d98a-203">This can occur if your organization has implemented GALSync with Forefront Identity manager 2010 or Microsoft Identity Manager 2016.</span></span> <span data-ttu-id="3d98a-204">在此案例中，您可以指定應該以 Mail 屬性識別使用者。</span><span class="sxs-lookup"><span data-stu-id="3d98a-204">In this scenario, you can specify that users should be identified by their *Mail* attribute.</span></span> <span data-ttu-id="3d98a-205">您也可以使用 *ObjectSID* 和 *msExchMasterAccountSID* 屬性比對身分。</span><span class="sxs-lookup"><span data-stu-id="3d98a-205">You can also match identities using the *ObjectSID* and *msExchMasterAccountSID* attributes.</span></span> <span data-ttu-id="3d98a-206">如果您的一或多個資源樹系具有已停用的帳戶，則此拓撲很實用。</span><span class="sxs-lookup"><span data-stu-id="3d98a-206">This is useful if you have one or more resource forests with disabled accounts.</span></span>
  > 
  > 

* <span data-ttu-id="3d98a-207">**預備伺服器**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-207">**Staging server**.</span></span> <span data-ttu-id="3d98a-208">在此組態中，您會以平行方式，連同第一個執行個體來執行 Azure AD Connect 同步處理伺服器的第二個執行個體。</span><span class="sxs-lookup"><span data-stu-id="3d98a-208">In this configuration, you run a second instance of the Azure AD Connect sync server in parallel with the first.</span></span> <span data-ttu-id="3d98a-209">此結構支援的案例如下：</span><span class="sxs-lookup"><span data-stu-id="3d98a-209">This structure supports scenarios such as:</span></span>
  
  * <span data-ttu-id="3d98a-210">高可用性。</span><span class="sxs-lookup"><span data-stu-id="3d98a-210">High availability.</span></span>
  * <span data-ttu-id="3d98a-211">測試和部署 Azure AD Connect 同步處理伺服器的新組態。</span><span class="sxs-lookup"><span data-stu-id="3d98a-211">Testing and deploying a new configuration of the Azure AD Connect sync server.</span></span>
  * <span data-ttu-id="3d98a-212">引進新伺服器，並解除舊組態。</span><span class="sxs-lookup"><span data-stu-id="3d98a-212">Introducing a new server and decommissioning an old configuration.</span></span> 
    
    <span data-ttu-id="3d98a-213">在這些案例中，第二個執行個體會以「預備模式」執行。</span><span class="sxs-lookup"><span data-stu-id="3d98a-213">In these scenarios, the second instance runs in *staging mode*.</span></span> <span data-ttu-id="3d98a-214">伺服器會記錄其資料庫中所匯入的物件和同步處理資料，但不會將資料傳遞至 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="3d98a-214">The server records imported objects and synchronization data in its database, but does not pass the data to Azure AD.</span></span> <span data-ttu-id="3d98a-215">如果您停用預備模式，伺服器會開始將資料寫入到 Azure AD，並且還會在情況合適時，執行將密碼回寫到內部部署目錄的作業。</span><span class="sxs-lookup"><span data-stu-id="3d98a-215">If you disable staging mode, the server starts writing data to Azure AD, and also starts performing password write-backs into the on-premises directories where appropriate.</span></span> <span data-ttu-id="3d98a-216">如需詳細資訊，請參閱 [Azure AD Connect 同步處理：作業工作和考量][aad-connect-sync-operational-tasks]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-216">For more information, see [Azure AD Connect sync: Operational tasks and considerations][aad-connect-sync-operational-tasks].</span></span>

* <span data-ttu-id="3d98a-217">**多個 Azure AD 目錄**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-217">**Multiple Azure AD directories**.</span></span> <span data-ttu-id="3d98a-218">雖然我們會建議您為組織建立單一的 Azure AD 目錄，但有時候您可能需要將資訊分割到不同的 Azure AD 目錄。</span><span class="sxs-lookup"><span data-stu-id="3d98a-218">It is recommended that you create a single Azure AD directory for an organization, but there may be situations where you need to partition information across separate Azure AD directories.</span></span> <span data-ttu-id="3d98a-219">在此情況下，請避免發生同步處理和密碼回寫問題，方法是確保內部部署樹系的每個物件只會出現在一個 Azure AD 目錄。</span><span class="sxs-lookup"><span data-stu-id="3d98a-219">In this case, avoid synchronization and password write-back issues by ensuring that each object from the on-premises forest appears in only one Azure AD directory.</span></span> <span data-ttu-id="3d98a-220">若要實作此案例，請為每個 Azure AD 目錄設定不同的 Azure AD Connect 同步處理伺服器，並使用篩選功能，讓每個 Azure AD Connect 同步處理伺服器在一組互斥的物件上運作。</span><span class="sxs-lookup"><span data-stu-id="3d98a-220">To implement this scenario, configure separate Azure AD Connect sync servers for each Azure AD directory, and use filtering so that each Azure AD Connect sync server operates on a mutually exclusive set of objects.</span></span> 

<span data-ttu-id="3d98a-221">如需這些拓撲的詳細資訊，請參閱 [Azure AD Connect 的拓撲][aad-topologies]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-221">For more information about these topologies, see [Topologies for Azure AD Connect][aad-topologies].</span></span>

### <a name="user-authentication"></a><span data-ttu-id="3d98a-222">使用者驗證</span><span class="sxs-lookup"><span data-stu-id="3d98a-222">User authentication</span></span>

<span data-ttu-id="3d98a-223">根據預設，Azure AD Connect 同步伺服器會在內部部署網域與 Azure AD 之間設定密碼雜湊同步處理，且 Azure AD 服務會假設使用者是藉由提供他們在內部部署環境中使用的相同密碼進行驗證。</span><span class="sxs-lookup"><span data-stu-id="3d98a-223">By default, the Azure AD Connect sync server configures password hash synchronization between the on-premises domain and Azure AD, and the Azure AD service assumes that users authenticate by providing the same password that they use on-premises.</span></span> <span data-ttu-id="3d98a-224">對許多組織來說，這是適當的方式，但您也應該考慮到組織現有的原則和基礎結構。</span><span class="sxs-lookup"><span data-stu-id="3d98a-224">For many organizations, this is appropriate, but you should consider your organization's existing policies and infrastructure.</span></span> <span data-ttu-id="3d98a-225">例如︰</span><span class="sxs-lookup"><span data-stu-id="3d98a-225">For example:</span></span>

* <span data-ttu-id="3d98a-226">貴組織的安全性原則可能會禁止將密碼雜湊同步處理至雲端。</span><span class="sxs-lookup"><span data-stu-id="3d98a-226">The security policy of your organization may prohibit synchronizing password hashes to the cloud.</span></span> <span data-ttu-id="3d98a-227">在此情況下，您的組織應考慮使用[傳遞驗證](/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication)。</span><span class="sxs-lookup"><span data-stu-id="3d98a-227">In this case your organization should consider [pass-through authentication](/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication).</span></span>
* <span data-ttu-id="3d98a-228">您可能會要求使用者在從公司網路上已加入網域的機器中存取雲端資源時，使用無縫式單一登入 (SSO)。</span><span class="sxs-lookup"><span data-stu-id="3d98a-228">You might require that users experience seamless single sign-on (SSO) when accessing cloud resources from domain-joined machines on the corporate network.</span></span>
* <span data-ttu-id="3d98a-229">貴組織可能已部署 Active Directory 同盟服務 (AD FS) 或第三方同盟提供者。</span><span class="sxs-lookup"><span data-stu-id="3d98a-229">Your organization might already have Active Directory Federation Services (AD FS) or a third party federation provider deployed.</span></span> <span data-ttu-id="3d98a-230">您可以將 Azure AD 設定為使用此基礎結構，以實作驗證和 SSO，而不是使用雲端中保留的密碼資訊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-230">You can configure Azure AD to use this infrastructure to implement authentication and SSO rather than by using password information held in the cloud.</span></span>

<span data-ttu-id="3d98a-231">如需詳細資訊，請參閱 [Azure AD Connect 使用者登入選項][aad-user-sign-in]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-231">For more information, see [Azure AD Connect User Sign on options][aad-user-sign-in].</span></span>

### <a name="azure-ad-application-proxy"></a><span data-ttu-id="3d98a-232">Azure AD 應用程式 Proxy</span><span class="sxs-lookup"><span data-stu-id="3d98a-232">Azure AD application proxy</span></span> 

<span data-ttu-id="3d98a-233">使用 Azure AD 提供內部部署應用程式的存取權。</span><span class="sxs-lookup"><span data-stu-id="3d98a-233">Use Azure AD to provide access to on-premises applications.</span></span>

<span data-ttu-id="3d98a-234">請使用 Azure AD 應用程式 Proxy 元件所管理的應用程式 Proxy 連接器，公開您的內部部署 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="3d98a-234">Expose your on-premises web applications using application proxy connectors managed by the Azure AD application proxy component.</span></span> <span data-ttu-id="3d98a-235">應用程式 Proxy 連接器會開啟連往 Azure AD 應用程式 Proxy 的輸出網路連線，而且遠端使用者的要求會透過此連線，從 Azure AD 往回路由傳送至 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="3d98a-235">The application proxy connector opens an outbound network connection to the Azure AD application proxy, and remote users' requests are routed back from Azure AD through this connection to the web apps.</span></span> <span data-ttu-id="3d98a-236">這可讓您不再需要於內部部署防火牆開啟輸入連接埠，並減少貴組織所暴露的受攻擊面。</span><span class="sxs-lookup"><span data-stu-id="3d98a-236">This removes the need to open inbound ports in the on-premises firewall and reduces the attack surface exposed by your organization.</span></span>

<span data-ttu-id="3d98a-237">如需詳細資訊，請參閱[使用 Azure AD 應用程式 Proxy 發佈應用程式][aad-application-proxy]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-237">For more information, see [Publish applications using Azure AD Application proxy][aad-application-proxy].</span></span>

### <a name="object-synchronization"></a><span data-ttu-id="3d98a-238">物件同步處理</span><span class="sxs-lookup"><span data-stu-id="3d98a-238">Object synchronization</span></span> 

<span data-ttu-id="3d98a-239">Azure AD Connect 的預設組態會根據 [Azure AD Connect 同步處理：了解預設組態][aad-connect-sync-default-rules]一文所指定的規則，同步處理來自您本機 Active Directory 目錄的物件。</span><span class="sxs-lookup"><span data-stu-id="3d98a-239">Azure AD Connect's default configuration synchronizes objects from your local Active Directory directory based on the rules specified in the article [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules].</span></span> <span data-ttu-id="3d98a-240">符合這些規則的物件會進行同步處理，其他所有物件則會予以忽略。</span><span class="sxs-lookup"><span data-stu-id="3d98a-240">Objects that satisfy these rules are synchronized while all other objects are ignored.</span></span> <span data-ttu-id="3d98a-241">以下是某些範例規則：</span><span class="sxs-lookup"><span data-stu-id="3d98a-241">Some example rules:</span></span>

* <span data-ttu-id="3d98a-242">使用者物件必須有唯一的 sourceAnchor 屬性，且必須填入 accountEnabled 屬性。</span><span class="sxs-lookup"><span data-stu-id="3d98a-242">User objects must have a unique *sourceAnchor* attribute and the *accountEnabled* attribute must be populated.</span></span>
* <span data-ttu-id="3d98a-243">使用者物件必須具有 sAMAccountName 屬性，且開頭的文字不可以是「Azure AD_」或「MSOL_」。</span><span class="sxs-lookup"><span data-stu-id="3d98a-243">User objects must have a *sAMAccountName* attribute and cannot start with the text *Azure AD_* or *MSOL_*.</span></span>

<span data-ttu-id="3d98a-244">Azure AD Connect 會對使用者、連絡人、群組、ForeignSecurityPrincipal 和電腦等物件套用數個規則。</span><span class="sxs-lookup"><span data-stu-id="3d98a-244">Azure AD Connect applies several rules to User, Contact, Group, ForeignSecurityPrincipal, and Computer objects.</span></span> <span data-ttu-id="3d98a-245">如果您需要修改一組預設規則，請使用隨 Azure AD Connect 一起安裝的同步處理規則編輯器。</span><span class="sxs-lookup"><span data-stu-id="3d98a-245">Use the Synchronization Rules Editor installed with Azure AD Connect if you need to modify the default set of rules.</span></span> <span data-ttu-id="3d98a-246">如需詳細資訊，請參閱 [Azure AD Connect 同步處理：了解預設組態][aad-connect-sync-default-rules]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-246">For more information, see [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules]).</span></span>

<span data-ttu-id="3d98a-247">您也可以定義您自己的篩選，以限制要依網域或 OU 同步處理的物件。</span><span class="sxs-lookup"><span data-stu-id="3d98a-247">You can also define your own filters to limit the objects to be synchronized by domain or OU.</span></span> <span data-ttu-id="3d98a-248">或者，您也可以實作更複雜的自訂篩選，例如 [Azure AD Connect 同步處理：設定篩選][aad-filtering]所述的篩選。</span><span class="sxs-lookup"><span data-stu-id="3d98a-248">Alternatively, you can implement more complex custom filtering such as that described in [Azure AD Connect sync: Configure Filtering][aad-filtering].</span></span>

### <a name="monitoring"></a><span data-ttu-id="3d98a-249">監視</span><span class="sxs-lookup"><span data-stu-id="3d98a-249">Monitoring</span></span> 

<span data-ttu-id="3d98a-250">下列安裝在內部部署環境的代理程式會執行健康情況監視：</span><span class="sxs-lookup"><span data-stu-id="3d98a-250">Health monitoring is performed by the following agents installed on-premises:</span></span>

* <span data-ttu-id="3d98a-251">Azure AD Connect 會安裝代理程式以擷取同步處理作業的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-251">Azure AD Connect installs an agent that captures information about synchronization operations.</span></span> <span data-ttu-id="3d98a-252">使用 Azure 入口網站中的 [Azure AD Connect Health] 刀鋒視窗，來監視其健康情況和效能。</span><span class="sxs-lookup"><span data-stu-id="3d98a-252">Use the Azure AD Connect Health blade in the Azure portal to monitor its health and performance.</span></span> <span data-ttu-id="3d98a-253">如需詳細資訊，請參閱[使用 Azure AD Connect Health 進行同步處理][aad-health]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-253">For more information, see [Using Azure AD Connect Health for sync][aad-health].</span></span>
* <span data-ttu-id="3d98a-254">若要從 Azure 監視 AD DS 網域和目錄的健康情況，請在位於內部部署網域內的機器上安裝 AD DS 代理程式的 Azure AD Connect Health。</span><span class="sxs-lookup"><span data-stu-id="3d98a-254">To monitor the health of the AD DS domains and directories from Azure, install the Azure AD Connect Health for AD DS agent on a machine within the on-premises domain.</span></span> <span data-ttu-id="3d98a-255">使用 Azure 入口網站中的 [Azure Active Directory Connect Health] 刀鋒視窗來監視健康情況。</span><span class="sxs-lookup"><span data-stu-id="3d98a-255">Use the Azure Active Directory Connect Health blade in the Azure portal for health monitoring.</span></span> <span data-ttu-id="3d98a-256">如需詳細資訊，請參閱[在 AD DS 使用 Azure AD Connect Health][aad-health-adds]</span><span class="sxs-lookup"><span data-stu-id="3d98a-256">For more information, see [Using Azure AD Connect Health with AD DS][aad-health-adds]</span></span> 
* <span data-ttu-id="3d98a-257">安裝 AD FS 代理程式的 Azure AD Connect Health 來監視於內部部署環境上執行之服務的健康情況，並使用 Azure 入口網站中的 [Azure Active Directory Connect Health] 刀鋒視窗來監視 AD FS。</span><span class="sxs-lookup"><span data-stu-id="3d98a-257">Install the Azure AD Connect Health for AD FS agent to monitor the health of services running on on-premises, and use the Azure Active Directory Connect Health blade in the Azure portal to monitor AD FS.</span></span> <span data-ttu-id="3d98a-258">如需詳細資訊，請參閱[在 AD FS 使用 Azure AD Connect Health][aad-health-adfs]</span><span class="sxs-lookup"><span data-stu-id="3d98a-258">For more information, see [Using Azure AD Connect Health with AD FS][aad-health-adfs]</span></span>

<span data-ttu-id="3d98a-259">如需安裝 AD Connect Health 代理程式和其需求的詳細資訊，請參閱 [Azure AD Connect Health 代理程式安裝][aad-agent-installation]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-259">For more information on installing the AD Connect Health agents and their requirements, see [Azure AD Connect Health Agent Installation][aad-agent-installation].</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="3d98a-260">延展性考量</span><span class="sxs-lookup"><span data-stu-id="3d98a-260">Scalability considerations</span></span>

<span data-ttu-id="3d98a-261">Azure AD 服務會根據複本支援延展性，其具有單一主要複本可處理寫入作業，以及多個次要的唯讀複本。</span><span class="sxs-lookup"><span data-stu-id="3d98a-261">The Azure AD service supports scalability based on replicas, with a single primary replica that handles write operations plus multiple read-only secondary replicas.</span></span> <span data-ttu-id="3d98a-262">Azure AD 會明確地將針對次要複本所嘗試的寫入，重新導向至主要複本，並提供最終一致性。</span><span class="sxs-lookup"><span data-stu-id="3d98a-262">Azure AD transparently redirects attempted writes made against secondary replicas to the primary replica and provides eventual consistency.</span></span> <span data-ttu-id="3d98a-263">針對主要複本進行的所有變更都會傳播到次要複本。</span><span class="sxs-lookup"><span data-stu-id="3d98a-263">All changes made to the primary replica are propagated to the secondary replicas.</span></span> <span data-ttu-id="3d98a-264">此架構可順暢調整，因為針對 Azure AD 進行的大多數作業都是讀取，而不是寫入。</span><span class="sxs-lookup"><span data-stu-id="3d98a-264">This architecture scales well because most operations against Azure AD are reads rather than writes.</span></span> <span data-ttu-id="3d98a-265">如需詳細資訊，請參閱 [Azure AD：異地備援、高可用性、分散式雲端目錄的幕後][aad-scalability]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-265">For more information, see [Azure AD: Under the hood of our geo-redundant, highly available, distributed cloud directory][aad-scalability].</span></span>

<span data-ttu-id="3d98a-266">針對 Azure AD Connect 同步處理伺服器，請決定您可能要從本機目錄同步處理多少物件。</span><span class="sxs-lookup"><span data-stu-id="3d98a-266">For the Azure AD Connect sync server, determine how many objects you are likely to synchronize from your local directory.</span></span> <span data-ttu-id="3d98a-267">如果您的物件少於 100,000 個，您可以使用 Azure AD Connect 所提供的預設 SQL Server Express LocalDB 軟體。</span><span class="sxs-lookup"><span data-stu-id="3d98a-267">If you have less than 100,000 objects, you can use the default SQL Server Express LocalDB software provided with Azure AD Connect.</span></span> <span data-ttu-id="3d98a-268">如果您有大量物件，則應該安裝 SQL Server 的生產版本，並執行 Azure AD Connect 的自訂安裝，以指定其應該使用現有的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="3d98a-268">If you have a larger number of objects, you should install a production version of SQL Server and perform a custom installation of Azure AD Connect, specifying that it should use an existing instance of SQL Server.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="3d98a-269">可用性考量</span><span class="sxs-lookup"><span data-stu-id="3d98a-269">Availability considerations</span></span>

<span data-ttu-id="3d98a-270">Azure AD 服務會異地分散，並且會在分處世界各地的多個資料中心執行，並提供自動容錯移轉功能。</span><span class="sxs-lookup"><span data-stu-id="3d98a-270">The Azure AD service is geo-distributed and runs in multiple data centers spread around the world with automated failover.</span></span> <span data-ttu-id="3d98a-271">如果資料中心變得無法使用，Azure AD 會確保您的目錄資料可在至少兩個以上分散各區域的資料中心內供執行個體存取。</span><span class="sxs-lookup"><span data-stu-id="3d98a-271">If a data center becomes unavailable, Azure AD ensures that your directory data is available for instance access in at least two more regionally dispersed data centers.</span></span>

> [!NOTE]
> <span data-ttu-id="3d98a-272">Azure AD Basic 和 Premium 服務的服務等級協定 (SLA) 會保證至少 99.9% 的可用性。</span><span class="sxs-lookup"><span data-stu-id="3d98a-272">The service level agreement (SLA) for Azure AD Basic and Premium services guarantees at least 99.9% availability.</span></span> <span data-ttu-id="3d98a-273">Azure AD 免費層則沒有 SLA。</span><span class="sxs-lookup"><span data-stu-id="3d98a-273">There is no SLA for the Free tier of Azure AD.</span></span> <span data-ttu-id="3d98a-274">如需詳細資訊，請參閱 [Azure Active Directory 的 SLA][sla-aad]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-274">For more information, see [SLA for Azure Active Directory][sla-aad].</span></span>
> 
> 

<span data-ttu-id="3d98a-275">請考慮以預備模式佈建 Azure AD Connect 同步處理伺服器的第二個執行個體以提高可用性，如＜拓撲建議＞一節所述。</span><span class="sxs-lookup"><span data-stu-id="3d98a-275">Consider provisioning a second instance of Azure AD Connect sync server in staging mode to increase availability, as discussed in the topology recommendations section.</span></span> 

<span data-ttu-id="3d98a-276">如果您未使用 Azure AD Connect 隨附的 SQL Server Express LocalDB 執行個體，請考慮使用 SQL 叢集以實現高可用性。</span><span class="sxs-lookup"><span data-stu-id="3d98a-276">If you are not using the SQL Server Express LocalDB instance that comes with Azure AD Connect, consider using SQL clustering to achieve high availability.</span></span> <span data-ttu-id="3d98a-277">Azure AD Connect 不支援鏡像和 Always On 之類的解決方案。</span><span class="sxs-lookup"><span data-stu-id="3d98a-277">Solutions such as mirroring and Always On are not supported by Azure AD Connect.</span></span>

<span data-ttu-id="3d98a-278">如需實現 Azure AD Connect 同步處理伺服器高可用性的其他考量，以及要了解如何在失敗後復原，請參閱 [Azure AD Connect 同步處理：作業工作和考量 - 災害復原][aad-sync-disaster-recovery]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-278">For additional considerations about achieving high availability of the Azure AD Connect sync server and also how to recover after a failure, see [Azure AD Connect sync: Operational tasks and considerations - Disaster Recovery][aad-sync-disaster-recovery].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="3d98a-279">管理性考量</span><span class="sxs-lookup"><span data-stu-id="3d98a-279">Manageability considerations</span></span>

<span data-ttu-id="3d98a-280">Azure AD 的管理有兩個層面：</span><span class="sxs-lookup"><span data-stu-id="3d98a-280">There are two aspects to managing Azure AD:</span></span>

* <span data-ttu-id="3d98a-281">管理雲端中的 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="3d98a-281">Administering Azure AD in the cloud.</span></span>
* <span data-ttu-id="3d98a-282">維護 Azure AD Connect 同步處理伺服器。</span><span class="sxs-lookup"><span data-stu-id="3d98a-282">Maintaining the Azure AD Connect sync servers.</span></span>

<span data-ttu-id="3d98a-283">Azure AD 提供了下列選項供您管理雲端中的網域和目錄：</span><span class="sxs-lookup"><span data-stu-id="3d98a-283">Azure AD provides the following options for managing domains and directories in the cloud:</span></span> 

* <span data-ttu-id="3d98a-284">**Azure Active Directory PowerShell 模組**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-284">**Azure Active Directory PowerShell Module**.</span></span> <span data-ttu-id="3d98a-285">如果您需要為常見的 Azure AD 管理工作 (例如，使用者管理、網域管理和設定單一登入) 編寫指令碼，請使用此[模組][aad-powershell]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-285">Use this [module][aad-powershell] if you need to script common Azure AD administrative tasks such as user management, domain management, and configuring single sign-on.</span></span>
* <span data-ttu-id="3d98a-286">**Azure 入口網站中的 [Azure AD 管理] 刀鋒視窗**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-286">**Azure AD management blade in the Azure portal**.</span></span> <span data-ttu-id="3d98a-287">此刀鋒視窗會提供互動式的目錄管理檢視，可讓您控制及設定 Azure AD 的大多數層面。</span><span class="sxs-lookup"><span data-stu-id="3d98a-287">This blade provides an interactive management view of the directory, and enables you to control and configure most aspects of Azure AD.</span></span> 

<span data-ttu-id="3d98a-288">Azure AD Connect 會安裝下列工具，以從您的內部部署機器維護 Azure AD Connect 同步處理服務：</span><span class="sxs-lookup"><span data-stu-id="3d98a-288">Azure AD Connect installs the following tools to maintain Azure AD Connect sync services from your on-premises machines:</span></span>
  
* <span data-ttu-id="3d98a-289">**Microsoft Azure Active Directory Connect 主控台**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-289">**Microsoft Azure Active Directory Connect console**.</span></span> <span data-ttu-id="3d98a-290">此工具可讓您修改 Azure AD 同步處理伺服器的組態、自訂進行同步處理的方式、啟用或停用預備模式，以及切換使用者登入模式。</span><span class="sxs-lookup"><span data-stu-id="3d98a-290">This tool enables you to modify the configuration of the Azure AD Sync server, customize how synchronization occurs, enable or disable staging mode, and switch the user sign-in mode.</span></span> <span data-ttu-id="3d98a-291">請注意，您可以使用您的內部部署基礎結構來啟用 Active Directory FS 登入。</span><span class="sxs-lookup"><span data-stu-id="3d98a-291">Note that you can enable Active Directory FS sign-in using your on-premises infrastructure.</span></span>
* <span data-ttu-id="3d98a-292">**同步處理服務管理員**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-292">**Synchronization Service Manager**.</span></span> <span data-ttu-id="3d98a-293">使用此工具中的 [作業] 索引標籤來管理同步處理程序，以及偵測處理程序是否有任何部分失敗。</span><span class="sxs-lookup"><span data-stu-id="3d98a-293">Use the *Operations* tab in this tool to manage the synchronization process and detect whether any parts of the process have failed.</span></span> <span data-ttu-id="3d98a-294">您可以使用此工具來手動觸發同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d98a-294">You can trigger synchronizations manually using this tool.</span></span> <span data-ttu-id="3d98a-295">[連接器] 索引標籤可讓您控制同步處理引擎所連結之網域的連線。</span><span class="sxs-lookup"><span data-stu-id="3d98a-295">The *Connectors* tab enables you to control the connections for the domains that the synchronization engine is attached to.</span></span>
* <span data-ttu-id="3d98a-296">**同步處理規則編輯器**。</span><span class="sxs-lookup"><span data-stu-id="3d98a-296">**Synchronization Rules Editor**.</span></span> <span data-ttu-id="3d98a-297">使用此工具來自訂物件於內部部署目錄和 Azure AD 之間進行複製時的轉換方式。</span><span class="sxs-lookup"><span data-stu-id="3d98a-297">Use this tool to customize the way objects are transformed when they are copied between an on-premises directory and Azure AD.</span></span> <span data-ttu-id="3d98a-298">此工具可讓您指定同步處理的其他屬性及物件，然後執行篩選以判斷哪些物件應該或不應該同步處理。</span><span class="sxs-lookup"><span data-stu-id="3d98a-298">This tool enables you to specify additional attributes and objects for synchronization, then executes filters to determine which objects should or should not be synchronized.</span></span> <span data-ttu-id="3d98a-299">如需詳細資訊，請參閱 [Azure AD Connect 同步處理：了解預設組態][aad-connect-sync-default-rules]文件中的＜同步處理規則編輯器＞一節。</span><span class="sxs-lookup"><span data-stu-id="3d98a-299">For more information, see the Synchronization Rule Editor section in the document [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules].</span></span>

<span data-ttu-id="3d98a-300">如需管理 Azure AD Connect 的詳細資訊和秘訣，請參閱 [Azure AD Connect 同步處理：變更預設組態的最佳做法][aad-sync-best-practices]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-300">For more information and tips for managing Azure AD Connect, see [Azure AD Connect sync: Best practices for changing the default configuration][aad-sync-best-practices].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="3d98a-301">安全性考量</span><span class="sxs-lookup"><span data-stu-id="3d98a-301">Security considerations</span></span>

<span data-ttu-id="3d98a-302">使用條件式存取控制來拒絕非預期來源所提出的驗證要求：</span><span class="sxs-lookup"><span data-stu-id="3d98a-302">Use conditional access control to deny authentication requests from unexpected sources:</span></span>

- <span data-ttu-id="3d98a-303">如果使用者嘗試從非受信任的位置 (例如經過網際網路而不是受信任的網路) 連線，則觸發 [Azure Multi-Factor Authentication (MFA)][azure-multifactor-authentication]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-303">Trigger [Azure Multi-Factor Authentication (MFA)][azure-multifactor-authentication] if a user attempts to connect from a nontrusted location such as across the Internet instead of a trusted network.</span></span>

- <span data-ttu-id="3d98a-304">使用使用者的裝置平台類型 (iOS、Android、Windows Mobile、Windows) 來判斷應用程式和功能的存取原則。</span><span class="sxs-lookup"><span data-stu-id="3d98a-304">Use the device platform type of the user (iOS, Android, Windows Mobile, Windows) to determine access policy to applications and features.</span></span>

- <span data-ttu-id="3d98a-305">記錄使用者裝置的啟用/停用狀態，並將這項資訊合併到存取原則檢查。</span><span class="sxs-lookup"><span data-stu-id="3d98a-305">Record the enabled/disabled state of users' devices, and incorporate this information into the access policy checks.</span></span> <span data-ttu-id="3d98a-306">例如，如果使用者的電話遺失或遭竊，則應該將它記錄為停用，以防止有人使用它獲得存取權。</span><span class="sxs-lookup"><span data-stu-id="3d98a-306">For example, if a user's phone is lost or stolen it should be recorded as disabled to prevent it from being used to gain access.</span></span>

- <span data-ttu-id="3d98a-307">根據群組成員資格來控制使用者的資源存取權。</span><span class="sxs-lookup"><span data-stu-id="3d98a-307">Control user access to resources based on group membership.</span></span> <span data-ttu-id="3d98a-308">使用 [Azure AD 動態成員資格規則][aad-dynamic-membership-rules] 來簡化群組管理。</span><span class="sxs-lookup"><span data-stu-id="3d98a-308">Use [Azure AD dynamic membership rules][aad-dynamic-membership-rules] to simplify group administration.</span></span> <span data-ttu-id="3d98a-309">如需其運作方式的簡短概觀，請參閱[群組動態成員資格簡介][aad-dynamic-memberships]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-309">For a brief overview of how this works, see [Introduction to Dynamic Memberships for Groups][aad-dynamic-memberships].</span></span>

- <span data-ttu-id="3d98a-310">使用條件式存取風險原則與 Azure AD Identity Protection，以根據異常登入活動或其他事件來提供進階保護。</span><span class="sxs-lookup"><span data-stu-id="3d98a-310">Use conditional access risk policies with Azure AD Identity Protection to provide advanced protection based on unusual sign-in activities or other events.</span></span>

<span data-ttu-id="3d98a-311">如需詳細資訊，請參閱 [Azure Active Directory 條件式存取][aad-conditional-access]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-311">For more information, see [Azure Active Directory conditional access][aad-conditional-access].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="3d98a-312">部署解決方案</span><span class="sxs-lookup"><span data-stu-id="3d98a-312">Deploy the solution</span></span>

<span data-ttu-id="3d98a-313">GitHub 中有實作這些建議和考量的參考架構部署。</span><span class="sxs-lookup"><span data-stu-id="3d98a-313">A deployment for a reference architecture that implements these recommendations and considerations is available on GitHub.</span></span> <span data-ttu-id="3d98a-314">此參考架構會在 Azure 中部署模擬的內部部署網路，供您進行測試和實驗。</span><span class="sxs-lookup"><span data-stu-id="3d98a-314">This reference architecture deploys a simulated on-premises network in Azure that you can use to test and experiment.</span></span> <span data-ttu-id="3d98a-315">您可以使用 Windows 或 Linux VM 部署此參考架構，請遵循下列指示：</span><span class="sxs-lookup"><span data-stu-id="3d98a-315">The reference architecture can be deployed with either with Windows or Linux VMs by following the directions below:</span></span> 

1. <span data-ttu-id="3d98a-316">按一下下方的按鈕：</span><span class="sxs-lookup"><span data-stu-id="3d98a-316">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fidentity%2Fazure-ad%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>
2. <span data-ttu-id="3d98a-317">一旦連結已在 Azure 入口網站中開啟，您必須輸入部分設定的值：</span><span class="sxs-lookup"><span data-stu-id="3d98a-317">Once the link has opened in the Azure portal, you must enter values for some of the settings:</span></span> 
   * <span data-ttu-id="3d98a-318">**資源群組**名稱已在參數檔案中定義，因此請在文字方塊中選取 [新建] 並輸入 `ra-aad-onpremise-rg`。</span><span class="sxs-lookup"><span data-stu-id="3d98a-318">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-aad-onpremise-rg` in the text box.</span></span>
   * <span data-ttu-id="3d98a-319">從 [位置] 下拉式方塊選取區域。</span><span class="sxs-lookup"><span data-stu-id="3d98a-319">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="3d98a-320">請勿編輯 [範本的根 URI] 或 [參數根 URI] 文字方塊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-320">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="3d98a-321">在 [作業系統類型] 下拉式方塊中選取 [Windows] 或 [Linux]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-321">Select **windows** or **linux** in the **Os Type** the drop down box.</span></span>
   * <span data-ttu-id="3d98a-322">檢閱條款和條件，然後按一下 [我同意上方所述的條款及條件] 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="3d98a-322">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="3d98a-323">按一下 [購買] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="3d98a-323">Click the **Purchase** button.</span></span>
3. <span data-ttu-id="3d98a-324">等待部署完成。</span><span class="sxs-lookup"><span data-stu-id="3d98a-324">Wait for the deployment to complete.</span></span>
4. <span data-ttu-id="3d98a-325">參數檔包含硬式編碼的系統管理員使用者名稱和密碼，強烈建議您立即在所有 VM 上變更這兩者。</span><span class="sxs-lookup"><span data-stu-id="3d98a-325">The parameter files include a hard-coded administrator user names and passwords, and it is strongly recommended that you immediately change both on all the VMs.</span></span> <span data-ttu-id="3d98a-326">按一下 Azure 入口網站中的每個 VM，然後按一下 [支援與疑難排解] 刀鋒視窗中的 [重設密碼]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-326">Click each VM in the Azure Portal then click on **Reset password** in the **Support + troubleshooting** blade.</span></span> <span data-ttu-id="3d98a-327">選取 [模式] 下拉式清單方塊中的 [重設密碼]，然後選取新的[使用者名稱] 和 [密碼]。</span><span class="sxs-lookup"><span data-stu-id="3d98a-327">Select **Reset password** in the **Mode** drop down box, then select a new **User name** and **Password**.</span></span> <span data-ttu-id="3d98a-328">按一下 [更新] 按鈕，保存新的使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="3d98a-328">Click the **Update** button to persist the new user name and password.</span></span>

<!-- links -->

[implementing-a-multi-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[aad-agent-installation]: /azure/active-directory/active-directory-aadconnect-health-agent-install
[aad-application-proxy]: /azure/active-directory/active-directory-application-proxy-enable
[aad-conditional-access]: /azure/active-directory//active-directory-conditional-access
[aad-connect-sync-default-rules]: /azure/active-directory/hybrid/concept-azure-ad-connect-sync-default-configuration
[aad-connect-sync-operational-tasks]: /azure/active-directory/hybrid/how-to-connect-sync-operations
[aad-dynamic-memberships]: https://youtu.be/Tdiz2JqCl9Q
[aad-dynamic-membership-rules]: /azure/active-directory/active-directory-accessmanagement-groups-with-advanced-rules
[aad-editions]: /azure/active-directory/active-directory-editions
[aad-filtering]: /azure/active-directory/hybrid/how-to-connect-sync-configure-filtering
[aad-health]: /azure/active-directory/active-directory-aadconnect-health-sync
[aad-health-adds]: /azure/active-directory/active-directory-aadconnect-health-adds
[aad-health-adfs]: /azure/active-directory/active-directory-aadconnect-health-adfs
[aad-identity-protection]: /azure/active-directory/active-directory-identityprotection
[aad-password-management]: /azure/active-directory/active-directory-passwords-customize
[aad-powershell]: https://msdn.microsoft.com/library/azure/mt757189.aspx
[aad-reporting-guide]: /azure/active-directory/active-directory-reporting-guide
[aad-scalability]: https://blogs.technet.microsoft.com/enterprisemobility/2014/09/02/azure-ad-under-the-hood-of-our-geo-redundant-highly-available-distributed-cloud-directory/
[aad-sync-best-practices]: /azure/active-directory/hybrid/how-to-connect-sync-best-practices-changing-default-configuration
[aad-sync-disaster-recovery]: /azure/active-directory/hybrid/how-to-connect-sync-operations#disaster-recovery
[aad-sync-requirements]: /azure/active-directory/active-directory-hybrid-identity-design-considerations-directory-sync-requirements
[aad-topologies]: /azure/active-directory/hybrid/plan-connect-topologies
[aad-user-sign-in]: /azure/active-directory/hybrid/plan-connect-user-signin
[azure-active-directory]: /azure/active-directory-domain-services/active-directory-ds-overview
[azure-ad-connect]: /azure/active-directory/hybrid/whatis-hybrid-identity
[azure-multifactor-authentication]: /azure/multi-factor-authentication/multi-factor-authentication
[considerations]: ./considerations.md
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[sla-aad]: https://azure.microsoft.com/support/legal/sla/active-directory/v1_0/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx


[0]: ./images/azure-ad.png "使用 Azure Active Directory 的雲端身分識別架構"
