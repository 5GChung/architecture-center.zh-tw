---
title: "可用性檢查清單"
description: "提供設計期間可用性考量指引的檢查清單。"
author: dragon119
ms.date: 03/24/2017
ms.custom: checklist
ms.openlocfilehash: 14e6cd6f25f613ea9793b5cf6c4f1abe6f405b74
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/14/2017
---
# <a name="availability-checklist"></a><span data-ttu-id="3b799-103">可用性檢查清單</span><span class="sxs-lookup"><span data-stu-id="3b799-103">Availability checklist</span></span>
[!INCLUDE [header](../_includes/header.md)]

## <a name="application-design"></a><span data-ttu-id="3b799-104">應用程式設計</span><span class="sxs-lookup"><span data-stu-id="3b799-104">Application design</span></span>
* <span data-ttu-id="3b799-105">**請避免單一失敗點。**</span><span class="sxs-lookup"><span data-stu-id="3b799-105">**Avoid any single point of failure.**</span></span> <span data-ttu-id="3b799-106">為避免單一失敗點影響可用性，應該將所有的元件、服務、資源和計算執行個體部署為多個執行個體。</span><span class="sxs-lookup"><span data-stu-id="3b799-106">All components, services, resources, and compute instances should be deployed as multiple instances to prevent a single point of failure from affecting availability.</span></span> <span data-ttu-id="3b799-107">這包括驗證機制。</span><span class="sxs-lookup"><span data-stu-id="3b799-107">This includes authentication mechanisms.</span></span> <span data-ttu-id="3b799-108">將應用程式設計為可以設定使用多個執行個體，自動偵測失敗，並將要求重新導向至非失敗的執行個體 (平台並不會在其中自動執行此動作)。</span><span class="sxs-lookup"><span data-stu-id="3b799-108">Design the application to be configurable to use multiple instances, and to automatically detect failures and redirect requests to non-failed instances where the platform does not do this automatically.</span></span>
* <span data-ttu-id="3b799-109">**分解每個不同服務等級協定的工作負載。**</span><span class="sxs-lookup"><span data-stu-id="3b799-109">**Decompose workload per different service-level agreement.**</span></span> <span data-ttu-id="3b799-110">如果服務由重要和比較不重要的工作負載組成，請以不同的方式加以管理，並指定服務功能及執行個體數目，以符合其可用性需求。</span><span class="sxs-lookup"><span data-stu-id="3b799-110">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances to meet their availability requirements.</span></span>
* <span data-ttu-id="3b799-111">**最小化和了解服務相依性。**</span><span class="sxs-lookup"><span data-stu-id="3b799-111">**Minimize and understand service dependencies.**</span></span> <span data-ttu-id="3b799-112">盡可能將使用過的不同服務數目降到最低，並確定您了解所有存在於系統中的功能和服務相依性。</span><span class="sxs-lookup"><span data-stu-id="3b799-112">Minimize the number of different services used where possible, and ensure you understand all of the feature and service dependencies that exist in the system.</span></span> <span data-ttu-id="3b799-113">這包括這些相依性的本質、失敗的影響，或整體應用程式上每個服務減少的效能。</span><span class="sxs-lookup"><span data-stu-id="3b799-113">This includes the nature of these dependencies, and the impact of failure or reduced performance in each one on the overall application.</span></span> <span data-ttu-id="3b799-114">Microsoft 保證大部分的服務都會有至少 99.9% 的可用性，但這表示應用程式依賴的每個其他服務可能會降低 0.1% 的系統整體可用性 SLA。</span><span class="sxs-lookup"><span data-stu-id="3b799-114">Microsoft guarantees at least 99.9 percent availability for most services, but this means that every additional service an application relies on potentially reduces the overall availability SLA of your system by 0.1 percent.</span></span>
* <span data-ttu-id="3b799-115">**盡可能將工作和訊息設計為等冪 (可放心重複)**，以便重複的要求不會造成問題。</span><span class="sxs-lookup"><span data-stu-id="3b799-115">**Design tasks and messages to be idempotent (safely repeatable) where possible**, so that duplicated requests will not cause problems.</span></span> <span data-ttu-id="3b799-116">例如，服務可以做為處理訊息的取用者，這些訊息由系統中做為生產者的其他部分傳送為要求。</span><span class="sxs-lookup"><span data-stu-id="3b799-116">For example, a service can act as a consumer that handles messages sent as requests by other parts of the system that act as producers.</span></span> <span data-ttu-id="3b799-117">如果取用者在處理訊息之後，在確認訊息已處理過之前失敗，生產者可能會提交重複要求，由取用者的另一個執行個體處理。</span><span class="sxs-lookup"><span data-stu-id="3b799-117">If the consumer fails after processing the message, but before acknowledging that it has been processed, a producer might submit a repeat request which could be handled by another instance of the consumer.</span></span> <span data-ttu-id="3b799-118">基於這個理由，取用者與它們執行的作業應該具有等冪性，以便重複先前執行的作業不會使結果無效。</span><span class="sxs-lookup"><span data-stu-id="3b799-118">For this reason, consumers and the operations they carry out should be idempotent so that repeating a previously executed operation does not render the results invalid.</span></span> <span data-ttu-id="3b799-119">這可能表示偵測重複訊息，或是使用開放式的方法來處理衝突，以確保一致性。</span><span class="sxs-lookup"><span data-stu-id="3b799-119">This may mean detecting duplicated messages, or ensuring consistency by using an optimistic approach to handling conflicts.</span></span>
* <span data-ttu-id="3b799-120">**使用可實作重要交易之高可用性的訊息代理人。**</span><span class="sxs-lookup"><span data-stu-id="3b799-120">**Use a message broker that implements high availability for critical transactions.**</span></span> <span data-ttu-id="3b799-121">起始工作或存取遠端服務的許多案例都使用傳訊在應用程式和目標服務之間傳遞指示。</span><span class="sxs-lookup"><span data-stu-id="3b799-121">Many scenarios for initiating tasks or accessing remote services use messaging to pass instructions between the application and the target service.</span></span> <span data-ttu-id="3b799-122">為了達到最佳效能，應用程式應該能夠傳送訊息，然後返回處理更多的要求，而不需要等待回覆。</span><span class="sxs-lookup"><span data-stu-id="3b799-122">For best performance, the application should be able to send the message and then return to process more requests, without needing to wait for a reply.</span></span> <span data-ttu-id="3b799-123">若要保證訊息的傳遞，傳訊系統應該提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="3b799-123">To guarantee delivery of messages, the messaging system should provide high availability.</span></span> <span data-ttu-id="3b799-124">Azure 服務匯流排訊息佇列會實作「至少一次」語意。</span><span class="sxs-lookup"><span data-stu-id="3b799-124">Azure Service Bus message queues implement *at least once* semantics.</span></span> <span data-ttu-id="3b799-125">這表示雖然可能在某些情況下傳送複本，張貼到佇列的每個訊息都不會遺失。</span><span class="sxs-lookup"><span data-stu-id="3b799-125">This means that each message posted to a queue will not be lost, although duplicate copies may be delivered under certain circumstances.</span></span> <span data-ttu-id="3b799-126">如果訊息處理是等冪 (請參閱上一個項目)，重複傳遞應該不是問題。</span><span class="sxs-lookup"><span data-stu-id="3b799-126">If message processing is idempotent (see the previous item), repeated delivery should not be a problem.</span></span>
* <span data-ttu-id="3b799-127">**設計適當降級的應用程式** ，並採取適當動作將對使用者的影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="3b799-127">**Design applications to gracefully degrade** when reaching resource limits, and take appropriate action to minimize the impact for the user.</span></span> <span data-ttu-id="3b799-128">在某些情況下，應用程式上的負載可能會超出其中一或多個組件的容量，導致降低可用性和失敗的連線。</span><span class="sxs-lookup"><span data-stu-id="3b799-128">In some cases, the load on the application may exceed the capacity of one or more parts, causing reduced availability and failed connections.</span></span> <span data-ttu-id="3b799-129">縮放比例有助於減輕這點，但是它可能會到達資源可用性或成本等其他因素所加諸的限制。</span><span class="sxs-lookup"><span data-stu-id="3b799-129">Scaling can help to alleviate this, but it may reach a limit imposed by other factors, such as resource availability or cost.</span></span> <span data-ttu-id="3b799-130">設計應用程式，以便在此情況下，它可以自動適當降級。</span><span class="sxs-lookup"><span data-stu-id="3b799-130">Design the application so that, in this situation, it can automatically degrade gracefully.</span></span> <span data-ttu-id="3b799-131">例如，在電子商務系統中，如果訂單處理子系統處於疲勞狀態 (或甚至完全失敗)，可以暫時將其停用，同時允許其他功能 (例如瀏覽產品目錄) 繼續運作。</span><span class="sxs-lookup"><span data-stu-id="3b799-131">For example, in an ecommerce system, if the order-processing subsystem is under strain (or has even failed completely), it can be temporarily disabled while allowing other functionality (such as browsing the product catalog) to continue.</span></span> <span data-ttu-id="3b799-132">適當作法是延後對失敗子系統的要求，例如讓客戶可以提交訂單，但是將訂單儲存以供訂單子系統稍後再次可用時加以處理。</span><span class="sxs-lookup"><span data-stu-id="3b799-132">It might be appropriate to postpone requests to a failing subsystem, for example still enabling customers to submit orders but saving them for later processing, when the orders subsystem is available again.</span></span>
* <span data-ttu-id="3b799-133">**適當處理急促高載事件。**</span><span class="sxs-lookup"><span data-stu-id="3b799-133">**Gracefully handle rapid burst events.**</span></span> <span data-ttu-id="3b799-134">大部分的應用程式會在不同時間處理不同的工作負載，例如在早上的商務應用程式中，或在電子商務網站中發行新產品時處理第一件事的尖峰。</span><span class="sxs-lookup"><span data-stu-id="3b799-134">Most applications need to handle varying workloads over time, such as peaks first thing in the morning in a business application or when a new product is released in an ecommerce site.</span></span> <span data-ttu-id="3b799-135">自動調整有助於處理負載，但是它可能需要一些時間，讓其他執行個體上線並處理要求。</span><span class="sxs-lookup"><span data-stu-id="3b799-135">Auto-scaling can help to handle the load, but it may take some time for additional instances to come online and handle requests.</span></span> <span data-ttu-id="3b799-136">防止突然和非預期的活動高載導致超出應用程式的處理能力：將應用程式設計為將要求加入其使用之服務的佇列，並在佇列接近完整容量時適當降級。</span><span class="sxs-lookup"><span data-stu-id="3b799-136">Prevent sudden and unexpected bursts of activity from overwhelming the application: design it to queue requests to the services it uses and degrade gracefully when queues are near to full capacity.</span></span> <span data-ttu-id="3b799-137">請確定有足夠的效能和容量可供非高載條件清空佇列和處理未完成的要求。</span><span class="sxs-lookup"><span data-stu-id="3b799-137">Ensure that there is sufficient performance and capacity available under non-burst conditions to drain the queues and handle outstanding requests.</span></span> <span data-ttu-id="3b799-138">如需詳細資訊，請參閱 [佇列型負載調節模式](https://msdn.microsoft.com/library/dn589783.aspx)。</span><span class="sxs-lookup"><span data-stu-id="3b799-138">For more information, see the [Queue-Based Load Leveling Pattern](https://msdn.microsoft.com/library/dn589783.aspx).</span></span>

## <a name="deployment-and-maintenance"></a><span data-ttu-id="3b799-139">部署和維護</span><span class="sxs-lookup"><span data-stu-id="3b799-139">Deployment and maintenance</span></span>
* <span data-ttu-id="3b799-140">**為每個服務部署角色的多個執行個體**。</span><span class="sxs-lookup"><span data-stu-id="3b799-140">**Deploy multiple instances of roles for each service.**</span></span> <span data-ttu-id="3b799-141">Microsoft 提供您所建立與部署之服務的可用性保證，但這些保證的有效前提是您必須在服務中為每個角色部署至少兩個執行個體。</span><span class="sxs-lookup"><span data-stu-id="3b799-141">Microsoft makes availability guarantees for services that you create and deploy, but these guarantees are only valid if you deploy at least two instances of each role in the service.</span></span> <span data-ttu-id="3b799-142">這可讓其中一個角色無法使用，但其他角色仍在作用中。</span><span class="sxs-lookup"><span data-stu-id="3b799-142">This enables one role to be unavailable while the other remains active.</span></span> <span data-ttu-id="3b799-143">如果您必須將更新部署到即時系統，而不要中斷用戶端的活動，這點特別重要。執行個體可以個別中斷和升級，而其他執行個體則維持線上狀態。</span><span class="sxs-lookup"><span data-stu-id="3b799-143">This is especially important if you need to deploy updates to a live system without interrupting clients' activities; instances can be taken down and upgraded individually while the others continue online.</span></span>
* <span data-ttu-id="3b799-144">**在多個資料中心裝載應用程式。**</span><span class="sxs-lookup"><span data-stu-id="3b799-144">**Host applications in multiple datacenters.**</span></span> <span data-ttu-id="3b799-145">雖然非常不可能，但是整個資料中心還是可能因為天然災害或網際網路失敗等事件而離線。</span><span class="sxs-lookup"><span data-stu-id="3b799-145">Although extremely unlikely, it is possible for an entire datacenter to go offline through an event such as a natural disaster or Internet failure.</span></span> <span data-ttu-id="3b799-146">重要的商務應用程式應該裝載在多個資料中心，以提供最大的可用性。</span><span class="sxs-lookup"><span data-stu-id="3b799-146">Vital business applications should be hosted in more than one datacenter to provide maximum availability.</span></span> <span data-ttu-id="3b799-147">這樣也可以減少本機使用者的延遲，並在更新應用程式時提供彈性的其他機會。</span><span class="sxs-lookup"><span data-stu-id="3b799-147">This can also reduce latency for local users, and provide additional opportunities for flexibility when updating applications.</span></span>
* <span data-ttu-id="3b799-148">**自動化和測試部署和維護工作**。</span><span class="sxs-lookup"><span data-stu-id="3b799-148">**Automate and test deployment and maintenance tasks.**</span></span> <span data-ttu-id="3b799-149">分散式應用程式由多個必須相互合作的部分所組成。</span><span class="sxs-lookup"><span data-stu-id="3b799-149">Distributed applications consist of multiple parts that must work together.</span></span> <span data-ttu-id="3b799-150">因此，部署應該使用經過測試和實證的機制 (例如指令碼和部署應用程式) 自動化。</span><span class="sxs-lookup"><span data-stu-id="3b799-150">Deployment should therefore be automated, using tested and proven mechanisms such as scripts and deployment applications.</span></span> <span data-ttu-id="3b799-151">它們可以更新和驗證組態，並自動化部署程序。</span><span class="sxs-lookup"><span data-stu-id="3b799-151">These can update and validate configuration, and automate the deployment process.</span></span> <span data-ttu-id="3b799-152">自動化的技術也應該用來執行全部或部分應用程式的更新。</span><span class="sxs-lookup"><span data-stu-id="3b799-152">Automated techniques should also be used to perform updates of all or parts of applications.</span></span> <span data-ttu-id="3b799-153">請務必完整測試所有程序，以確保錯誤不會造成其他停機情況。</span><span class="sxs-lookup"><span data-stu-id="3b799-153">It is vital to test all of these processes fully to ensure that errors do not cause additional downtime.</span></span> <span data-ttu-id="3b799-154">所有的部署工具必須有適當的安全性限制，來保護已部署的應用程式。仔細定義和強制執行部署原則並將人為介入的需要降到最低。</span><span class="sxs-lookup"><span data-stu-id="3b799-154">All deployment tools must have suitable security restrictions to protect the deployed application; define and enforce deployment policies carefully and minimize the need for human intervention.</span></span>
* <span data-ttu-id="3b799-155">**請考慮使用平台的預備和生產功能** ，其中皆提供上述內容。</span><span class="sxs-lookup"><span data-stu-id="3b799-155">**Consider using staging and production features of the platform** where these are available.</span></span> <span data-ttu-id="3b799-156">例如，使用 Azure 雲端服務預備與生產環境可讓應用程式透過虛擬 IP 位址交換 (VIP 交換) 的方式立即彼此切換。</span><span class="sxs-lookup"><span data-stu-id="3b799-156">For example, using Azure Cloud Services staging and production environments allows applications to be switched from one to another instantly through a virtual IP address swap (VIP Swap).</span></span> <span data-ttu-id="3b799-157">不過，如果您想要暫置內部部署，或同時部署不同版本的應用程式，並逐漸移轉使用者，您可能無法使用 VIP 交換作業。</span><span class="sxs-lookup"><span data-stu-id="3b799-157">However, if you prefer to stage on-premises, or deploy different versions of the application concurrently and gradually migrate users, you may not be able to use a VIP Swap operation.</span></span>
* <span data-ttu-id="3b799-158">**套用組態變更，而盡可能不回收** 執行個體。</span><span class="sxs-lookup"><span data-stu-id="3b799-158">**Apply configuration changes without recycling** the instance when possible.</span></span> <span data-ttu-id="3b799-159">在許多情況下，您可以變更 Azure 應用程式或服務的組態設定，而不需要重新啟動角色。</span><span class="sxs-lookup"><span data-stu-id="3b799-159">In many cases, the configuration settings for an Azure application or service can be changed without requiring the role to be restarted.</span></span> <span data-ttu-id="3b799-160">角色會公開可以處理的事件以偵測組態變更，並將其套用至應用程式內的元件。</span><span class="sxs-lookup"><span data-stu-id="3b799-160">Role expose events that can be handled to detect configuration changes and apply them to components within the application.</span></span> <span data-ttu-id="3b799-161">不過，一些核心平台設定的變更的確需要重新啟動角色。</span><span class="sxs-lookup"><span data-stu-id="3b799-161">However, some changes to the core platform settings do require a role to be restarted.</span></span> <span data-ttu-id="3b799-162">建置元件和服務時，藉由將其設計為可接受組態設定的變更，而不需要重新啟動整個應用程式，即可最大化可用性，並將停機情況減至最少。</span><span class="sxs-lookup"><span data-stu-id="3b799-162">When building components and services, maximize availability and minimize downtime by designing them to accept changes to configuration settings without requiring the application as a whole to be restarted.</span></span>
* <span data-ttu-id="3b799-163">**使用升級網域以達成更新期間的零停機情況。**</span><span class="sxs-lookup"><span data-stu-id="3b799-163">**Use upgrade domains for zero downtime during updates.**</span></span> <span data-ttu-id="3b799-164">Azure 計算單位 (如 web 和背景工作角色) 會配置給升級網域。</span><span class="sxs-lookup"><span data-stu-id="3b799-164">Azure compute units such as web and worker roles are allocated to upgrade domains.</span></span> <span data-ttu-id="3b799-165">升級網域群組角色執行個體，這麼一來，在發生輪流更新時，升級網域中的每個角色都會輪流停止、更新並且重新啟動。</span><span class="sxs-lookup"><span data-stu-id="3b799-165">Upgrade domains group role instances together so that, when a rolling update takes place, each role in the upgrade domain is stopped, updated, and restarted in turn.</span></span> <span data-ttu-id="3b799-166">這樣可以將對應用程式可用性的影響降至最低。</span><span class="sxs-lookup"><span data-stu-id="3b799-166">This minimizes the impact on application availability.</span></span> <span data-ttu-id="3b799-167">您可以指定部署服務時，應該為服務建立幾個升級網域。</span><span class="sxs-lookup"><span data-stu-id="3b799-167">You can specify how many upgrade domains should be created for a service when the service is deployed.</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="3b799-168">角色也分布在容錯網域，每一個容錯網域在伺服器機架、電源和冷卻佈建等方面都是彼此獨立，以將失敗影響所有角色執行個體的機會降至最低。</span><span class="sxs-lookup"><span data-stu-id="3b799-168">Roles are also distributed across fault domains, each of which is reasonably independent from other fault domains in terms of server rack, power, and cooling provision, in order to minimize the chance of a failure affecting all role instances.</span></span> <span data-ttu-id="3b799-169">此分佈會自動發生，您無法控制它。</span><span class="sxs-lookup"><span data-stu-id="3b799-169">This distribution occurs automatically, and you cannot control it.</span></span>
  > 
  > 
* <span data-ttu-id="3b799-170">**設定 Azure 虛擬機器的可用性設定組。**</span><span class="sxs-lookup"><span data-stu-id="3b799-170">**Configure availability sets for Azure virtual machines.**</span></span> <span data-ttu-id="3b799-171">將兩個或多個虛擬機器放在同一個可用性設定組中，可保證這些虛擬機器不會部署至相同的容錯網域。</span><span class="sxs-lookup"><span data-stu-id="3b799-171">Placing two or more virtual machines in the same availability set guarantees that these virtual machines will not be deployed to the same fault domain.</span></span> <span data-ttu-id="3b799-172">若要最大化可用性，您應該為系統使用的每個重要虛擬機器建立多個執行個體，並將這些執行個體放在相同的可用性設定組中。</span><span class="sxs-lookup"><span data-stu-id="3b799-172">To maximize availability, you should create multiple instances of each critical virtual machine used by your system and place these instances in the same availability set.</span></span> <span data-ttu-id="3b799-173">如果您正在執行多個具有不同服務用途的虛擬機器，請為每個虛擬機器建立可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="3b799-173">If you are running multiple virtual machines that serve different purposes, create an availability set for each virtual machine.</span></span> <span data-ttu-id="3b799-174">將每個虛擬機器的執行個體加入至每個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="3b799-174">Add instances of each virtual machine to each availability set.</span></span> <span data-ttu-id="3b799-175">例如，如果您已經建立個別的虛擬機器，以做為 web 伺服器和報表伺服器，請為 web 伺服器建立一個可用性設定組，並為報表伺服器建立另一個可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="3b799-175">For example, if you have created separate virtual machines to act as a web server and a reporting server, create an availability set for the web server and another availability set for the reporting server.</span></span> <span data-ttu-id="3b799-176">將 web 伺服器虛擬機器的執行個體加入至 web 伺服器可用性設定組，並將報表伺服器虛擬機器的執行個體加入至報表伺服器可用性設定組。</span><span class="sxs-lookup"><span data-stu-id="3b799-176">Add instances of the web server virtual machine to the web server availability set, and add instances of the reporting server virtual machine to the reporting server availability set.</span></span>

## <a name="data-management"></a><span data-ttu-id="3b799-177">資料管理</span><span class="sxs-lookup"><span data-stu-id="3b799-177">Data management</span></span>

* <span data-ttu-id="3b799-178">**Azure 儲存體中的異地複寫資料**。</span><span class="sxs-lookup"><span data-stu-id="3b799-178">**Geo-replicate data in Azure Storage**.</span></span> <span data-ttu-id="3b799-179">Azure 儲存體中的資料會在資料中心內自動複製。</span><span class="sxs-lookup"><span data-stu-id="3b799-179">Data in Azure Storage is automatically replicated within in a datacenter.</span></span> <span data-ttu-id="3b799-180">如需更高的可用性，請使用讀取權限異地備援儲存體 (-RAGRS)，它會將您的資料複寫到次要區域，並提供次要區域中資料的唯讀權限。</span><span class="sxs-lookup"><span data-stu-id="3b799-180">For even higher availability, use Read-access geo-redundant storage (-RAGRS), which replicates your data to a secondary region and provides read-only access to the data in the secondary location.</span></span> <span data-ttu-id="3b799-181">即使發生全面性區域中斷或災害，資料仍具持久性。</span><span class="sxs-lookup"><span data-stu-id="3b799-181">The data is durable even in the case of a complete regional outage or a disaster.</span></span> <span data-ttu-id="3b799-182">如需詳細資訊，請參閱 [Azure 儲存體複寫](/azure/storage/storage-redundancy)。</span><span class="sxs-lookup"><span data-stu-id="3b799-182">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy).</span></span>
* <span data-ttu-id="3b799-183">**異地複寫資料庫**。</span><span class="sxs-lookup"><span data-stu-id="3b799-183">**Geo-replicate databases**.</span></span> <span data-ttu-id="3b799-184">Azure SQL Database 和 Cosmos DB 都支援異地複寫，可讓您在其他區域設定次要資料庫複本。</span><span class="sxs-lookup"><span data-stu-id="3b799-184">Azure SQL Database and Cosmos DB both support geo-replication, which enables you to configure secondary database replicas in other regions.</span></span> <span data-ttu-id="3b799-185">在資料中心中斷或在無法連線至主要資料庫的情況下，便可使用次要資料庫進行查詢和容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="3b799-185">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="3b799-186">如需詳細資訊，請參閱[容錯移轉群組和主動式異地複寫](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) 和[如何使用 Azure Cosmos DB 全域散發資料？](/azure/cosmos-db/distribute-data-globally)。</span><span class="sxs-lookup"><span data-stu-id="3b799-186">For more information, see [Failover groups and active geo-replication](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) and [How to distribute data globally with Azure Cosmos DB?](/azure/cosmos-db/distribute-data-globally).</span></span>
* <span data-ttu-id="3b799-187">**使用開放式並行存取和最終一致性** 。</span><span class="sxs-lookup"><span data-stu-id="3b799-187">**Use optimistic concurrency and eventual consistency** where possible.</span></span> <span data-ttu-id="3b799-188">透過鎖定 (封閉式並行存取) 封鎖資源存取權的交易可能會造成效能不佳，並且大幅降低可用性。</span><span class="sxs-lookup"><span data-stu-id="3b799-188">Transactions that block access to resources through locking (pessimistic concurrency) can cause poor performance and considerably reduce availability.</span></span> <span data-ttu-id="3b799-189">這些問題在分散式系統中可能會變得特別嚴重。</span><span class="sxs-lookup"><span data-stu-id="3b799-189">These problems can become especially acute in distributed systems.</span></span> <span data-ttu-id="3b799-190">在許多情況下，謹慎的設計和技術 (例如資料分割) 可以將發生更新衝突的機會降至最低。</span><span class="sxs-lookup"><span data-stu-id="3b799-190">In many cases, careful design and techniques such as partitioning can minimize the chances of conflicting updates occurring.</span></span> <span data-ttu-id="3b799-191">只有在資料被複寫，或從個別更新存放區讀取時，資料才會達到最終的一致。</span><span class="sxs-lookup"><span data-stu-id="3b799-191">Where data is replicated, or is read from a separately updated store, the data will only be eventually consistent.</span></span> <span data-ttu-id="3b799-192">但優點通常會遠遠超越對使用交易來確保立即一致性的可用性影響。</span><span class="sxs-lookup"><span data-stu-id="3b799-192">But the advantages usually far outweigh the impact on availability of using transactions to ensure immediate consistency.</span></span>
* <span data-ttu-id="3b799-193">**使用定期備份和還原時間點**，並確定它符合復原點目標 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="3b799-193">**Use periodic backup and point-in-time restore**, and ensure it meets the Recovery Point Objective (RPO).</span></span> <span data-ttu-id="3b799-194">定期自動備份未保留在其他位置的資料，並確認您可以在失敗發生時，可靠地還原資料和應用程式本身。</span><span class="sxs-lookup"><span data-stu-id="3b799-194">Regularly and automatically back up data that is not preserved elsewhere, and verify you can reliably restore both the data and the application itself should a failure occur.</span></span> <span data-ttu-id="3b799-195">資料複寫並不是備份功能，因為透過失敗、錯誤或惡意作業導入的錯誤和不一致將會複寫到所有商店。</span><span class="sxs-lookup"><span data-stu-id="3b799-195">Data replication is not a backup feature because errors and inconsistencies introduced through failure, error, or malicious operations will be replicated across all stores.</span></span> <span data-ttu-id="3b799-196">備份程序必須是安全的，才能保護傳輸和儲存體中的資料。</span><span class="sxs-lookup"><span data-stu-id="3b799-196">The backup process must be secure to protect the data in transit and in storage.</span></span> <span data-ttu-id="3b799-197">資料庫或部分的資料存放區通常可以使用交易紀錄檔復原至先前的時間點。</span><span class="sxs-lookup"><span data-stu-id="3b799-197">Databases or parts of a data store can usually be recovered to a previous point in time by using transaction logs.</span></span> <span data-ttu-id="3b799-198">Microsoft Azure 會提供備份設備給儲存在 Azure SQL Database 中的資料。</span><span class="sxs-lookup"><span data-stu-id="3b799-198">Microsoft Azure provides a backup facility for data stored in Azure SQL Database.</span></span> <span data-ttu-id="3b799-199">資料會匯出至 Azure blob 儲存體上的備份封裝，並且可以下載至儲存體的安全內部部署位置。</span><span class="sxs-lookup"><span data-stu-id="3b799-199">The data is exported to a backup package on Azure blob storage, and can be downloaded to a secure on-premises location for storage.</span></span>
* <span data-ttu-id="3b799-200">**啟用高可用性選項來維護 Azure Redis 快取的次要複本。**</span><span class="sxs-lookup"><span data-stu-id="3b799-200">**Enable the high availability option to maintain a secondary copy of an Azure Redis cache.**</span></span> <span data-ttu-id="3b799-201">使用 Azure Redis 快取時，請選擇標準選項，以維護內容的次要複本。</span><span class="sxs-lookup"><span data-stu-id="3b799-201">When using Azure Redis Cache, choose the standard option to maintain a secondary copy of the contents.</span></span> <span data-ttu-id="3b799-202">如需詳細資訊，請參閱 [在 Azure Redis 快取中建立快取](https://msdn.microsoft.com/library/dn690516.aspx)。</span><span class="sxs-lookup"><span data-stu-id="3b799-202">For more information, see [Create a cache in Azure Redis Cache](https://msdn.microsoft.com/library/dn690516.aspx).</span></span>

## <a name="errors-and-failures"></a><span data-ttu-id="3b799-203">錯誤和失敗</span><span class="sxs-lookup"><span data-stu-id="3b799-203">Errors and failures</span></span>
* <span data-ttu-id="3b799-204">**導入逾時的概念。**</span><span class="sxs-lookup"><span data-stu-id="3b799-204">**Introduce the concept of a timeout.**</span></span> <span data-ttu-id="3b799-205">服務和資源可能會變成無法使用，導致要求失敗。</span><span class="sxs-lookup"><span data-stu-id="3b799-205">Services and resources may become unavailable, causing requests to fail.</span></span> <span data-ttu-id="3b799-206">請確定您所套用的逾時都適用於每個服務或資源，以及存取它們的用戶端。</span><span class="sxs-lookup"><span data-stu-id="3b799-206">Ensure that the timeouts you apply are appropriate for each service or resource as well as the client that is accessing them.</span></span> <span data-ttu-id="3b799-207">(在某些情況下，可能比較適合允許用戶端的特殊執行個體有較長的逾時，取決於用戶端執行的內容和其他動作。)非常短的逾時可能會對具有大量延遲的服務及資源造成過多的重試作業。</span><span class="sxs-lookup"><span data-stu-id="3b799-207">(In some cases, it may be appropriate to allow a longer timeout for a particular instance of a client, depending on the context and other actions that the client is performing.) Very short timeouts may cause excessive retry operations for services and resources that have considerable latency.</span></span> <span data-ttu-id="3b799-208">如果大量的要求排入佇列，非常長的逾時可已造成封鎖，等待服務或資源回應。</span><span class="sxs-lookup"><span data-stu-id="3b799-208">Very long timeouts can cause blocking if a large number of requests are queued, waiting for a service or resource to respond.</span></span>
* <span data-ttu-id="3b799-209">**重試暫時性錯誤所造成的失敗作業。**</span><span class="sxs-lookup"><span data-stu-id="3b799-209">**Retry failed operations caused by transient faults.**</span></span> <span data-ttu-id="3b799-210">設計存取所有服務和資源的重試策略，因為它們原本不支援自動連線重試。</span><span class="sxs-lookup"><span data-stu-id="3b799-210">Design a retry strategy for access to all services and resources where they do not inherently support automatic connection retry.</span></span> <span data-ttu-id="3b799-211">使用策略包含在重試之間增加的延遲，做為失敗增加的數目，以避免資源的多載，並允許它適當地復原並處理排入佇列的要求。</span><span class="sxs-lookup"><span data-stu-id="3b799-211">Use a strategy that includes an increasing delay between retries as the number of failures increases, to prevent overloading of the resource and to allow it to gracefully recover and handle queued requests.</span></span> <span data-ttu-id="3b799-212">具有非常短的延遲的持續重試很可能會使問題惡化。</span><span class="sxs-lookup"><span data-stu-id="3b799-212">Continual retries with very short delays are likely to exacerbate the problem.</span></span>
* <span data-ttu-id="3b799-213">**停止傳送要求以避免連鎖失敗** 。</span><span class="sxs-lookup"><span data-stu-id="3b799-213">**Stop sending requests to avoid cascading failures** when remote services are unavailable.</span></span> <span data-ttu-id="3b799-214">可能有一些情況中，暫時性或其他錯誤 (嚴重性範圍從部分的連線中斷到服務的完全失敗) 會花費比預期還長的時間才能返回正常狀態。</span><span class="sxs-lookup"><span data-stu-id="3b799-214">There may be situations in which transient or other faults, ranging in severity from a partial loss of connectivity to the complete failure of a service, take much longer than expected to return to normal.</span></span> <span data-ttu-id="3b799-215">此外，如果服務非常忙碌，系統某部分中的失敗可能導致連鎖失敗，而造成許多作業在保存重要的系統資源 (例如記憶體、執行緒和資料庫連接) 時遭到封鎖。</span><span class="sxs-lookup"><span data-stu-id="3b799-215">Additionally, if a service is very busy, failure in one part of the system may lead to cascading failures, and result in many operations becoming blocked while holding onto critical system resources such as memory, threads, and database connections.</span></span> <span data-ttu-id="3b799-216">應用程式不會持續重試不太可能成功的作業，而是應該快速接受作業已失敗，且適當地處理這項失敗。</span><span class="sxs-lookup"><span data-stu-id="3b799-216">Instead of continually retrying an operation that is unlikely to succeed, the application should quickly accept that the operation has failed, and gracefully handle this failure.</span></span> <span data-ttu-id="3b799-217">斷路器模式可用來拒絕定義期間的特定作業要求。</span><span class="sxs-lookup"><span data-stu-id="3b799-217">You can use the circuit breaker pattern to reject requests for specific operations for defined periods.</span></span> <span data-ttu-id="3b799-218">如需詳細資訊，請參閱[斷路器模式](../patterns/circuit-breaker.md)。</span><span class="sxs-lookup"><span data-stu-id="3b799-218">For more information, see [Circuit Breaker Pattern](../patterns/circuit-breaker.md).</span></span>
* <span data-ttu-id="3b799-219">**撰寫或回到多個元件** 以緩和特定服務離線或無法使用的影響。</span><span class="sxs-lookup"><span data-stu-id="3b799-219">**Compose or fall back to multiple components** to mitigate the impact of a specific service being offline or unavailable.</span></span> <span data-ttu-id="3b799-220">設計應用程式，以盡可能充分利用多個執行個體，而不影響作業和現有的連接。</span><span class="sxs-lookup"><span data-stu-id="3b799-220">Design applications to take advantage of multiple instances without affecting operation and existing connections where possible.</span></span> <span data-ttu-id="3b799-221">使用多個執行個體並分散它們之間的要求，偵測並避免傳送要求給失敗的執行個體，藉以最大化可用性。</span><span class="sxs-lookup"><span data-stu-id="3b799-221">Use multiple instances and distribute requests between them, and detect and avoid sending requests to failed instances, in order to maximize availability.</span></span>
* <span data-ttu-id="3b799-222">**回到不同的服務或工作流程** 。</span><span class="sxs-lookup"><span data-stu-id="3b799-222">**Fall back to a different service or workflow** where possible.</span></span> <span data-ttu-id="3b799-223">例如，如果寫入至 SQL Database 失敗，請暫時將資料儲存在 blob 儲存體。</span><span class="sxs-lookup"><span data-stu-id="3b799-223">For example, if writing to SQL Database fails, temporarily store data in blob storage.</span></span> <span data-ttu-id="3b799-224">服務可供使用時，請提供在 blob 儲存體寫入至 SQL Database 的功能。</span><span class="sxs-lookup"><span data-stu-id="3b799-224">Provide a facility to replay the writes in blob storage to SQL Database when the service becomes available.</span></span> <span data-ttu-id="3b799-225">在某些情況下，失敗的作業可能會有替代動作，允許應用程式繼續運作，甚至是當元件或服務失敗時也可繼續運作。</span><span class="sxs-lookup"><span data-stu-id="3b799-225">In some cases, a failed operation may have an alternative action that allows the application to continue to work even when a component or service fails.</span></span> <span data-ttu-id="3b799-226">盡可能偵測失敗並將要求重新導向至其他可提供適當替代功能的服務，或者在主要服務離線時，備分或減少可維護核心作業的功能執行個體。</span><span class="sxs-lookup"><span data-stu-id="3b799-226">If possible, detect failures and redirect requests to other services that can offer a suitable alternative functionality, or to back up or reduced functionality instances that can maintain core operations while the primary service is offline.</span></span>

## <a name="monitoring-and-disaster-recovery"></a><span data-ttu-id="3b799-227">監視和災害復原</span><span class="sxs-lookup"><span data-stu-id="3b799-227">Monitoring and disaster recovery</span></span>
* <span data-ttu-id="3b799-228">**為可能的失敗和失敗事件提供豐富的檢測** 以將情況回報給操作人員。</span><span class="sxs-lookup"><span data-stu-id="3b799-228">**Provide rich instrumentation for likely failures and failure events** to report the situation to operations staff.</span></span> <span data-ttu-id="3b799-229">為可能但尚未發生的失敗提供足夠的資料，以便作業人員判斷其原因，緩和情況，並確保系統仍然可用。</span><span class="sxs-lookup"><span data-stu-id="3b799-229">For failures that are likely but have not yet occurred, provide sufficient data to enable operations staff to determine the cause, mitigate the situation, and ensure that the system remains available.</span></span> <span data-ttu-id="3b799-230">對於已經發生的失敗，應用程式應該將適當的錯誤訊息傳回給使用者，雖然功能減少了，但仍嘗試繼續執行。</span><span class="sxs-lookup"><span data-stu-id="3b799-230">For failures that have already occurred, the application should return an appropriate error message to the user but attempt to continue running, albeit with reduced functionality.</span></span> <span data-ttu-id="3b799-231">在所有情況下，監視系統應該擷取完整的詳細資料，以便作業人員達成快速復原，並視需要讓設計人員和開發人員修改系統，以防止再次發生這個情況。</span><span class="sxs-lookup"><span data-stu-id="3b799-231">In all cases, the monitoring system should capture comprehensive details to enable operations staff to effect a quick recovery, and if necessary, for designers and developers to modify the system to prevent the situation from arising again.</span></span>
* <span data-ttu-id="3b799-232">**實作檢查函數來監視系統健全狀況。**</span><span class="sxs-lookup"><span data-stu-id="3b799-232">**Monitor system health by implementing checking functions.**</span></span> <span data-ttu-id="3b799-233">應用程式的健全狀況和效能可能會在不同時間產生不明顯的降級，直到失敗為止。</span><span class="sxs-lookup"><span data-stu-id="3b799-233">The health and performance of an application can degrade over time, without being noticeable until it fails.</span></span> <span data-ttu-id="3b799-234">實作探查或檢查定期從應用程式外部執行的函數。</span><span class="sxs-lookup"><span data-stu-id="3b799-234">Implement probes or check functions that are executed regularly from outside the application.</span></span> <span data-ttu-id="3b799-235">這些檢查和測量整體應用程式、應用程式的個別部分、應用程式使用的個別服務、和個別元件的回應時間一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="3b799-235">These checks can be as simple as measuring response time for the application as a whole, for individual parts of the application, for individual services that the application uses, or for individual components.</span></span> <span data-ttu-id="3b799-236">檢查函數可以執行程序，以確保它們會產生有效的結果、測量延遲及檢查可用性，並從系統中擷取資訊。</span><span class="sxs-lookup"><span data-stu-id="3b799-236">Check functions can execute processes to ensure they produce valid results, measure latency and check availability, and extract information from the system.</span></span>
* <span data-ttu-id="3b799-237">**定期測試所有容錯移轉和後援系統** 以確保它們可以使用並如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="3b799-237">**Regularly test all failover and fallback systems** to ensure they are available and operate as expected.</span></span> <span data-ttu-id="3b799-238">系統與作業的變更可能會影響容錯移轉和後援函數，但是在主要系統失敗或負載過重之前可能都無法偵測到影響。</span><span class="sxs-lookup"><span data-stu-id="3b799-238">Changes to systems and operations may affect failover and fallback functions, but the impact may not be detected until the main system fails or becomes overloaded.</span></span> <span data-ttu-id="3b799-239">在執行階段中必須彌補即時問題之前加以測試。</span><span class="sxs-lookup"><span data-stu-id="3b799-239">Test it before it is required to compensate for a live problem at runtime.</span></span>
* <span data-ttu-id="3b799-240">**測試監視系統。**</span><span class="sxs-lookup"><span data-stu-id="3b799-240">**Test the monitoring systems.**</span></span> <span data-ttu-id="3b799-241">自動化的容錯移轉和後援系統，以及使用儀表板手動進行系統健全狀況和效能視覺化，都取決於正常運作的監視和檢測。</span><span class="sxs-lookup"><span data-stu-id="3b799-241">Automated failover and fallback systems, and manual visualization of system health and performance by using dashboards, all depend on monitoring and instrumentation functioning correctly.</span></span> <span data-ttu-id="3b799-242">如果這些項目失敗，遺漏重要資訊或回報不正確的資料，操作人員可能不知道系統是狀況不良還是失敗。</span><span class="sxs-lookup"><span data-stu-id="3b799-242">If these elements fail, miss critical information, or report inaccurate data, an operator might not realize that the system is unhealthy or failing.</span></span>
* <span data-ttu-id="3b799-243">**追蹤長時間執行之工作流程的進度** 並再試一次失敗。</span><span class="sxs-lookup"><span data-stu-id="3b799-243">**Track the progress of long-running workflows** and retry on failure.</span></span> <span data-ttu-id="3b799-244">長時間執行的工作流程通常以多個步驟組成。</span><span class="sxs-lookup"><span data-stu-id="3b799-244">Long-running workflows are often composed of multiple steps.</span></span> <span data-ttu-id="3b799-245">請確定每個步驟都是獨立且可以重試的，以將整個工作流程都必須回復的機會，或必須執行多個補償交易的機會降到最低。</span><span class="sxs-lookup"><span data-stu-id="3b799-245">Ensure that each step is independent and can be retried to minimize the chance that the entire workflow will need to be rolled back, or that multiple compensating transactions need to be executed.</span></span> <span data-ttu-id="3b799-246">藉由實作模式 (例如 [排程器代理程式監督員模式](https://msdn.microsoft.com/library/dn589780.aspx)) 監視並管理長時間執行之工作流程的進度。</span><span class="sxs-lookup"><span data-stu-id="3b799-246">Monitor and manage the progress of long-running workflows by implementing a pattern such as [Scheduler Agent Supervisor Pattern](https://msdn.microsoft.com/library/dn589780.aspx).</span></span>
* <span data-ttu-id="3b799-247">**規劃災害復原。**</span><span class="sxs-lookup"><span data-stu-id="3b799-247">**Plan for disaster recovery.**</span></span> <span data-ttu-id="3b799-248">建立從可能影響系統可用性的任何類型失敗復原的可接受、經完整測試的方案。</span><span class="sxs-lookup"><span data-stu-id="3b799-248">Create an accepted, fully-tested plan for recovery from any type of failure that may affect system availability.</span></span> <span data-ttu-id="3b799-249">選擇任何關鍵任務應用程式的多站台災害復原架構。</span><span class="sxs-lookup"><span data-stu-id="3b799-249">Choose a multi-site disaster recovery architecture for any mission-critical applications.</span></span> <span data-ttu-id="3b799-250">識別災害復原方案的特定擁有者，包括自動化和測試。</span><span class="sxs-lookup"><span data-stu-id="3b799-250">Identify a specific owner of the disaster recovery plan, including automation and testing.</span></span> <span data-ttu-id="3b799-251">確保方案完善記載，並盡可能讓程序自動化。</span><span class="sxs-lookup"><span data-stu-id="3b799-251">Ensure the plan is well-documented, and automate the process as much as possible.</span></span> <span data-ttu-id="3b799-252">為所有參考和交易資料建立備份策略，然後定期測試這些備份的還原。</span><span class="sxs-lookup"><span data-stu-id="3b799-252">Establish a backup strategy for all reference and transactional data, and test the restoration of these backups regularly.</span></span> <span data-ttu-id="3b799-253">訓練作業人員執行方案，並執行常態性災害模擬，以驗證並改善方案。</span><span class="sxs-lookup"><span data-stu-id="3b799-253">Train operations staff to execute the plan, and perform regular disaster simulations to validate and improve the plan.</span></span>
