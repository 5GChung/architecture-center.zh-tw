---
title: "事件驅動架構樣式"
description: "說明 Azure 上事件驅動架構和 IoT 架構的優點、挑戰和最佳做法"
author: MikeWasson
ms.openlocfilehash: ff7f936ceabefe7079a1ebbfa717ff4095bf133b
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/14/2017
---
# <a name="event-driven-architecture-style"></a>事件驅動架構樣式

事件驅動架構包含產生事件串流的**事件產生者**，以及接聽事件的**事件取用者**。 

![](./images/event-driven.svg)

事件會以幾近即時的方式傳遞，讓取用者可以在事件發生時立即做出回應。 產生者會與取用者分離，也就是說，產生者並不會知道是哪一個取用者在接聽。 取用者也會彼此分離，而且每個取用者都會看到所有事件。 這與[競爭取用者][competing-consumers]模式不同，競爭取用者模式的取用者會從佇列提取訊息，而且一個訊息只會處理一次 (在沒有錯誤的前提下)。 某些系統 (例如 IoT) 必須極為大量地擷取事件。

事件驅動架構可以使用發行/訂閱模型或事件串流模型。 

- **發行/訂閱**：傳訊基礎結構會追蹤訂用帳戶。 有事件發行時，它就會將該事件傳送給每個訂閱者。 事件經過接收後就無法重新執行，因此新的訂閱者不會看到該事件。 

- **事件串流**：事件會寫入記錄中。 事件有嚴格的排序 (在資料分割內) 並具有持久性。 用戶端不會訂閱串流，相反地，用戶端可以讀取串流的任何部分。 用戶端負責讓其在串流中的位置前進。 這表示用戶端可以在任何時間加入，並可重新執行事件。

在取用者端，則有一些常見的變化：

- **簡單事件處理**。 事件會立即在取用者中觸發動作。 例如，您可以使用 Azure Functions 並搭配服務匯流排觸發程序，以便在每當有訊息發佈至服務匯流排主題時執行函式。

- **複雜事件處理**。 取用者會處理一系列的事件，使用 Azure 串流分析或 Apache Storm 之類的技術尋找事件資料的模式。 例如，您可以彙總內嵌裝置在一段時間內的數據，並在移動平均值超過特定閾值時產生通知。 

- **事件串流處理**。 使用資料串流平台 (例如 Azure IoT 中樞或 Apache Kafka) 做為管線，以擷取事件並饋送至串流處理器。 串流處理器會採取行動，以處理或轉換串流。 不同的應用程式子系統可能會有多個串流處理器。 這個方法很適合用於 IoT 工作負載。

事件的來源可能是系統外部，例如 IoT 解決方案中的實體裝置。 在此情況下，系統必須能夠以資料來源所需要的數量和輸送量擷取資料。

在上述邏輯圖中，每種類型的取用者各顯示為一個方塊。 實際上，取用者經常會有多個執行個體，以免取用者成為系統中的單一失敗點。 可能也必須有多個執行個體才能處理事件的數量和頻率。 此外，單一取用者也可以在多個執行緒上處理事件。 如果事件必須按順序處理，或需要正好一次的語意，這可能會產生困難。 請參閱[最小化協調][minimize-coordination]。 

## <a name="when-to-use-this-architecture"></a>使用此架構的時機

- 多個子系統必須處理相同的事件。 
- 具有最小延遲時間的即時處理。
- 複雜事件處理，例如模式比對或一段時間的彙總。
- 大量和高速度的資料，例如 IoT。

## <a name="benefits"></a>優點

- 產生者和取用者分離。
- 沒有點對點整合。 可以輕鬆地將新的取用者新增至系統。
- 取用者可以在事件到達時立即做出回應。 
- 高度延展性且分散。 
- 子系統有獨立的事件串流檢視。

## <a name="challenges"></a>挑戰

- 有保證的傳遞。 在某些系統上，尤其是在 IoT 案例中，保證事件的傳遞是相當重要的事。
- 按順序處理事件，或只處理一次。 每個取用者類型通常會在多個執行個體中執行，以便擁有復原功能和延展性。 如果事件必須按順序處理 (在某個取用者類型中)，或如果處理邏輯不是等冪的，這會產生挑戰。

## <a name="iot-architecture"></a>IoT 架構

事件驅動架構是 IoT 解決方案的核心。 下圖顯示 IoT 可能的邏輯架構。 此圖強調架構的事件串流元件。

![](./images/iot.png)

**雲端閘道**會使用可靠、低延遲的傳訊系統在雲端邊界擷取裝置事件。

裝置可能會將事件直接傳送到雲端閘道，或透過**現場閘道**來傳送。 現場閘道是專用的裝置或軟體，通常會與裝置共置，以便接收事件並將它們轉送到雲端閘道。 現場閘道可能也會前置處理未經處理的裝置事件，以執行篩選、彙總或通訊協定轉換等功能。

在擷取之後，事件會通過一個或多個**串流處理器**，這些處理器可以路由傳送資料 (例如，傳送到儲存體) 或執行分析和其他處理。

以下是一些常見的處理類型。 (此清單一定不怎麼詳盡)。

- 將事件資料寫入冷儲存體，以便封存或批次分析。

- 最忙碌路徑分析，(近乎) 即時地分析事件串流，以偵測異常行為、辨識滾動時間範圍的模式，或在串流中發生特定情況時觸發警示。 

- 處理裝置中特殊的非遙測訊息類型，例如通知和警示。 

- 機器學習。

深灰色的方塊顯示的是 IoT 系統中，與事件串流沒有直接關係，但為求完整所以在此納入的元件。

- **裝置登錄**是已佈建之裝置的資料庫，包括裝置識別碼，且通常會包括裝置中繼資料，例如位置。

- **佈建 API** 是常見用於佈建和註冊新裝置的外部介面。

- 某些 IoT 解決方案允許將**命令和控制訊息**傳送至裝置。

> 本節提供了極為高階的 IoT 檢視，其中有許多要考慮的微妙之處和挑戰。 如需更詳細的參考架構和討論，請參閱 [Microsoft Azure IoT 參考架構][ iot-ref-arch] (PDF 下載)。

 <!-- links -->

[competing-consumers]: ../../patterns/competing-consumers.md
[iot-ref-arch]: https://azure.microsoft.com/en-us/updates/microsoft-azure-iot-reference-architecture-available/
[minimize-coordination]: ../design-principles/minimize-coordination.md


